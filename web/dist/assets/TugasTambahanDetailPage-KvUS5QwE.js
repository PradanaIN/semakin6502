import{h as ma,a as ua,u as ha,r,R as p,b as o,j as a,S as xa}from"./index-tHDgc07s.js";import{h as k,a as q,b as I,s as E,c as J,d as pa}from"./alerts-D6uugUBg.js";import{S as U,s as W}from"./selectStyles-DWDXWe1y.js";import{S as d,f as F}from"./status-DdjLpvCM.js";import{S as z}from"./StatusBadge-BxML8eep.js";import{D as ka,M as ja}from"./DataTable-CS6-fgxe.js";import{B as m}from"./Button-DTOqL5YY.js";import{L as u,I as C}from"./Label-BFO2ikUa.js";import{T as M}from"./Textarea-DUdvOxUM.js";import{f as B}from"./formatDate-DfmPmopR.js";import{g as O}from"./dateUtils-51te1x9i.js";import{m as Y}from"./months-C0Ia_Adi.js";import{P as V,T as X}from"./trash-2-A_maZEWT.js";import{P as ba}from"./plus-CRlAJCsY.js";import{E as fa}from"./external-link-CaRraGV_.js";import"./confirmAlert-BWqzQj7I.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./arrow-up-ffV8zUNQ.js";function va(g,w,c){const n=w-1,D=(new Date(c,n,1).getDay()+6)%7,b=new Date(c,n+1,0).getDate(),N=(g-1)*7-D+1,f=Math.min(b,Math.max(1,N)),S=c,j=String(w).padStart(2,"0"),L=String(f).padStart(2,"0");return`${S}-${j}-${L}`}function Ga(){const{id:g}=ma(),w=ua(),{user:c}=ha(),[n,H]=r.useState(null),D=[p.ADMIN,p.KETUA].includes(c?.role)||c?.id===n?.userId,b=[p.ADMIN,p.KETUA].includes(c?.role)||String(c?.id)===String(n?.userId),[N,f]=r.useState(!1),[S,j]=r.useState([]),[L,Q]=r.useState([]),[P,K]=r.useState([]),Z=b&&!P.some(e=>e.status===d.SELESAI_DIKERJAKAN),[aa,v]=r.useState(!1),[i,h]=r.useState({tanggal:new Date().toISOString().slice(0,10),deskripsi:"",capaianKegiatan:"",status:d.BELUM,catatan:"",buktiLink:""}),[$,T]=r.useState(!1),[t,x]=r.useState({teamId:"",kegiatanId:"",deskripsi:"",minggu:1,bulan:new Date().getMonth()+1,tahun:new Date().getFullYear()}),R=r.useRef(null),{minggu:ea,bulan:sa,tahun:ta}=r.useMemo(()=>{if(!n?.tanggal)return{minggu:"",bulan:"",tahun:""};const e=new Date(n.tanggal);return{minggu:O(e),bulan:Y[e.getMonth()],tahun:e.getFullYear()}},[n?.tanggal]),A=r.useCallback(async e=>{if(!e){j([]);return}try{let s;c?.role===p.ADMIN?s=await o.get(`/master-kegiatan?team=${e}`):s=await o.get(`/master-kegiatan?team=${e}`,{headers:{"X-For-Tambahan":"1"}}),j(s.data.data||s.data)}catch(s){if(s.response?.status===403){j([]);return}k(s,"Gagal mengambil kegiatan"),j([])}},[c?.role]),y=r.useCallback(async()=>{try{const e=await o.get(`/tugas-tambahan/${g}`);H(e.data);const s=e.data.kegiatan?.teamId||"";await A(s);const l=e.data.tanggal?new Date(e.data.tanggal):new Date;x({teamId:s?String(s):"",kegiatanId:String(e.data.kegiatanId),deskripsi:e.data.deskripsi||"",minggu:e.data.tanggal?O(l):1,bulan:l.getMonth()+1,tahun:l.getFullYear()})}catch(e){k(e,"Gagal mengambil data")}},[g,A]);r.useEffect(()=>{(async()=>{try{const s=await o.get("/teams/all");Q(s.data.filter(l=>l.namaTim!=="Admin"&&l.namaTim!=="Pimpinan"))}catch(s){k(s,"Gagal mengambil tim")}})()},[]),r.useEffect(()=>{y(),o.get(`/laporan-harian/tambahan/${g}`).then(e=>K(e.data))},[y,g]);const ia=async e=>{const s=e?e.value:"";x({...t,teamId:s,kegiatanId:""}),[p.ADMIN,p.KETUA].includes(c?.role)&&await A(s)},na=async()=>{try{if(t.teamId===""||t.kegiatanId===""||t.deskripsi.trim()===""||!t.minggu||!t.bulan||!t.tahun){I("Lengkapi data","Semua field wajib diisi");return}const e={kegiatanId:t.kegiatanId,deskripsi:t.deskripsi,tanggal:va(t.minggu,t.bulan,t.tahun)};await o.put(`/tugas-tambahan/${g}`,e),E("Berhasil","Kegiatan diperbarui"),f(!1),y()}catch(e){k(e,"Gagal menyimpan")}},ra=r.useCallback(()=>{v(!1)},[]),la=()=>{h({tanggal:new Date().toISOString().slice(0,10),deskripsi:"",capaianKegiatan:"",status:d.BELUM,catatan:"",buktiLink:""}),T(!1),v(!0)},da=async()=>{if(!$){T(!0);try{if(i.deskripsi.trim()===""){I("Lengkapi data","Deskripsi Kegiatan wajib diisi");return}if(i.capaianKegiatan.trim()===""){I("Lengkapi data","Capaian Kegiatan wajib diisi");return}if((i.status===d.SEDANG_DIKERJAKAN||i.status===d.SELESAI_DIKERJAKAN)&&!(typeof i.buktiLink=="string"?i.buktiLink:"").trim()){I("Lengkapi data","Link bukti wajib diisi");return}const{id:e,...s}=i,l={...s,buktiLink:s.buktiLink||"",catatan:s.catatan||""};e?await o.put(`/laporan-harian/${e}`,l):await o.post(`/tugas-tambahan/${g}/laporan`,l),E("Berhasil","Laporan disimpan"),v(!1),setTimeout(async()=>{const ga=await o.get(`/laporan-harian/tambahan/${g}`);K(ga.data),y()},200)}catch(e){k(e,"Gagal menyimpan laporan")}finally{T(!1)}}},G=e=>{h({id:e.id,tanggal:e.tanggal.slice(0,10),deskripsi:e.deskripsi||"",capaianKegiatan:e.capaianKegiatan||"",status:e.status,catatan:e.catatan??"",buktiLink:e.buktiLink??""}),v(!0)},_=async e=>{if((await J("Hapus laporan ini?")).isConfirmed)try{await o.delete(`/laporan-harian/${e}`,{suppressToast:!0});const l=await o.get(`/laporan-harian/tambahan/${g}`);K(l.data),y(),E("Dihapus","Laporan dihapus")}catch(l){k(l,"Gagal menghapus laporan")}},ca=r.useMemo(()=>{const e=[{Header:"No",accessor:(s,l)=>l+1,disableFilters:!0},{Header:"Deskripsi Kegiatan",accessor:"deskripsi",disableFilters:!0},{Header:"Capaian Kegiatan",accessor:"capaianKegiatan",disableFilters:!0},{Header:"Tanggal",accessor:s=>B(s.tanggal),disableFilters:!0},{Header:"Status",accessor:"status",Cell:({row:s})=>a.jsx(z,{status:s.original.status}),disableFilters:!0},{Header:"Bukti",accessor:"buktiLink",Cell:({row:s})=>s.original.buktiLink?a.jsx("a",{href:s.original.buktiLink,target:"_blank",rel:"noreferrer","aria-label":"Lihat bukti dukung",children:a.jsx(fa,{size:16,className:"mx-auto text-blue-600 dark:text-blue-400 hover:scale-110 transition-transform"})}):"-",disableFilters:!0},{Header:"Catatan",accessor:s=>s.catatan||"-",disableFilters:!0}];return b&&e.push({Header:"Aksi",accessor:"id",Cell:({row:s})=>a.jsxs("div",{className:"space-x-2",children:[a.jsx(m,{onClick:()=>G(s.original),variant:"warning",icon:!0,"aria-label":"Edit laporan",children:a.jsx(V,{size:14})}),a.jsx(m,{onClick:()=>_(s.original.id),variant:"danger",icon:!0,"aria-label":"Hapus laporan",children:a.jsx(X,{size:14})})]}),disableFilters:!0}),e},[G,_,b]),oa=async()=>{if((await J("Hapus kegiatan ini?")).isConfirmed)try{await o.delete(`/tugas-tambahan/${g}`,{suppressToast:!0}),w("/tugas-tambahan",{state:{success:"Kegiatan dihapus"}})}catch(s){[400,403].includes(s?.response?.status)?pa("Gagal","Harap hapus laporan harian terlebih dahulu!"):k(s,"Gagal menghapus")}};return n?a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Detail Tugas Tambahan"}),D&&!N&&a.jsxs("div",{className:"space-x-2",children:[a.jsx(m,{onClick:()=>f(!0),variant:"warning",icon:!0,"aria-label":"Edit",children:a.jsx(V,{size:16})}),a.jsx(m,{onClick:oa,variant:"danger",icon:!0,"aria-label":"Hapus",children:a.jsx(X,{size:16})})]})]}),N?a.jsxs("div",{className:"space-y-2 bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"team",className:"block text-sm mb-1",children:["Tim ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(U,{inputId:"team",classNamePrefix:"react-select",styles:W,menuPortalTarget:document.body,options:L.map(e=>({value:e.id.toString(),label:e.namaTim})),value:t.teamId?{value:t.teamId,label:L.find(e=>e.id.toString()===t.teamId)?.namaTim}:null,onChange:ia,placeholder:"Pilih tim..."})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"kegiatan",className:"block text-sm mb-1",children:["Kegiatan ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(U,{inputId:"kegiatan",classNamePrefix:"react-select",styles:W,menuPortalTarget:document.body,options:S.map(e=>({value:e.id.toString(),label:e.namaKegiatan})),value:t.kegiatanId?{value:t.kegiatanId,label:S.find(e=>e.id.toString()===t.kegiatanId)?.namaKegiatan}:null,onChange:e=>x({...t,kegiatanId:e?e.value:""}),placeholder:t.teamId?"Pilih kegiatan...":"Pilih tim terlebih dahulu",isDisabled:!t.teamId})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"deskripsi",className:"block text-sm mb-1",children:["Deskripsi ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("textarea",{id:"deskripsi",value:t.deskripsi,onChange:e=>x({...t,deskripsi:e.target.value}),className:"form-input",required:!0})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[a.jsxs("div",{children:[a.jsxs(u,{htmlFor:"minggu",children:["Minggu ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(C,{id:"minggu",type:"number",min:"1",max:"6",value:t.minggu,onChange:e=>x({...t,minggu:parseInt(e.target.value||"0",10)}),required:!0})]}),a.jsxs("div",{children:[a.jsxs(u,{htmlFor:"bulan",children:["Bulan ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("select",{id:"bulan",value:t.bulan,onChange:e=>x({...t,bulan:parseInt(e.target.value,10)}),className:"w-full rounded-md border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:!0,children:Y.map((e,s)=>a.jsx("option",{value:s+1,children:e},s+1))})]}),a.jsxs("div",{children:[a.jsxs(u,{htmlFor:"tahun",children:["Tahun ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(C,{id:"tahun",type:"number",value:t.tahun,onChange:e=>x({...t,tahun:parseInt(e.target.value||"0",10)}),required:!0})]})]}),a.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[a.jsx(m,{variant:"secondary",onClick:async()=>{(await q("Batalkan perubahan?")).isConfirmed&&f(!1)},children:"Batal"}),a.jsx(m,{onClick:na,children:"Simpan"})]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{"data-testid":"detail-grid",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3 lg:gap-4 bg-white dark:bg-gray-800 p-3 sm:p-4 rounded-lg shadow",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 inline-flex items-center gap-1",children:[a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-gray-400",children:[a.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"}),a.jsx("path",{d:"M16 4h1a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1"}),a.jsx("line",{x1:"9",y1:"12",x2:"15",y2:"12"}),a.jsx("line",{x1:"9",y1:"16",x2:"15",y2:"16"})]}),"Kegiatan"]}),a.jsx("div",{className:"font-medium",children:n.nama})]}),a.jsxs("div",{className:"sm:col-span-2 lg:col-span-3",children:[a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 inline-flex items-center gap-1",children:[a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-gray-400",children:[a.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),a.jsx("polyline",{points:"14 2 14 8 20 8"}),a.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),a.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),"Deskripsi Penugasan"]}),a.jsx("div",{className:"font-medium",children:n.deskripsi||"-"})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 inline-flex items-center gap-1",children:[a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-gray-400",children:[a.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2"}),a.jsx("circle",{cx:"9",cy:"7",r:"4"}),a.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),a.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),"Tim"]}),a.jsx("div",{className:"font-medium",children:n.kegiatan.team?.namaTim||"-"})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 inline-flex items-center gap-1",children:[a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-gray-400",children:[a.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),a.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),"Pegawai"]}),a.jsx("div",{className:"font-medium",children:n.user?.nama||c.nama})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 inline-flex items-center gap-1",children:[a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-gray-400",children:[a.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),a.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),a.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),a.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),"Waktu"]}),a.jsx("div",{className:"font-medium",children:`Minggu ${ea} • ${sa} ${ta}`})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 inline-flex items-center gap-1",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"12",height:"12",fill:"currentColor",className:"text-gray-400",children:a.jsx("circle",{cx:"12",cy:"12",r:"5"})}),"Status"]}),a.jsx("div",{className:"font-medium",children:a.jsx(z,{status:n.status})})]})]}),n.tanggalSelesai&&a.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Tanggal Selesai"}),a.jsxs("div",{className:"font-medium",children:[B(n.tanggalSelesai),n.tanggalSelesaiAkhir&&` - ${B(n.tanggalSelesaiAkhir)}`]})]}),n.buktiLink&&a.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bukti"}),a.jsx("a",{href:n.buktiLink,target:"_blank",rel:"noreferrer",className:"font-medium text-blue-600 underline dark:text-blue-400",children:"Link"})]})]}),a.jsxs("div",{className:"space-y-2 bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Laporan Harian"}),Z&&a.jsxs(m,{onClick:la,className:"add-button",children:[a.jsx(ba,{size:16}),a.jsx("span",{className:"hidden sm:inline",children:"Tambah Laporan"})]})]}),a.jsx("div",{className:"overflow-x-auto md:overflow-x-visible rounded-lg border dark:border-gray-700",children:a.jsx(ka,{columns:ca,data:P,showGlobalFilter:!1,showPagination:!1,selectable:!1})})]}),aa&&a.jsx(ja,{onClose:ra,titleId:"laporan-form-title",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{id:"laporan-form-title",className:"text-lg font-semibold",children:[i.id?"Edit":"Tambah"," Laporan Harian"]}),a.jsx("span",{className:"text-xs text-red-500",children:"* Fardu 'Ain"})]}),a.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"col-span-1 md:col-span-2",children:[a.jsxs(u,{htmlFor:"laporanDeskripsi",children:["Deskripsi Kegiatan ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(M,{id:"laporanDeskripsi",value:i.deskripsi,onChange:e=>h({...i,deskripsi:e.target.value}),placeholder:"Tuliskan deskripsi kegiatan...",required:!0})]}),a.jsxs("div",{className:"col-span-1 md:col-span-2",children:[a.jsxs(u,{htmlFor:"capaianKegiatan",children:["Capaian Kegiatan ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(M,{id:"capaianKegiatan",value:i.capaianKegiatan,onChange:e=>h({...i,capaianKegiatan:e.target.value}),placeholder:"Tuliskan capaian kegiatan...",required:!0})]}),a.jsxs("div",{children:[a.jsxs(u,{htmlFor:"laporanTanggal",children:["Tanggal ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(C,{id:"laporanTanggal",type:"date",ref:R,value:i.tanggal,onChange:e=>h({...i,tanggal:e.target.value}),onFocus:()=>R.current?.showPicker?.(),required:!0})]}),a.jsxs("div",{children:[a.jsxs(u,{htmlFor:"laporanStatus",children:["Status ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{id:"laporanStatus",value:i.status,onChange:e=>h({...i,status:e.target.value}),required:!0,className:"w-full rounded-md border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:d.BELUM,children:F(d.BELUM)}),a.jsx("option",{value:d.SEDANG_DIKERJAKAN,children:F(d.SEDANG_DIKERJAKAN)}),a.jsx("option",{value:d.SELESAI_DIKERJAKAN,children:F(d.SELESAI_DIKERJAKAN)})]})]}),(i.status===d.SEDANG_DIKERJAKAN||i.status===d.SELESAI_DIKERJAKAN)&&a.jsxs("div",{className:"col-span-1 md:col-span-2",children:[a.jsxs(u,{htmlFor:"buktiLink",children:["Link Bukti ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(C,{id:"buktiLink",type:"url",value:i.buktiLink,onChange:e=>h({...i,buktiLink:e.target.value}),placeholder:"https://...",required:!0})]}),a.jsxs("details",{className:"col-span-1 md:col-span-2 mt-2",children:[a.jsx("summary",{className:"cursor-pointer text-sm text-blue-600 dark:text-blue-400",children:"Tambah Catatan Kendala (Opsional)"}),a.jsxs("div",{className:"mt-2",children:[a.jsx(u,{htmlFor:"catatan",children:"Catatan"}),a.jsx(M,{id:"catatan",value:i.catatan,onChange:e=>h({...i,catatan:e.target.value}),placeholder:"Catatan kendala..."})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[a.jsx(m,{variant:"secondary",onClick:async()=>{(await q(i.id?"Batalkan perubahan?":"Batalkan penambahan laporan?")).isConfirmed&&v(!1)},children:"Batal"}),a.jsx(m,{type:"button",onClick:da,disabled:$,children:"Simpan"})]})]})})]}):a.jsx("div",{className:"p-6 text-center",children:a.jsx(xa,{className:"h-6 w-6 mx-auto"})})}export{Ga as default};
