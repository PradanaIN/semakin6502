import{c as q,j as e,a as Ze,r as m,u as et,L as tt,d as at,R as ue,b as Y}from"./index-D7Gl0_T6.js";import{g as Pe}from"./holidays-BznbYqFv.js";import{L as nt}from"./Legend-BByel-XM.js";import{m as U}from"./months-C0Ia_Adi.js";import{g as st}from"./dateUtils-51te1x9i.js";import{M as Te}from"./minus-Cuh7shgd.js";import{w as F,F as De,a as Se}from"./ChevronUpDownIcon-D0B7vQZy.js";import{z as $e}from"./transition-Z_VUYpEE.js";import{C as rt}from"./clipboard-list-Cd-Q8y_q.js";import{B as lt}from"./Button-C-tWVwjP.js";import{h as ot}from"./alerts-CR3Rk7UZ.js";import{S as Fe}from"./status-CiN_pTIP.js";import"./confirmAlert-BWqzQj7I.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],dt=q("calendar",it);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Le=q("circle-check-big",ct);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ut=q("circle-x",gt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xt=q("clock",mt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ht=q("trending-down",bt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ft=q("trending-up",pt),yt=({data:t=[]})=>{if(!Array.isArray(t))return e.jsx("p",{children:"Data tidak tersedia"});const x=t.filter(a=>!isNaN(new Date(a.tanggal))),w=new Date,k=`${w.getFullYear()}-${String(w.getMonth()+1).padStart(2,"0")}-${String(w.getDate()).padStart(2,"0")}`,h=new Date(k).getFullYear(),b=a=>{const s=new Date(a);return`${String(s.getDate()).padStart(2,"0")} ${U[s.getMonth()]} ${s.getFullYear()}`},l=Pe(h),g=a=>{const p=new Date(a).getDay();return p===0||p===6},N=a=>l.includes(a),n=a=>{const s="transition-all duration-200 border-2 shadow-sm";return a.adaKegiatan?`${s} bg-green-100 border-green-500 dark:bg-green-800 dark:border-green-400`:g(a.tanggal)||N(a.tanggal)?`${s} bg-blue-100 border-blue-400 dark:bg-blue-800 dark:border-blue-300`:a.tanggal<=k?`${s} bg-yellow-100 border-yellow-400 dark:bg-yellow-800 dark:border-yellow-500`:`${s} bg-gray-50 border-gray-300 dark:bg-gray-700 dark:border-gray-600`};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 text-blue-600 dark:text-blue-400",children:"Kalender Aktivitas Harian"}),e.jsx(nt,{className:"mb-2"}),x.length===0&&e.jsx("p",{children:"Tidak ada laporan"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-7 gap-2",children:x.map(a=>{const s=new Date(a.tanggal).toLocaleDateString("id-ID",{weekday:"short"}),p=g(a.tanggal)||N(a.tanggal);return e.jsxs("div",{className:`p-3 rounded-xl text-center text-sm font-medium ${n(a)}`,children:[e.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[s,", ",b(a.tanggal)]}),p&&e.jsx("div",{className:"text-xs mt-1 font-medium text-blue-600 dark:text-blue-300"}),!p&&!a.adaKegiatan&&a.tanggal<k&&e.jsx("div",{className:"text-xs mt-1 font-medium text-yellow-700 dark:text-yellow-300"}),a.adaKegiatan&&e.jsx("div",{className:"text-xs mt-1 font-medium text-green-700 dark:text-green-200"})]},a.tanggal)})})]})},wt=({data:t})=>{if(!t)return null;const x=n=>{const a=new Date(n);return`${String(a.getDate()).padStart(2,"0")} ${U[a.getMonth()]} ${a.getFullYear()}`},[w,k]=t.tanggal.split(" - "),h=new Date(w),b=new Date(k),l=U[h.getMonth()],g=`${h.getDate()} - ${b.getDate()} ${l} ${h.getFullYear()}`,N=n=>{const a=Number(n.total??0)||0;return!!n.adaKegiatan||a>0?100:0};return e.jsxs("div",{className:"space-y-5",children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-600 dark:text-blue-400",children:"Capaian Kinerja Mingguan"}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-5 rounded-xl shadow-md space-y-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-sm font-medium",children:[e.jsxs("span",{className:"text-blue-700 dark:text-blue-300",children:[g," ",typeof t?.minggu=="number"?`(Minggu ke-${t.minggu})`:""]}),(()=>{const n=Number(t?.totalProgress||0);return e.jsxs("span",{className:"text-gray-900 dark:text-gray-100 text-base sm:text-lg font-bold",children:[n,"%",e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-600 dark:text-gray-300",children:"capaian mingguan"})]})})()]}),(()=>{const n=Number(t?.totalSelesai||0),a=Number(t?.totalTugas||0),s=Math.max(a-n,0);return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-amber-50 text-amber-700 dark:bg-amber-900 dark:text-amber-200 text-xs font-semibold",children:["Belum: ",s]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-50 text-green-700 dark:bg-green-900 dark:text-green-200 text-xs font-semibold",children:["Selesai: ",n]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-indigo-50 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-200 text-xs font-semibold",children:["Total: ",a]})]})})(),e.jsx("div",{className:"w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full",children:e.jsx("div",{className:"h-3 bg-blue-500 rounded-full transition-all duration-300",title:`${Number(t?.totalProgress||0)}% = ${Number(t?.totalSelesai||0)}/${Number(t?.totalTugas||0)} selesai`,"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Number(t?.totalProgress||0),"aria-valuetext":`${Number(t?.totalProgress||0)} persen capaian mingguan`,style:{width:`${Number(t?.totalProgress||0)}%`}})})]}),e.jsx("div",{className:"space-y-3",children:t.detail?.filter(n=>{const a=new Date(n.tanggal).getDay();return a>=1&&a<=5||n.total>0}).map(n=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm hover:shadow transition",children:[e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsxs("span",{className:"text-gray-800 dark:text-gray-100",children:[n.hari,", ",x(n.tanggal)]}),(()=>{const a=N(n)===100;return e.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-600 dark:text-gray-300",children:[a?e.jsx(Le,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx(ut,{className:"w-4 h-4 text-red-500 dark:text-red-400"}),a?"Ada laporan":"Tidak ada laporan"]})})()]}),e.jsx("div",{className:"w-full h-2.5 bg-gray-200 dark:bg-gray-700 rounded-full mt-2",children:e.jsx("div",{className:"h-2.5 bg-blue-500 rounded-full transition-all duration-300",style:{width:`${N(n)}%`},title:`${n.hari}: ${N(n)}%`})})]},n.tanggal))})]})},kt=({data:t=[],year:x=new Date().getFullYear()})=>{const w=new Date().getMonth(),k=U[w],h=Ze(),b=l=>{const g=new Date,n=x===g.getFullYear()&&l===g.getMonth()?st(g):1;h(`/monitoring?tab=mingguan&year=${x}&month=${l+1}&week=${n}`)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-600 dark:text-blue-400",children:"Capaian Kinerja Bulanan"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:t.map((l,g)=>{const N=l.persen>=85?"text-green-600 dark:text-green-400":l.persen>=60?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",n=String(l.bulan).toLowerCase()===String(k).toLowerCase(),a=g>0?Number(t[g-1]?.persen||0):null,s=Number(l.persen||0),p=a===null?null:s-a,W=p==null?Te:p>0?ft:p<0?ht:Te,_=p==null?"text-gray-500 dark:text-gray-400":p>0?"text-green-600 dark:text-green-400":p<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400";return e.jsxs("div",{className:`p-4 rounded-xl shadow transition hover:shadow-md border ${n?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700":"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700"}`,title:`${l.bulan}: ${s}% capaian`,role:"button",tabIndex:0,onClick:()=>b(g),onKeyDown:O=>{(O.key==="Enter"||O.key===" ")&&b(g)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-base font-semibold text-gray-800 dark:text-gray-100",children:l.bulan}),e.jsxs("div",{className:`flex items-center gap-1 text-xs font-semibold ${_}`,children:[e.jsx(W,{className:"w-3.5 h-3.5"}),p==null?"â€”":`${p>0?"+":""}${p}`]})]}),e.jsxs("div",{className:`text-2xl font-bold text-center ${N}`,children:[s,"%"]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500 dark:text-gray-400",children:"capaian"}),e.jsx("div",{className:"w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full mt-2",children:e.jsx("div",{className:"h-3 bg-blue-500 rounded-full transition-all duration-300",style:{width:`${s}%`}})})]},l.bulan)})})]})},Nt=({dailyData:t,weeklyList:x=[],weekIndex:w=0,onWeekChange:k,monthIndex:h=0,onMonthChange:b,monthlyData:l,year:g,onYearChange:N})=>{const[n,a]=m.useState("harian"),s=x.length?Math.min(Math.max(w,0),x.length-1):0,p=new Date().getFullYear(),W=Array.from({length:5},(i,y)=>p-y),_=m.useCallback(()=>{switch(n){case"harian":return e.jsx(yt,{data:t});case"mingguan":return e.jsx(wt,{data:x[s]});case"bulanan":return e.jsx(kt,{data:l,year:g});default:return null}},[n,t,x,s,l,g]),O=m.useCallback(i=>a(i),[]);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsx("div",{className:"flex gap-2",role:"tablist",children:["harian","mingguan","bulanan"].map(i=>e.jsx("button",{onClick:()=>O(i),role:"tab","aria-selected":n===i,className:`px-4 py-2 rounded-lg font-semibold capitalize transition text-sm
                ${n===i?"bg-blue-600 text-white shadow":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100"}`,children:i},i))}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx(F,{value:g,onChange:N,children:e.jsxs("div",{className:"relative w-28",children:[e.jsxs(F.Button,{className:`w-full cursor-pointer rounded-lg bg-gray-50 dark:bg-gray-800
                    py-2 pl-4 pr-10 text-sm text-center border border-gray-300 dark:border-gray-600
                    shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("span",{className:"block truncate",children:g}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(De,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx($e,{as:m.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(F.Options,{className:`absolute z-50 mt-1 max-h-60 w-full overflow-auto
                      rounded-md bg-white dark:bg-gray-700 py-1 text-sm shadow-lg ring-1 ring-black ring-opacity-5`,children:W.map(i=>e.jsx(F.Option,{value:i,className:({active:y})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${y?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:y})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${y?"font-medium":"font-normal"}`,children:i}),y&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Se,{className:"h-5 w-5"})})]})},i))})})]})}),["harian","mingguan"].includes(n)&&e.jsx(F,{value:h,onChange:b,children:e.jsxs("div",{className:"relative w-36",children:[e.jsxs(F.Button,{className:`w-full cursor-pointer rounded-lg bg-gray-50 dark:bg-gray-800
                    py-2 pl-4 pr-10 text-sm text-center border border-gray-300 dark:border-gray-600
                    shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("span",{className:"block truncate",children:U[h]}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(De,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx($e,{as:m.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(F.Options,{className:`absolute z-50 mt-1 max-h-60 w-full overflow-auto
                      rounded-md bg-white dark:bg-gray-700 py-1 text-sm shadow-lg ring-1 ring-black ring-opacity-5`,children:U.map((i,y)=>e.jsx(F.Option,{value:y,className:({active:$})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${$?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:$})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${$?"font-medium":"font-normal"}`,children:i}),$&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Se,{className:"h-5 w-5"})})]})},y))})})]})}),n==="mingguan"&&x.length>0&&e.jsx(F,{value:s,onChange:k,children:e.jsxs("div",{className:"relative w-32",children:[e.jsxs(F.Button,{className:`w-full cursor-pointer rounded-lg bg-gray-50 dark:bg-gray-800
                      py-2 pl-4 pr-10 text-sm text-center border border-gray-300 dark:border-gray-600
                      shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsxs("span",{className:"block truncate",children:["Minggu ",x[s]?.minggu]}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(De,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx($e,{as:m.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(F.Options,{className:`absolute z-50 mt-1 max-h-60 w-full overflow-auto
                        rounded-md bg-white dark:bg-gray-700 py-1 text-sm shadow-lg ring-1 ring-black ring-opacity-5`,children:x.map((i,y)=>e.jsx(F.Option,{value:y,className:({active:$})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${$?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:$})=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`block truncate ${$?"font-medium":"font-normal"}`,children:["Minggu ",i.minggu]}),$&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Se,{className:"h-5 w-5"})})]})},y))})})]})})]})]}),e.jsx("div",{children:_()})]})},jt=m.memo(Nt),vt=({weeklyData:t,reportedToday:x=!1,countOverride:w=null,activeDate:k=null})=>{if(!t)return null;let h=0;if(k){const i=t.detail?.find(X=>X.tanggal===k)||{},y=Number(i.selesai)||0,$=Number(i.sedang??i.proses??0)||0,G=i.total!==void 0&&i.belum!==void 0?Math.max((Number(i.total)||0)-(Number(i.belum)||0)-y,0):0;h=y+($||G),!h&&x&&(h=1),typeof w=="number"&&(h=w)}const b=t.penugasan||{},l=t.tambahan||{},g=(b.total||0)+(l.total||0),N=(b.selesai||0)+(l.selesai||0),n=b.belum!==void 0?b.belum:Math.max((b.total||0)-(b.selesai||0),0),a=l.belum!==void 0?l.belum:Math.max((l.total||0)-(l.selesai||0),0),s=Math.max(n+a,0),p="p-4 rounded-xl shadow-md text-center transition hover:shadow-lg",W="text-sm text-gray-600 dark:text-gray-300",_="text-3xl font-bold",O=[{label:"Laporan Hari Ini",value:h,bg:"bg-blue-50 dark:bg-blue-900",color:"text-blue-600 dark:text-blue-200",icon:e.jsx(dt,{className:"w-5 h-5 text-blue-500 dark:text-blue-300"})},{label:"Tugas Minggu Ini",value:g,bg:"bg-indigo-50 dark:bg-indigo-900",color:"text-indigo-600 dark:text-indigo-200",icon:e.jsx(rt,{className:"w-5 h-5 text-indigo-500 dark:text-indigo-300"})},{label:"Belum Selesai",value:s,bg:"bg-yellow-50 dark:bg-yellow-900",color:"text-yellow-600 dark:text-yellow-200",icon:e.jsx(xt,{className:"w-5 h-5 text-yellow-500 dark:text-yellow-300"})},{label:"Selesai",value:N,bg:"bg-green-50 dark:bg-green-900",color:"text-green-600 dark:text-green-200",icon:e.jsx(Le,{className:"w-5 h-5 text-green-500 dark:text-green-300"})}];return e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:O.map(({label:i,value:y,bg:$,color:G,icon:X})=>e.jsxs("div",{className:`${p} ${$}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[X,e.jsx("span",{className:W,children:i})]}),e.jsx("p",{className:`${_} ${G}`,children:y})]},i))})},v=t=>{const x=t.getFullYear(),w=String(t.getMonth()+1).padStart(2,"0"),k=String(t.getDate()).padStart(2,"0");return`${x}-${w}-${k}`},Dt=(t,x)=>{const w=new Date(x,t,1),k=new Date(x,t+1,0),h=[],b=new Date(w);b.setDate(b.getDate()-(b.getDay()+6)%7);for(let l=new Date(b);l<=k;l.setDate(l.getDate()+7))h.push(new Date(l));return h},Ot=()=>{const{user:t}=et(),[x,w]=m.useState([]),[k,h]=m.useState([]),[b,l]=m.useState([]),[g,N]=m.useState(0),[n,a]=m.useState(new Date().getMonth()),[s,p]=m.useState(new Date().getFullYear()),[W,_]=m.useState([]),[O,i]=m.useState(!0),[y,$]=m.useState(""),[G,X]=m.useState(!1),[Ee,Re]=m.useState(!1),[Ke,me]=m.useState(null),[se,Ye]=m.useState(!0),xe=m.useRef({monthIndex:-1,year:-1}),_e=m.useCallback(P=>{N(0),a(D=>D!==P?P:D)},[]),Oe=m.useCallback(P=>{N(D=>D!==P?P:D)},[]),We=m.useCallback(P=>{N(0),p(D=>D!==P?P:D)},[]);if(m.useEffect(()=>{h([]),(async()=>{const D=new Date,Me=v(D),B=n,L=new Date(s,B,1),z=new Date(s,B+1,0),T=Dt(B,s);let E=T.findIndex(M=>{const le=new Date(M);return le.setDate(M.getDate()+6),D>=M&&D<=le});E===-1&&(E=0);const Ie=B===D.getMonth()&&s===D.getFullYear()&&g===E;Ye(Ie);try{const M={};t?.role===ue.ANGGOTA&&(M.userId=t.id),t?.role===ue.KETUA&&t?.teamId&&(M.teamId=t.teamId);const le=[Y.get("/monitoring/penugasan/minggu",{params:{minggu:v(T[E]),...M}}).then(c=>c.data)],Je=[Y.get("/monitoring/penugasan/minggu",{params:{minggu:v(T[E]),userId:t?.id}}).then(c=>c.data)],Ve=t?.role===ue.ADMIN||t?.role===ue.PIMPINAN?Y.get("/tugas-tambahan/all",{params:{teamId:M.teamId||void 0}}):Y.get("/tugas-tambahan",{params:{teamId:M.teamId||void 0}}),[Ge,,Ue,be,he,,pe,Ae,Ce]=await Promise.allSettled([Y.get("/monitoring/harian",{params:{tanggal:v(L),...M}}),Promise.resolve([]),Y.get("/monitoring/bulanan",{params:{year:String(s),...M}}),Promise.allSettled(le),Ve,Promise.resolve([]),Promise.allSettled(Je),Y.get("/monitoring/harian",{params:{tanggal:v(L),userId:t?.id}}),Y.get("/monitoring/bulanan",{params:{year:String(s),userId:t?.id}})]);let H=!1;const fe=Ae.status==="fulfilled"?Ae:Ge;let ye=[];if(fe.status==="fulfilled"){const o=(Array.isArray(fe.value.data)?fe.value.data.filter(d=>d.tanggal&&!isNaN(new Date(d.tanggal))):[]).reduce((d,r)=>{const f=v(new Date(r.tanggal));return d[f]={...r,tanggal:f},d},{}),u=[];for(let d=new Date(L);d<=z;d.setDate(d.getDate()+1)){const r=v(new Date(d));u.push(o[r]||{adaKegiatan:!1,tanggal:r})}w(u),ye=u,X(!!u.find(d=>d.tanggal===Me)?.adaKegiatan)}else H=!0;let oe=[];be.status==="fulfilled"?(oe=Array.from({length:T.length},(c,o)=>o===E?be.value[0]:{status:"fulfilled",value:{}}),be.value.some(c=>c.status==="rejected")&&(H=!0)):H=!0;let St=[],ie=[];pe.status==="fulfilled"?(ie=Array.from({length:T.length},(c,o)=>o===E?pe.value[0]:{status:"fulfilled",value:{}}),pe.value.some(c=>c.status==="rejected")&&(H=!0)):H=!0;const we=he.status==="fulfilled"&&Array.isArray(he.value.data)?he.value.data:[],Q=T.map((c,o)=>{const u=oe[o]&&oe[o].status==="fulfilled"?oe[o].value:{},d=new Date(T[o]),r=new Date(T[o]);r.setDate(d.getDate()+6);const f=we.filter(j=>{if(!j?.tanggal)return!1;const S=new Date(j.tanggal);return S>=L&&S<=z&&S>=d&&S<=r}),I=f.length,A=f.filter(j=>j.status===Fe.SELESAI_DIKERJAKAN).length,R=Math.max(I-A,0),ee=new Date(d<L?L:d),te=new Date(r>z?z:r),Ne=`${v(ee)} - ${v(te)}`,J=[];for(let j=new Date(ee);j<=te;j.setDate(j.getDate()+1)){const S=v(new Date(j)),V=(ye||[]).find(Qe=>Qe.tanggal===S),je=j.toLocaleDateString("id-ID",{weekday:"long"}),ve=!!V?.adaKegiatan;J.push({tanggal:S,hari:je,total:ve?1:0,selesai:0,persen:ve?100:0,adaKegiatan:ve})}const ae=Number(u?.total??u?.totalTugas??0)||0,de=Number(u?.selesai??u?.done??0)||0,ce=ae||de?de:J.reduce((j,S)=>j+(S.selesai||0),0),ne=ae||de?ae:J.reduce((j,S)=>j+(S.total||0),0),ge=ce+A,C=ne+I,K=C?Math.round(ge/C*100):0;return{minggu:o+1,tanggal:Ne,detail:J,totalSelesai:ge,totalTugas:C,totalProgress:K,penugasan:u,tambahan:{total:I,selesai:A,belum:R}}});if(h(Q),xe.current.monthIndex!==B||xe.current.year!==s){const o=B===D.getMonth()&&s===D.getFullYear()?E:0;N(o),xe.current={monthIndex:B,year:s}}const qe=c=>c?.userId??c?.pegawaiId??c?.user?.id??c?.pegawai?.id??c?.id??null,Xe=T.map((c,o)=>{const u=ie[o]&&ie[o].status==="fulfilled"?ie[o].value:{},d=new Date(T[o]),r=new Date(T[o]);r.setDate(d.getDate()+6);const f=(Array.isArray(we)?we:[]).filter(C=>{if(!C?.tanggal)return!1;const K=new Date(C.tanggal),j=K>=L&&K<=z&&K>=d&&K<=r,S=qe(C),V=S!=null&&t?.id!=null&&String(S)===String(t.id);return j&&V}),I=f.length,A=f.filter(C=>C.status===Fe.SELESAI_DIKERJAKAN).length,R=Math.max(I-A,0),ee=new Date(d<L?L:d),te=new Date(r>z?z:r),Ne=`${v(ee)} - ${v(te)}`,J=[];for(let C=new Date(ee);C<=te;C.setDate(C.getDate()+1)){const K=v(new Date(C)),j=(ye||[]).find(je=>je.tanggal===K),S=C.toLocaleDateString("id-ID",{weekday:"long"}),V=!!j?.adaKegiatan;J.push({tanggal:K,hari:S,total:V?1:0,selesai:0,persen:V?100:0,adaKegiatan:V})}const ae=Number(u?.total??u?.totalTugas??0)||0,ce=(Number(u?.selesai??u?.done??0)||0)+A,ne=ae+I,ge=ne?Math.round(ce/ne*100):0;return{minggu:o+1,tanggal:Ne,detail:J,totalSelesai:ce,totalTugas:ne,totalProgress:ge,penugasan:u,tambahan:{total:I,selesai:A,belum:R}}});l(Xe);try{if(t?.id&&Ie){const c=v(T[E]||new Date);let o=0;try{const u=await Y.get("/monitoring/mingguan",{params:{minggu:c,userId:t.id}}),r=(Array.isArray(u.data?.detail)?u.data.detail:[]).find(f=>v(new Date(f.tanggal))===Me);if(r){const f=Number(r.selesai||0),I=Number(r.total||0),A=Number(r.belum||0),R=Number((r.sedang??r.proses??Math.max(I-f-A,0))||0);o=f+R}}catch{o=0}me(o)}else me(null)}catch{me(null)}const ke=Ce.status==="fulfilled"?Ce:Ue,Z=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];if(ke.status==="fulfilled"){const c=Array.isArray(ke.value.data)?ke.value.data:[],o=new Map;c.forEach((r,f)=>{if(typeof r=="number")o.set(Z[f],Number(r)||0);else if(r&&typeof r=="object"){const I=r.bulan||Z[f],A=Number(r.persen??r.value??0)||0;o.set(I,A)}});const u=Z.map(r=>({bulan:r,persen:o.get(r)??0})),d=Array.isArray(Q)?Q:[];if(d.length){const r=d.reduce((A,R)=>A+(Number(R?.totalProgress)||0),0),f=d.length,I=f?Math.round(r/f):0;u[n]={bulan:Z[n],persen:I}}_(u)}else{const c=Array.isArray(Q)?Q:[],o=Z.map((u,d)=>{if(d===n&&c.length){const r=c.reduce((A,R)=>A+(Number(R?.totalProgress)||0),0),f=c.length,I=f?Math.round(r/f):0;return{bulan:u,persen:I}}return{bulan:u,persen:0}});_(o),H=!0}H&&Re(!0)}catch(M){M?.response&&[401,403].includes(M.response.status)&&$("Anda tidak memiliki akses untuk melihat monitoring."),ot(M,"Gagal mengambil data monitoring")}finally{i(!1)}})()},[t?.id,t?.role,t?.teamId,n,s,g]),O)return e.jsx(tt,{fullScreen:!0});if(y)return e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-red-500 dark:text-red-400",children:y})});const re=new Date,Be=re.getDay()===0||re.getDay()===6,ze=Pe(re.getFullYear()).includes(v(re)),He=se&&!G&&!Be&&!ze;return e.jsxs("div",{className:"w-full max-w-7xl mx-auto space-y-6 animate-fade-in",children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Selamat datang, ",t?.nama||"Pengguna","! ðŸ‘‹"]}),He&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900 border border-yellow-300 dark:border-yellow-700 p-6 rounded-xl shadow text-center animate-pulse",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-yellow-800 dark:text-yellow-200 mb-2",children:"Anda belum mengisi laporan kegiatan harian hari ini."}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:"Ayo segera lengkapi agar progres Anda tetap tercatat."}),e.jsx(at,{to:"/tugas-mingguan",children:e.jsx(lt,{variant:"primary",className:"font-semibold w-fit mx-auto",children:"Isi Laporan Sekarang"})})]}),Ee&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900 border border-red-300 dark:border-red-700 p-4 rounded-xl text-red-800 dark:text-red-200",children:"Sebagian data gagal dimuat. Beberapa informasi mungkin tidak lengkap."}),e.jsx(vt,{weeklyData:b[g],reportedToday:se&&G,countOverride:se?Ke:null,activeDate:se?v(new Date):null}),e.jsx(jt,{dailyData:x,weeklyList:b.length?b:k,weekIndex:g,onWeekChange:Oe,monthIndex:n,onMonthChange:_e,monthlyData:W,year:s,onYearChange:We})]})};export{Ot as default};
