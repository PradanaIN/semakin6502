import{c as Q,j as e,a as st,r as m,u as rt,L as lt,d as ot,R as he,b as K}from"./index-tHDgc07s.js";import{g as Ke}from"./holidays-BznbYqFv.js";import{L as it}from"./Legend-DzHsNs64.js";import{m as X}from"./months-C0Ia_Adi.js";import{g as dt}from"./dateUtils-51te1x9i.js";import{M as Re}from"./minus-BTvEc0Zs.js";import{w as F,F as Ae,a as Ce}from"./ChevronUpDownIcon-B5dk51oI.js";import{z as Te}from"./transition-Ca9_kCyg.js";import{C as ct}from"./clipboard-list-6sVYLlld.js";import{B as gt}from"./Button-DTOqL5YY.js";import{h as ut}from"./alerts-D6uugUBg.js";import{S as Ye}from"./status-DdjLpvCM.js";import"./confirmAlert-BWqzQj7I.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],xt=Q("calendar",mt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],_e=Q("circle-check-big",bt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],pt=Q("circle-x",ht);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],yt=Q("clock",ft);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],kt=Q("trending-down",wt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],jt=Q("trending-up",Nt),vt=({data:t=[]})=>{if(!Array.isArray(t))return e.jsx("p",{children:"Data tidak tersedia"});const g=t.filter(a=>!isNaN(new Date(a.tanggal))),k=new Date,y=`${k.getFullYear()}-${String(k.getMonth()+1).padStart(2,"0")}-${String(k.getDate()).padStart(2,"0")}`,p=new Date(y).getFullYear(),x=a=>{const s=new Date(a);return`${String(s.getDate()).padStart(2,"0")} ${X[s.getMonth()]} ${s.getFullYear()}`},i=Ke(p),u=a=>{const b=new Date(a).getDay();return b===0||b===6},N=a=>i.includes(a),n=a=>{const s="transition-all duration-200 border-2 shadow-sm";return a.adaKegiatan?`${s} bg-green-100 border-green-500 dark:bg-green-800 dark:border-green-400`:u(a.tanggal)||N(a.tanggal)?`${s} bg-blue-100 border-blue-400 dark:bg-blue-800 dark:border-blue-300`:a.tanggal<=y?`${s} bg-yellow-100 border-yellow-400 dark:bg-yellow-800 dark:border-yellow-500`:`${s} bg-gray-50 border-gray-300 dark:bg-gray-700 dark:border-gray-600`};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 text-blue-600 dark:text-blue-400",children:"Kalender Aktivitas Harian"}),e.jsx(it,{className:"mb-2"}),g.length===0&&e.jsx("p",{children:"Tidak ada laporan"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-7 gap-2",children:g.map(a=>{const s=new Date(a.tanggal).toLocaleDateString("id-ID",{weekday:"short"}),b=u(a.tanggal)||N(a.tanggal);return e.jsxs("div",{className:`p-3 rounded-xl text-center text-sm font-medium ${n(a)}`,children:[e.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[s,", ",x(a.tanggal)]}),b&&e.jsx("div",{className:"text-xs mt-1 font-medium text-blue-600 dark:text-blue-300"}),!b&&!a.adaKegiatan&&a.tanggal<y&&e.jsx("div",{className:"text-xs mt-1 font-medium text-yellow-700 dark:text-yellow-300"}),a.adaKegiatan&&e.jsx("div",{className:"text-xs mt-1 font-medium text-green-700 dark:text-green-200"})]},a.tanggal)})})]})},Dt=({data:t})=>{if(!t)return null;const g=n=>{const a=new Date(n);return`${String(a.getDate()).padStart(2,"0")} ${X[a.getMonth()]} ${a.getFullYear()}`},[k,y]=t.tanggal.split(" - "),p=new Date(k),x=new Date(y),i=X[p.getMonth()],u=`${p.getDate()} - ${x.getDate()} ${i} ${p.getFullYear()}`,N=n=>{const a=Number(n.total??0)||0;return!!n.adaKegiatan||a>0?100:0};return e.jsxs("div",{className:"space-y-5",children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-600 dark:text-blue-400",children:"Capaian Kinerja Mingguan"}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-5 rounded-xl shadow-md space-y-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-sm font-medium",children:[e.jsxs("span",{className:"text-blue-700 dark:text-blue-300",children:[u," ",typeof t?.minggu=="number"?`(Minggu ke-${t.minggu})`:""]}),(()=>{const n=Number(t?.totalProgress||0);return e.jsxs("span",{className:"text-gray-900 dark:text-gray-100 text-base sm:text-lg font-bold",children:[n,"%",e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-600 dark:text-gray-300",children:"capaian mingguan"})]})})()]}),(()=>{const n=Number(t?.totalSelesai||0),a=Number(t?.totalTugas||0),s=Math.max(a-n,0);return Array.isArray(t?.detail)&&t.detail.filter(b=>b?.adaKegiatan).length,Array.isArray(t?.detail)&&t.detail.length,e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-amber-50 text-amber-700 dark:bg-amber-900 dark:text-amber-200 text-xs font-semibold",children:["Belum: ",s]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-50 text-green-700 dark:bg-green-900 dark:text-green-200 text-xs font-semibold",children:["Selesai: ",n]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-indigo-50 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-200 text-xs font-semibold",children:["Total: ",a]})]})})(),e.jsx("div",{className:"w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full",children:e.jsx("div",{className:"h-3 bg-blue-500 rounded-full transition-all duration-300",title:`${Number(t?.totalProgress||0)}% = ${Number(t?.totalSelesai||0)}/${Number(t?.totalTugas||0)} selesai`,"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Number(t?.totalProgress||0),"aria-valuetext":`${Number(t?.totalProgress||0)} persen capaian mingguan`,style:{width:`${Number(t?.totalProgress||0)}%`}})})]}),e.jsx("div",{className:"space-y-3",children:t.detail?.filter(n=>{const a=new Date(n.tanggal).getDay();return a>=1&&a<=5||n.total>0}).map(n=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm hover:shadow transition",children:[e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsxs("span",{className:"text-gray-800 dark:text-gray-100",children:[n.hari,", ",g(n.tanggal)]}),(()=>{const a=N(n)===100;return e.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-600 dark:text-gray-300",children:[a?e.jsx(_e,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx(pt,{className:"w-4 h-4 text-red-500 dark:text-red-400"}),a?"Ada laporan":"Tidak ada laporan"]})})()]}),e.jsx("div",{className:"w-full h-2.5 bg-gray-200 dark:bg-gray-700 rounded-full mt-2",children:e.jsx("div",{className:"h-2.5 bg-blue-500 rounded-full transition-all duration-300",style:{width:`${N(n)}%`},title:`${n.hari}: ${N(n)}%`})})]},n.tanggal))})]})},St=({data:t=[],year:g=new Date().getFullYear()})=>{const k=new Date().getMonth(),y=X[k],p=st(),x=i=>{const u=new Date,n=g===u.getFullYear()&&i===u.getMonth()?dt(u):1;p(`/monitoring?tab=mingguan&year=${g}&month=${i+1}&week=${n}`)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-600 dark:text-blue-400",children:"Capaian Kinerja Bulanan"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:t.map((i,u)=>{const N=i.persen>=85?"text-green-600 dark:text-green-400":i.persen>=60?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",n=String(i.bulan).toLowerCase()===String(y).toLowerCase(),a=u>0?Number(t[u-1]?.persen||0):null,s=Number(i.persen||0),b=a===null?null:s-a,B=b==null?Re:b>0?jt:b<0?kt:Re,_=b==null?"text-gray-500 dark:text-gray-400":b>0?"text-green-600 dark:text-green-400":b<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400";return e.jsxs("div",{className:`p-4 rounded-xl shadow transition hover:shadow-md border ${n?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700":"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700"}`,title:`${i.bulan}: ${s}% capaian`,role:"button",tabIndex:0,onClick:()=>x(u),onKeyDown:O=>{(O.key==="Enter"||O.key===" ")&&x(u)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-base font-semibold text-gray-800 dark:text-gray-100",children:i.bulan}),e.jsxs("div",{className:`flex items-center gap-1 text-xs font-semibold ${_}`,children:[e.jsx(B,{className:"w-3.5 h-3.5"}),b==null?"â€”":`${b>0?"+":""}${b}`]})]}),e.jsxs("div",{className:`text-2xl font-bold text-center ${N}`,children:[s,"%"]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500 dark:text-gray-400",children:"capaian"}),e.jsx("div",{className:"w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full mt-2",children:e.jsx("div",{className:"h-3 bg-blue-500 rounded-full transition-all duration-300",style:{width:`${s}%`}})})]},i.bulan)})})]})},$t=({dailyData:t,weeklyList:g=[],weekIndex:k=0,onWeekChange:y,monthIndex:p=0,onMonthChange:x,monthlyData:i,year:u,onYearChange:N})=>{const[n,a]=m.useState("harian"),s=g.length?Math.min(Math.max(k,0),g.length-1):0,b=new Date().getFullYear(),B=Array.from({length:5},(d,f)=>b-f),_=m.useCallback(()=>{switch(n){case"harian":return e.jsx(vt,{data:t});case"mingguan":return e.jsx(Dt,{data:g[s]});case"bulanan":return e.jsx(St,{data:i,year:u});default:return null}},[n,t,g,s,i]),O=m.useCallback(d=>a(d),[]);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsx("div",{className:"flex gap-2",role:"tablist",children:["harian","mingguan","bulanan"].map(d=>e.jsx("button",{onClick:()=>O(d),role:"tab","aria-selected":n===d,className:`px-4 py-2 rounded-lg font-semibold capitalize transition text-sm
                ${n===d?"bg-blue-600 text-white shadow":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100"}`,children:d},d))}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx(F,{value:u,onChange:N,children:e.jsxs("div",{className:"relative w-28",children:[e.jsxs(F.Button,{className:`w-full cursor-pointer rounded-lg bg-gray-50 dark:bg-gray-800\r
                    py-2 pl-4 pr-10 text-sm text-center border border-gray-300 dark:border-gray-600\r
                    shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("span",{className:"block truncate",children:u}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(Ae,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx(Te,{as:m.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(F.Options,{className:`absolute z-50 mt-1 max-h-60 w-full overflow-auto\r
                      rounded-md bg-white dark:bg-gray-700 py-1 text-sm shadow-lg ring-1 ring-black ring-opacity-5`,children:B.map(d=>e.jsx(F.Option,{value:d,className:({active:f})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${f?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:f})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${f?"font-medium":"font-normal"}`,children:d}),f&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ce,{className:"h-5 w-5"})})]})},d))})})]})}),["harian","mingguan"].includes(n)&&e.jsx(F,{value:p,onChange:x,children:e.jsxs("div",{className:"relative w-36",children:[e.jsxs(F.Button,{className:`w-full cursor-pointer rounded-lg bg-gray-50 dark:bg-gray-800\r
                    py-2 pl-4 pr-10 text-sm text-center border border-gray-300 dark:border-gray-600\r
                    shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("span",{className:"block truncate",children:X[p]}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(Ae,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx(Te,{as:m.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(F.Options,{className:`absolute z-50 mt-1 max-h-60 w-full overflow-auto\r
                      rounded-md bg-white dark:bg-gray-700 py-1 text-sm shadow-lg ring-1 ring-black ring-opacity-5`,children:X.map((d,f)=>e.jsx(F.Option,{value:f,className:({active:M})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${M?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:M})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${M?"font-medium":"font-normal"}`,children:d}),M&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ce,{className:"h-5 w-5"})})]})},f))})})]})}),n==="mingguan"&&g.length>0&&e.jsx(F,{value:s,onChange:y,children:e.jsxs("div",{className:"relative w-32",children:[e.jsxs(F.Button,{className:`w-full cursor-pointer rounded-lg bg-gray-50 dark:bg-gray-800\r
                      py-2 pl-4 pr-10 text-sm text-center border border-gray-300 dark:border-gray-600\r
                      shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsxs("span",{className:"block truncate",children:["Minggu ",g[s]?.minggu]}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(Ae,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx(Te,{as:m.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(F.Options,{className:`absolute z-50 mt-1 max-h-60 w-full overflow-auto\r
                        rounded-md bg-white dark:bg-gray-700 py-1 text-sm shadow-lg ring-1 ring-black ring-opacity-5`,children:g.map((d,f)=>e.jsx(F.Option,{value:f,className:({active:M})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${M?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:M})=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`block truncate ${M?"font-medium":"font-normal"}`,children:["Minggu ",d.minggu]}),M&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ce,{className:"h-5 w-5"})})]})},f))})})]})})]})]}),e.jsx("div",{children:_()})]})},Mt=m.memo($t),It=({weeklyData:t,reportedToday:g=!1,countOverride:k=null,activeDate:y=null})=>{if(!t)return null;let p=0;if(y){const d=t.detail?.find(Z=>Z.tanggal===y)||{},f=Number(d.selesai)||0,M=Number(d.sedang??d.proses??0)||0,G=d.total!==void 0&&d.belum!==void 0?Math.max((Number(d.total)||0)-(Number(d.belum)||0)-f,0):0;p=f+(M||G),!p&&g&&(p=1),typeof k=="number"&&(p=k)}const x=t.penugasan||{},i=t.tambahan||{},u=(x.total||0)+(i.total||0),N=(x.selesai||0)+(i.selesai||0),n=x.belum!==void 0?x.belum:Math.max((x.total||0)-(x.selesai||0),0),a=i.belum!==void 0?i.belum:Math.max((i.total||0)-(i.selesai||0),0),s=Math.max(n+a,0),b="p-4 rounded-xl shadow-md text-center transition hover:shadow-lg",B="text-sm text-gray-600 dark:text-gray-300",_="text-3xl font-bold",O=[{label:"Laporan Hari Ini",value:p,bg:"bg-blue-50 dark:bg-blue-900",color:"text-blue-600 dark:text-blue-200",icon:e.jsx(xt,{className:"w-5 h-5 text-blue-500 dark:text-blue-300"})},{label:"Tugas Minggu Ini",value:u,bg:"bg-indigo-50 dark:bg-indigo-900",color:"text-indigo-600 dark:text-indigo-200",icon:e.jsx(ct,{className:"w-5 h-5 text-indigo-500 dark:text-indigo-300"})},{label:"Belum Selesai",value:s,bg:"bg-yellow-50 dark:bg-yellow-900",color:"text-yellow-600 dark:text-yellow-200",icon:e.jsx(yt,{className:"w-5 h-5 text-yellow-500 dark:text-yellow-300"})},{label:"Selesai",value:N,bg:"bg-green-50 dark:bg-green-900",color:"text-green-600 dark:text-green-200",icon:e.jsx(_e,{className:"w-5 h-5 text-green-500 dark:text-green-300"})}];return e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:O.map(({label:d,value:f,bg:M,color:G,icon:Z})=>e.jsxs("div",{className:`${b} ${M}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[Z,e.jsx("span",{className:B,children:d})]}),e.jsx("p",{className:`${_} ${G}`,children:f})]},d))})},$=t=>{const g=t.getFullYear(),k=String(t.getMonth()+1).padStart(2,"0"),y=String(t.getDate()).padStart(2,"0");return`${g}-${k}-${y}`},At=(t,g)=>{const k=new Date(g,t,1),y=new Date(g,t+1,0),p=[],x=new Date(k);x.setDate(x.getDate()-(x.getDay()+6)%7);for(let i=new Date(x);i<=y;i.setDate(i.getDate()+7))p.push(new Date(i));return p},Ht=()=>{const{user:t}=rt(),[g,k]=m.useState([]),[y,p]=m.useState([]),[x,i]=m.useState([]),[u,N]=m.useState(0),[n,a]=m.useState(new Date().getMonth()),[s,b]=m.useState(new Date().getFullYear()),[B,_]=m.useState([]),[O,d]=m.useState(!0),[f,M]=m.useState(""),[G,Z]=m.useState(!1),[Oe,We]=m.useState(!1),[Be,pe]=m.useState(null),[le,ze]=m.useState(!0),fe=m.useRef({monthIndex:-1,year:-1}),He=m.useCallback(R=>{N(0),a(D=>D!==R?R:D)},[]),Je=m.useCallback(R=>{N(D=>D!==R?R:D)},[]),Ve=m.useCallback(R=>{N(0),b(D=>D!==R?R:D)},[]);if(m.useEffect(()=>{p([]),(async()=>{const D=new Date,Pe=$(D),z=n,E=new Date(s,z,1),W=new Date(s,z+1,0),L=At(z,s);let Y=L.findIndex(I=>{const ie=new Date(I);return ie.setDate(I.getDate()+6),D>=I&&D<=ie});Y===-1&&(Y=0);const Fe=z===D.getMonth()&&s===D.getFullYear()&&u===Y;ze(Fe);try{const I={};t?.role===he.ANGGOTA&&(I.userId=t.id),t?.role===he.KETUA&&t?.teamId&&(I.teamId=t.teamId);const ie=[K.get("/monitoring/penugasan/minggu",{params:{minggu:$(L[Y]),...I}}).then(c=>c.data)],Xe=[K.get("/monitoring/penugasan/minggu",{params:{minggu:$(L[Y]),userId:t?.id}}).then(c=>c.data)],Qe=t?.role===he.ADMIN||t?.role===he.PIMPINAN?K.get("/tugas-tambahan/all",{params:{teamId:I.teamId||void 0}}):K.get("/tugas-tambahan",{params:{teamId:I.teamId||void 0}}),[Ze,,et,ye,we,,ke,Le,Ee]=await Promise.allSettled([K.get("/monitoring/harian",{params:{tanggal:$(E),...I}}),Promise.resolve([]),K.get("/monitoring/bulanan",{params:{year:String(s),...I}}),Promise.allSettled(ie),Qe,Promise.resolve([]),Promise.allSettled(Xe),K.get("/monitoring/harian",{params:{tanggal:$(E),userId:t?.id}}),K.get("/monitoring/bulanan",{params:{year:String(s),userId:t?.id}})]);let H=!1;const Ne=Le.status==="fulfilled"?Le:Ze;let je=[];if(Ne.status==="fulfilled"){const o=(Array.isArray(Ne.value.data)?Ne.value.data.filter(r=>r.tanggal&&!isNaN(new Date(r.tanggal))):[]).reduce((r,l)=>{const h=$(new Date(l.tanggal));return r[h]={...l,tanggal:h},r},{}),w=[];for(let r=new Date(E);r<=W;r.setDate(r.getDate()+1)){const l=$(new Date(r));w.push(o[l]||{adaKegiatan:!1,tanggal:l})}k(w),je=w,Z(!!w.find(r=>r.tanggal===Pe)?.adaKegiatan)}else H=!0;let de=[];ye.status==="fulfilled"?(de=Array.from({length:L.length},(c,o)=>o===Y?ye.value[0]:{status:"fulfilled",value:{}}),ye.value.some(c=>c.status==="rejected")&&(H=!0)):H=!0;let tt=[],ce=[];ke.status==="fulfilled"?(ce=Array.from({length:L.length},(c,o)=>o===Y?ke.value[0]:{status:"fulfilled",value:{}}),ke.value.some(c=>c.status==="rejected")&&(H=!0)):H=!0;const ve=we.status==="fulfilled"&&Array.isArray(we.value.data)?we.value.data:[],ee=L.map((c,o)=>{const r=de[o]&&de[o].status==="fulfilled"?de[o].value:{},l=new Date(L[o]),h=new Date(L[o]);h.setDate(l.getDate()+6);const P=ve.filter(S=>{if(!S?.tanggal)return!1;const C=new Date(S.tanggal);return C>=E&&C<=W&&C>=l&&C<=h}),j=P.length,A=P.filter(S=>S.status===Ye.SELESAI_DIKERJAKAN).length,ge=Math.max(j-A,0),ue=new Date(l<E?E:l),me=new Date(h>W?W:h),xe=`${$(ue)} - ${$(me)}`,J=[];for(let S=new Date(ue);S<=me;S.setDate(S.getDate()+1)){const C=$(new Date(S)),re=(je.length?je:g||[]).find(T=>T.tanggal===C),Me=S.toLocaleDateString("id-ID",{weekday:"long"}),v=!!re?.adaKegiatan;J.push({tanggal:C,hari:Me,total:v?1:0,selesai:0,persen:v?100:0,adaKegiatan:v})}const ae=Number(r?.total??r?.totalTugas??0)||0,ne=Number(r?.selesai??r?.done??0)||0,Se=ae||ne?ne:J.reduce((S,C)=>S+(C.selesai||0),0),se=ae||ne?ae:J.reduce((S,C)=>S+(C.total||0),0),U=Se+A,V=se+j,$e=V?Math.round(U/V*100):0;return{minggu:o+1,tanggal:xe,detail:J,totalSelesai:U,totalTugas:V,totalProgress:$e,penugasan:r,tambahan:{total:j,selesai:A,belum:ge}}});if(p(ee),fe.current.monthIndex!==z||fe.current.year!==s){const o=z===D.getMonth()&&s===D.getFullYear()?Y:0;N(o),fe.current={monthIndex:z,year:s}}const at=c=>c?.userId??c?.pegawaiId??c?.user?.id??c?.pegawai?.id??c?.id??null,nt=tt.map((c,o)=>{const w=c.status==="fulfilled"?c.value:null,r=ce[o]&&ce[o].status==="fulfilled"?ce[o].value:{},l=new Date(L[o]),h=new Date(L[o]);h.setDate(l.getDate()+6);const P=(Array.isArray(ve)?ve:[]).filter(v=>{if(!v?.tanggal)return!1;const T=new Date(v.tanggal),be=T>=E&&T<=W&&T>=l&&T<=h,q=at(v),Ie=q!=null&&t?.id!=null&&String(q)===String(t.id);return be&&Ie}),j=P.length,A=P.filter(v=>v.status===Ye.SELESAI_DIKERJAKAN).length,ge=Math.max(j-A,0);if(!w){const v=Number(r?.total??r?.totalTugas??0)||0,be=(Number(r?.selesai??r?.done??0)||0)+A,q=v+j,Ie=q?Math.round(be/q*100):0;return{minggu:o+1,tanggal:"-",detail:[],totalSelesai:be,totalTugas:q,totalProgress:Ie,penugasan:r,tambahan:{total:j,selesai:A,belum:ge}}}const[ue,me]=w.tanggal.split(" - "),xe=new Date(ue),J=new Date(me),ae=xe<E?E:xe,ne=J>W?W:J,Se=`${$(ae)} - ${$(ne)}`,se=w.detail.filter(v=>{const T=new Date(v.tanggal);return T>=E&&T<=W}),U=Number(r?.total??r?.totalTugas??0)||0,V=Number(r?.selesai??r?.done??0)||0,$e=U||V?V:se.reduce((v,T)=>v+(T.selesai||0),0),S=U||V?U:se.reduce((v,T)=>v+(T.total||0),0),C=$e+A,re=S+j,Me=re?Math.round(C/re*100):0;return{...w,minggu:o+1,tanggal:Se,detail:se,totalSelesai:C,totalTugas:re,totalProgress:Me,penugasan:r,tambahan:{total:j,selesai:A,belum:ge}}});i(nt);try{if(t?.id&&Fe){const c=$(L[Y]||new Date);let o=0;try{const w=await K.get("/monitoring/mingguan",{params:{minggu:c,userId:t.id}}),l=(Array.isArray(w.data?.detail)?w.data.detail:[]).find(h=>$(new Date(h.tanggal))===Pe);if(l){const h=Number(l.selesai||0),P=Number(l.total||0),j=Number(l.belum||0),A=Number((l.sedang??l.proses??Math.max(P-h-j,0))||0);o=h+A}}catch{o=0}pe(o)}else pe(null)}catch{pe(null)}const De=Ee.status==="fulfilled"?Ee:et,te=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];if(De.status==="fulfilled"){const c=Array.isArray(De.value.data)?De.value.data:[],o=new Map;c.forEach((l,h)=>{if(typeof l=="number")o.set(te[h],Number(l)||0);else if(l&&typeof l=="object"){const P=l.bulan||te[h],j=Number(l.persen??l.value??0)||0;o.set(P,j)}});const w=te.map(l=>({bulan:l,persen:o.get(l)??0})),r=Array.isArray(ee)?ee:[];if(r.length){const l=r.reduce((j,A)=>j+(Number(A?.totalProgress)||0),0),h=r.length,P=h?Math.round(l/h):0;w[n]={bulan:te[n],persen:P}}_(w)}else{const c=Array.isArray(ee)?ee:[],o=te.map((w,r)=>{if(r===n&&c.length){const l=c.reduce((j,A)=>j+(Number(A?.totalProgress)||0),0),h=c.length,P=h?Math.round(l/h):0;return{bulan:w,persen:P}}return{bulan:w,persen:0}});_(o),H=!0}H&&We(!0)}catch(I){I?.response&&[401,403].includes(I.response.status)&&M("Anda tidak memiliki akses untuk melihat monitoring."),ut(I,"Gagal mengambil data monitoring")}finally{d(!1)}})()},[t?.id,t?.role,t?.teamId,n,s,u]),O)return e.jsx(lt,{fullScreen:!0});if(f)return e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-red-500 dark:text-red-400",children:f})});const oe=new Date,Ge=oe.getDay()===0||oe.getDay()===6,Ue=Ke(oe.getFullYear()).includes($(oe)),qe=le&&!G&&!Ge&&!Ue;return e.jsxs("div",{className:"w-full max-w-7xl mx-auto space-y-6 animate-fade-in",children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Selamat datang, ",t?.nama||"Pengguna","! ðŸ‘‹"]}),qe&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900 border border-yellow-300 dark:border-yellow-700 p-6 rounded-xl shadow text-center animate-pulse",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-yellow-800 dark:text-yellow-200 mb-2",children:"Anda belum mengisi laporan kegiatan harian hari ini."}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:"Ayo segera lengkapi agar progres Anda tetap tercatat."}),e.jsx(ot,{to:"/tugas-mingguan",children:e.jsx(gt,{variant:"primary",className:"font-semibold w-fit mx-auto",children:"Isi Laporan Sekarang"})})]}),Oe&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900 border border-red-300 dark:border-red-700 p-4 rounded-xl text-red-800 dark:text-red-200",children:"Sebagian data gagal dimuat. Beberapa informasi mungkin tidak lengkap."}),e.jsx(It,{weeklyData:x[u]||y[u],reportedToday:le&&G,countOverride:le?Be:null,activeDate:le?$(new Date):null}),e.jsx(Mt,{dailyData:g,weeklyList:x.length?x:y,weekIndex:u,onWeekChange:Je,monthIndex:n,onMonthChange:He,monthlyData:B,year:s,onYearChange:Ve})]})};export{Ht as default};
