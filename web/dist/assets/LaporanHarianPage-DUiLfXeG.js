import{c as W,r as n,j as e,u as sa,R as na,b as A}from"./index-tHDgc07s.js";import{h as ra}from"./index-ByzRz9Id.js";import{a as q,d as $,h as F,b as ia,s as z}from"./alerts-D6uugUBg.js";import{M as Y,S as la,D as oa,a as da,P as ca}from"./DataTable-CS6-fgxe.js";import{B as M}from"./Button-DTOqL5YY.js";import{L as f,I as U}from"./Label-BFO2ikUa.js";import{S as g,f as _}from"./status-DdjLpvCM.js";import{S as ga}from"./StatusBadge-BxML8eep.js";import{M as Q,E as ua}from"./EmptyState-BLFTy2t7.js";import{T as ma}from"./TableSkeleton-Dxlcfjrc.js";import{e as ha}from"./exportFileName-6qVRS4Vh.js";import{c as pa}from"./confirmAlert-BWqzQj7I.js";import{f as xa}from"./formatDate-DfmPmopR.js";import{g as ba}from"./dateUtils-51te1x9i.js";import{E as ka}from"./external-link-CaRraGV_.js";import{M as fa}from"./minus-BTvEc0Zs.js";import"./arrow-up-ffV8zUNQ.js";import"./months-C0Ia_Adi.js";import"./ChevronUpDownIcon-B5dk51oI.js";import"./transition-Ca9_kCyg.js";import"./Skeleton-BCHcvZdc.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ja=W("calendar-days",ya);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],va=W("calendar-range",wa);function Na({onClose:y,onConfirm:B}){const[d,I]=n.useState("bulanan"),[l,m]=n.useState(""),[c,N]=n.useState(""),[K,u]=n.useState([]);n.useEffect(()=>{if(!l)return u([]);const t=new Date().getFullYear(),p=l-1,S=new Date(t,p,1),j=new Date(t,p+1,0),x=new Date(S);x.setDate(S.getDate()-(S.getDay()+6)%7);const w=[];for(let k=new Date(x);k<=j;k.setDate(k.getDate()+7))w.push(w.length+1);u(w),c&&c>w.length&&N("")},[l]);const T=async()=>{(await q("Batalkan proses export?")).isConfirmed&&y()},h=()=>{if(!l){$("Bulan belum dipilih");return}if(d==="mingguan"&&!c){$("Minggu belum dipilih");return}const t={bulan:l};d==="mingguan"&&(t.minggu=c),B(t)},D=d==="bulanan"&&!l||d==="mingguan"&&(!l||!c),C=t=>new Date(2025,t-1).toLocaleString("id-ID",{month:"long",year:"numeric"});return e.jsx(Y,{onClose:y,titleId:"export-modal-title",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"ðŸ“¦ Export Laporan"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Pilih rentang waktu dan parameter yang akan diekspor."})]}),e.jsxs("div",{className:"border rounded-xl p-5 bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-700 dark:text-white",children:"Rentang Waktu"}),e.jsx("div",{className:"flex gap-4",children:[{key:"bulanan",label:"Bulanan",icon:ja},{key:"mingguan",label:"Mingguan",icon:va}].map(t=>e.jsxs("button",{type:"button",onClick:()=>I(t.key),className:`flex items-center gap-2 px-4 py-2 rounded-lg border text-sm font-medium transition ${d===t.key?"bg-blue-600 text-white border-blue-600 shadow":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-100 border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600"}`,children:[e.jsx(t.icon,{size:16}),t.label]},t.key))})]}),e.jsxs("div",{className:"border rounded-xl p-5 bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 space-y-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-700 dark:text-white",children:"Parameter Export"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{className:"mb-1 block",children:"Bulan"}),e.jsx(Q,{month:l,onMonthChange:m})]}),e.jsxs("div",{children:[e.jsx(f,{className:"mb-1 block",children:"Minggu"}),e.jsxs("select",{value:c,onChange:t=>N(t.target.value),disabled:d!=="mingguan",className:`w-full border rounded-xl px-3 py-2 transition bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 ${d!=="mingguan"?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"Pilih Minggu"}),K.map(t=>e.jsxs("option",{value:t,children:["Minggu ",t]},t))]}),d!=="mingguan"&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 italic",children:["Opsi minggu hanya aktif jika memilih rentang"," ",e.jsx("strong",{children:"mingguan"}),"."]})]})]})]}),e.jsx("div",{className:"border rounded-xl p-4 bg-yellow-50 dark:bg-yellow-900 border-yellow-300 dark:border-yellow-700",children:l?e.jsx("div",{className:"text-sm text-yellow-900 dark:text-yellow-100 space-y-1",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Hasil Export:"})," ",d==="bulanan"?`Laporan Harian Bulan ${C(l)}`:c?`Laporan Harian Minggu ${c} Bulan ${C(l)}`:"Pilih minggu untuk melihat ringkasan"]})}):e.jsx("p",{className:"text-sm italic text-yellow-800 dark:text-yellow-200",children:"Pilih bulan terlebih dahulu untuk melihat ringkasan export."})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(M,{variant:"secondary",onClick:T,children:"Batal"}),e.jsx(M,{onClick:h,disabled:D,children:"Export"})]})]})})}function Ua(){const{user:y}=sa(),[B,d]=n.useState([]),[I,l]=n.useState(!0),[m,c]=n.useState(!1),[N,K]=n.useState(""),[u,T]=n.useState(""),[h,D]=n.useState(""),[C,t]=n.useState([]),[p,S]=n.useState(10),[j,x]=n.useState(1),[w,k]=n.useState(!1),[V,H]=n.useState(!1),[r,E]=n.useState({id:null,tanggal:new Date().toISOString().slice(0,10),deskripsi:"",status:g.BELUM,buktiLink:"",catatan:""});n.useEffect(()=>{if(!u){t([]);return}const a=new Date().getFullYear(),s=u-1,i=new Date(a,s,1),o=new Date(a,s+1,0),v=new Date(i);v.setDate(i.getDate()-(i.getDay()+6)%7);const b=[];for(let L=new Date(v);L<=o;L.setDate(L.getDate()+7))b.push(b.length+1);t(b),h&&h>b.length&&D("")},[u,h]);const O=async()=>{try{l(!0);const a=y?.role===na.ADMIN,s=a?"/laporan-harian/all":"/laporan-harian/mine/filter",i={};a||(u&&(i.bulan=u),h&&(i.minggu=h),i.tambahan=!0);const o=await A.get(s,{params:i});d(o.data)}catch(a){F(a,"Gagal mengambil laporan")}finally{l(!1)}},X=async()=>{try{if(c(!0),(r.status===g.SEDANG_DIKERJAKAN||r.status===g.SELESAI_DIKERJAKAN)&&!r.buktiLink.trim()){ia("Lengkapi data","Link bukti wajib diisi");return}r.id&&await A.put(`/laporan-harian/${r.id}`,r),k(!1),O(),z("Berhasil","Laporan diperbarui")}catch(a){F(a,"Gagal menyimpan")}finally{c(!1)}},Z=async(a={})=>{try{const s=await A.get("/laporan-harian/mine/export",{params:{...a,tambahan:!0},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([s.data])),o=document.createElement("a");o.href=i;const v=a.bulan?parseInt(a.bulan,10):void 0,b=`${ha("LaporanHarian",v,a.minggu)}.xlsx`;o.setAttribute("download",b),document.body.appendChild(o),o.click(),o.remove(),z("Berhasil","Export berhasil disimpan")}catch(s){F(s,"Gagal mengekspor")}},aa=()=>H(!0),ea=async a=>{const s={};if(a.tanggal){const i=new Date(a.tanggal);s.bulan=i.getMonth()+1,s.minggu=ba(i)}else a.bulan&&(s.bulan=a.bulan),a.minggu&&(s.minggu=a.minggu);try{if(!(await A.get("/laporan-harian/mine/filter",{params:{...s,tambahan:!0}})).data.length){$("Gagal","Tidak ada data untuk diekspor");return}if(!(await pa({title:"Apakah Anda ingin mengekspor data ini?",icon:"question",confirmButtonText:"Export"})).isConfirmed)return;await Z(a)}catch(i){F(i,"Gagal mengekspor")}finally{H(!1)}};n.useEffect(()=>{y&&O()},[y,u,h]);const P=B.filter(a=>{const s=a.pegawai?.nama?.toLowerCase()||"",i=a.penugasan?.kegiatan?.namaKegiatan?.toLowerCase()||a.nama?.toLowerCase()||"",o=a.deskripsi?.toLowerCase()||"",v=a.catatan?.toLowerCase()||"",b=a.status.toLowerCase();return`${s} ${i} ${o} ${v} ${b}`.includes(N.toLowerCase())}),R=(a,s=50)=>a?a.length>s?a.slice(0,s)+"â€¦":a:"-",G=P.slice((j-1)*p,j*p),ta=Math.ceil(P.length/p)||1,J=[{Header:"No",accessor:(a,s)=>(j-1)*p+s+1,disableFilters:!0},{Header:"Jenis",accessor:a=>a.type==="tambahan"||a.tambahan?"Tugas Tambahan":"Tugas Mingguan",disableFilters:!0},{Header:"Kegiatan",accessor:a=>a.penugasan?.kegiatan?.namaKegiatan||a.tambahan?.nama||a.nama||"-",disableFilters:!0},{Header:"Tim",accessor:a=>a.penugasan?.kegiatan?.team?.namaTim||a.penugasan?.tim?.namaTim||a.tambahan?.kegiatan?.team?.namaTim||a.kegiatan?.team?.namaTim||"-",disableFilters:!0},{Header:"Tanggal",accessor:a=>xa(a.tanggal),disableFilters:!0},{Header:"Deskripsi Kegiatan",accessor:a=>R(a.penugasan?.kegiatan?.deskripsi||a.tambahan?.kegiatan?.deskripsi||a.deskripsi||"-"),disableFilters:!0},{Header:"Capaian Kegiatan",accessor:a=>R(a.capaianKegiatan||"-"),disableFilters:!0},{Header:"Status",accessor:"status",Cell:({row:a})=>e.jsx(ga,{status:a.original.status}),disableFilters:!0},{Header:"Bukti",accessor:a=>a.buktiLink,Cell:({row:a})=>a.original.buktiLink?e.jsx("a",{href:a.original.buktiLink,target:"_blank",rel:"noreferrer",children:e.jsx(ka,{size:16,className:"mx-auto text-blue-600 dark:text-blue-400"})}):e.jsx(fa,{className:"w-4 h-4 mx-auto text-gray-500"}),disableFilters:!0,cellClassName:"text-center"},{Header:"Catatan",accessor:a=>R(a.catatan||"-"),disableFilters:!0}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-2 mb-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx(la,{value:N,onChange:a=>{K(a.target.value),x(1)},placeholder:"Cari...",ariaLabel:"Cari"})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(Q,{month:u,onMonthChange:a=>{T(a),x(1)}}),e.jsxs("select",{value:h,onChange:a=>{D(a.target.value),x(1)},className:"cursor-pointer border border-gray-300 dark:border-gray-600 rounded-xl px-3 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150 ease-in-out",children:[e.jsx("option",{value:"",children:"Minggu"}),C.map(a=>e.jsxs("option",{value:a,children:["Minggu ",a]},a))]}),e.jsxs(M,{onClick:aa,className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-semibold bg-green-600 hover:bg-green-700 text-white transition duration-150 ease-in-out",children:[e.jsx(ra,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:".xlsx"})]})]})]}),e.jsxs("div",{className:"overflow-x-auto md:overflow-x-visible min-h-[120px]",children:[I?e.jsx(ma,{cols:J.length}):G.length===0?e.jsx(ua,{message:"Belum ada laporan untuk periode ini"}):e.jsx(oa,{columns:J,data:G,showGlobalFilter:!1,showPagination:!1,selectable:!1}),P.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx(da,{pageSize:p,setPageSize:S,setCurrentPage:x,options:[5,10,25,50],className:"w-32"}),e.jsx(ca,{currentPage:j,totalPages:ta,onPageChange:x})]})]}),w&&e.jsxs(Y,{onClose:()=>k(!1),titleId:"laporan-harian-form-title",children:[e.jsx("h3",{id:"laporan-harian-form-title",className:"text-lg font-semibold",children:"Edit Laporan Harian"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs(f,{htmlFor:"tanggal",children:["Tanggal",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(U,{id:"tanggal",type:"date",value:r.tanggal,onChange:a=>E({...r,tanggal:a.target.value}),disabled:m})]}),e.jsxs("div",{children:[e.jsxs(f,{htmlFor:"deskripsi",children:["Deskripsi ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"deskripsi",value:r.deskripsi,onChange:a=>E({...r,deskripsi:a.target.value}),className:"form-input",disabled:m})]}),e.jsxs("div",{children:[e.jsxs(f,{htmlFor:"status",children:["Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"status",value:r.status,onChange:a=>E({...r,status:a.target.value}),className:"form-input",disabled:m,children:[e.jsx("option",{value:g.BELUM,children:_(g.BELUM)}),e.jsx("option",{value:g.SEDANG_DIKERJAKAN,children:_(g.SEDANG_DIKERJAKAN)}),e.jsx("option",{value:g.SELESAI_DIKERJAKAN,children:_(g.SELESAI_DIKERJAKAN)})]})]}),(r.status===g.SEDANG_DIKERJAKAN||r.status===g.SELESAI_DIKERJAKAN)&&e.jsxs("div",{children:[e.jsx(f,{htmlFor:"buktiLink",children:"Link Bukti"}),e.jsx(U,{id:"buktiLink",type:"text",value:r.buktiLink,onChange:a=>E({...r,buktiLink:a.target.value}),required:!0,disabled:m})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"catatan",children:"Catatan"}),e.jsx("textarea",{id:"catatan",value:r.catatan,onChange:a=>E({...r,catatan:a.target.value}),className:"form-input",disabled:m})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(M,{variant:"secondary",onClick:async()=>{(await q("Batalkan perubahan?")).isConfirmed&&k(!1)},disabled:m,children:"Batal"}),e.jsx(M,{onClick:X,loading:m,children:"Simpan"})]})]}),V&&e.jsx(Na,{onClose:()=>H(!1),onConfirm:ea})]})}export{Ua as default};
