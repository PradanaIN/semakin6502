import{u as I,r as s,b as l,j as a,R as M}from"./index-tHDgc07s.js";import{h as p,c as G,s as k,a as R,b as q}from"./alerts-D6uugUBg.js";import{S as $,D as J,a as O,P as Q,M as W}from"./DataTable-CS6-fgxe.js";import{B as m}from"./Button-DTOqL5YY.js";import{L as _,I as K}from"./Label-BFO2ikUa.js";import{T as U}from"./TableSkeleton-Dxlcfjrc.js";import{P as V,T as X}from"./trash-2-A_maZEWT.js";import{P as Y}from"./plus-CRlAJCsY.js";import"./confirmAlert-BWqzQj7I.js";import"./arrow-up-ffV8zUNQ.js";import"./Skeleton-BCHcvZdc.js";function ca(){const{user:N}=I(),[v,S]=s.useState([]),[P,f]=s.useState(!0),[F,g]=s.useState(!1),[d,b]=s.useState(null),[o,u]=s.useState({namaTim:""}),[j,A]=s.useState(""),[i,E]=s.useState(10),[r,h]=s.useState(1),n=s.useCallback(async()=>{try{f(!0);let e=await l.get("/teams");Array.isArray(e.data)&&e.data.length===0&&(e=await l.get("/teams/member")),S(e.data)}catch(e){p(e,"Gagal mengambil tim")}finally{f(!1)}},[]);s.useEffect(()=>{n()},[n]);const c=s.useCallback(()=>g(!0),[]),x=s.useCallback(()=>g(!1),[]),L=s.useCallback(()=>{b(null),u({namaTim:""}),c()},[c]),T=s.useCallback(e=>{b(e),u({namaTim:e.namaTim}),c()},[c]),D=async()=>{const e=o.namaTim.trim();if(!e){q("Lengkapi data","Nama tim wajib diisi");return}try{const t={...o,namaTim:e};d?await l.put(`/teams/${d.id}`,t):await l.post("/teams",t),x(),n(),k("Berhasil","Tim disimpan")}catch(t){p(t,"Gagal menyimpan tim")}},w=s.useCallback(async e=>{if((await G("Hapus tim ini?")).isConfirmed)try{await l.delete(`/teams/${e}`),n(),k("Dihapus","Tim berhasil dihapus")}catch(B){p(B,"Gagal menghapus tim")}},[n]),y=v.filter(e=>e.namaTim.toLowerCase().includes(j.toLowerCase())),H=y.slice((r-1)*i,r*i),z=Math.ceil(y.length/i)||1,C=s.useMemo(()=>[{Header:"No",accessor:(e,t)=>(r-1)*i+t+1,disableFilters:!0},{Header:"Nama Tim",accessor:"namaTim",disableFilters:!0},{Header:"Jumlah Anggota",accessor:e=>e.members?.length||0,disableFilters:!0},{Header:"Aksi",accessor:"id",Cell:({row:e})=>a.jsxs("div",{className:"space-x-2",children:[a.jsx(m,{onClick:()=>T(e.original),variant:"warning",icon:!0,"aria-label":"Edit",children:a.jsx(V,{size:16})}),a.jsx(m,{onClick:()=>w(e.original.id),variant:"danger",icon:!0,"aria-label":"Hapus",children:a.jsx(X,{size:16})})]}),disableFilters:!0}],[r,i,T,w]);return N?.role!==M.ADMIN?a.jsx("div",{className:"p-6 text-center",children:"Anda tidak memiliki akses ke halaman ini."}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-wrap justify-between items-end gap-2",children:[a.jsx($,{value:j,onChange:e=>{A(e.target.value),h(1)},placeholder:"Cari tim...",ariaLabel:"Cari tim"}),a.jsxs(m,{onClick:L,className:"add-button",children:[a.jsx(Y,{size:16}),a.jsx("span",{className:"hidden sm:inline",children:"Tambah Tim"})]})]}),a.jsx("div",{className:"overflow-x-auto md:overflow-x-visible",children:P?a.jsx(U,{cols:C.length}):a.jsx(J,{columns:C,data:H,showGlobalFilter:!1,showPagination:!1,selectable:!1})}),a.jsxs("div",{className:"flex items-center justify-between mt-4",children:[a.jsx(O,{pageSize:i,setPageSize:E,setCurrentPage:h,options:[5,10,25,50],className:"w-32"}),a.jsx(Q,{currentPage:r,totalPages:z,onPageChange:h})]}),F&&a.jsxs(W,{onClose:x,titleId:"team-form-title",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h2",{id:"team-form-title",className:"text-xl font-semibold",children:d?"Edit Tim":"Tambah Tim"}),a.jsx("p",{className:"text-xs text-red-600 dark:text-red-500",children:"* Fardu 'Ain"})]}),a.jsx("div",{className:"space-y-2",children:a.jsxs("div",{children:[a.jsxs(_,{htmlFor:"namaTim",className:"dark:text-gray-100",children:["Nama Tim ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(K,{id:"namaTim",type:"text",value:o.namaTim,onChange:e=>u({...o,namaTim:e.target.value}),required:!0,className:"w-full border rounded px-3 py-2 bg-white text-gray-900 dark:bg-gray-700 dark:text-gray-100"})]})}),a.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[a.jsx(m,{variant:"secondary",onClick:async()=>{(await R("Batalkan perubahan?")).isConfirmed&&x()},children:"Batal"}),a.jsx(m,{onClick:D,children:"Simpan"})]})]})]})}export{ca as default};
