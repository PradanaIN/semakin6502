import{j as e,u as Me,r as y,R as Ee,b as G,e as ga,a as ua}from"./index-D7Gl0_T6.js";import{m as de}from"./months-C0Ia_Adi.js";import{w as Q,F as Re,a as Ie}from"./ChevronUpDownIcon-D0B7vQZy.js";import{g as ya}from"./holidays-BznbYqFv.js";import{d as Pe}from"./dayjs-BcsIK0fC.js";import{b as Oe,A as Ge,a as He}from"./arrow-up-_j-HJsFD.js";import{T as _e}from"./TableSkeleton-DKWwMdv2.js";import{S as ze}from"./Skeleton-DH50fE3Q.js";import{g as Qe}from"./dateUtils-51te1x9i.js";import{h as ve}from"./alerts-CR3Rk7UZ.js";import{S as Le}from"./status-CiN_pTIP.js";import{f as Ke,E as aa,a as ta}from"./jspdf.plugin.autotable-_fd0L37-.js";import{B as ba}from"./Button-C-tWVwjP.js";import{i as ha}from"./index-CLZJwMnx.js";import{e as ra}from"./exportFileName-6qVRS4Vh.js";import{L as pa}from"./Legend-BByel-XM.js";import{A as fa,m as xa}from"./proxy-BYVAC0Rh.js";import"./confirmAlert-BWqzQj7I.js";import"./typeof-QjJsDpFa.js";function wa({tab:a,monthlyMode:r,monthIndex:u,setMonthIndex:d,weekIndex:n,setWeekIndex:o,weekStarts:w=[],year:P,setYear:L,teamId:E,setTeamId:b,teams:j=[]}){const x=new Date().getFullYear(),V=Array.from({length:5},(l,g)=>x-2+g),f="relative w-full cursor-pointer rounded-xl bg-gray-50 dark:bg-gray-800 py-2 pl-4 pr-10 border border-gray-300 dark:border-gray-600 shadow-sm text-center focus:outline-none focus:ring-2 focus:ring-blue-500",v="absolute z-30 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white dark:bg-gray-700 py-1 text-sm shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none";return e.jsxs("div",{className:"flex flex-wrap gap-3 items-center justify-start",children:[(a==="harian"||a==="mingguan"||a==="bulanan"&&r==="current")&&e.jsx("div",{className:"w-36",children:e.jsx(Q,{value:u,onChange:d,children:e.jsxs("div",{className:"relative",children:[e.jsxs(Q.Button,{className:f,children:[e.jsx("span",{className:"block truncate",children:de[u]}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(Re,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsx(Q.Options,{className:v,children:de.map((l,g)=>e.jsx(Q.Option,{value:g,className:({active:t})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${t?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:t})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${t?"font-medium":"font-normal"}`,children:l}),t&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},g))})]})})}),a==="mingguan"&&w.length>0&&e.jsx("div",{className:"w-36",children:e.jsx(Q,{value:n,onChange:o,children:e.jsxs("div",{className:"relative",children:[e.jsxs(Q.Button,{className:f,children:[e.jsxs("span",{className:"block truncate",children:["Minggu ",n+1]}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(Re,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsx(Q.Options,{className:v,children:w.map((l,g)=>e.jsx(Q.Option,{value:g,className:({active:t})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${t?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:t})=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`block truncate ${t?"font-medium":"font-normal"}`,children:["Minggu ",g+1]}),t&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},g))})]})})}),(a==="bulanan"||a==="harian")&&e.jsx("div",{className:"w-32",children:e.jsx(Q,{value:P,onChange:l=>L(Number(l)),children:e.jsxs("div",{className:"relative",children:[e.jsxs(Q.Button,{className:f,"aria-label":"Pilih Tahun",children:[e.jsx("span",{className:"block truncate",children:P}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(Re,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsx(Q.Options,{className:v,children:V.map(l=>e.jsx(Q.Option,{value:l,className:({active:g})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${g?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:g})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${g?"font-medium":"font-normal"}`,children:l}),g&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},l))})]})})}),e.jsx("div",{className:"w-40",children:e.jsx(Q,{value:E,onChange:b,children:e.jsxs("div",{className:"relative",children:[e.jsxs(Q.Button,{className:f,"aria-label":"Pilih Tim",children:[e.jsx("span",{className:"block truncate",children:(()=>{if(!E)return"Semua Tim";const l=j.find(g=>g.id===E);return l?l.namaTim:"Semua Tim"})()}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(Re,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsxs(Q.Options,{className:v,children:[e.jsx(Q.Option,{value:"",className:({active:l})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${l?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:l})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${l?"font-medium":"font-normal"}`,children:"Semua Tim"}),l&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},"all"),j.filter(l=>l.namaTim!=="Pimpinan").map(l=>e.jsx(Q.Option,{value:l.id,className:({active:g})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${g?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:g})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${g?"font-medium":"font-normal"}`,children:l.namaTim}),g&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},l.id))]})]})})})]})}const ka=[{key:"harian",label:"Harian"},{key:"mingguan",label:"Mingguan"},{key:"bulanan",label:"Bulanan"}];function Na({activeTab:a,onChange:r}){return e.jsx("div",{className:"flex flex-wrap gap-2",role:"tablist",children:ka.map(u=>{const d=a===u.key;return e.jsx("button",{onClick:()=>r(u.key),role:"tab","aria-selected":d,className:`px-4 py-2 rounded-lg font-semibold transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2
              ${d?"bg-blue-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-200 dark:hover:bg-gray-600"}
            `,children:u.label},u.key)})})}const ja=({user:a,boxClass:r,currentUser:u})=>{const d=u&&(a.userId===u.id||a.nama===u.nama);return e.jsxs("tr",{className:`text-center transition-colors duration-200 border-b border-gray-200 dark:border-gray-700 odd:bg-gray-50/60 dark:odd:bg-gray-800/40 ${d?"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border-r border-gray-300 dark:border-gray-700 w-60 md:w-72 whitespace-nowrap overflow-hidden text-ellipsis",title:a.nama,children:a.nama}),a.detail.map(n=>e.jsx("td",{title:n.count?`${n.count} laporan`:"",className:`px-4 py-2 border border-gray-300 dark:border-gray-600 text-center align-middle ${r(n)} truncate`,children:n.count||""},n.tanggal))]})},Aa=({data:a=[],monthIndex:r,year:u})=>{const{user:d}=Me(),n=Array.isArray(a)?a:[],o=Pe().tz("Asia/Makassar"),w=ya(u),P=j=>{const x=Pe.utc(j).tz("Asia/Makassar");return x.day()===0||x.day()===6},L=j=>w.includes(Pe.utc(j).tz("Asia/Makassar").format("YYYY-MM-DD")),E=j=>j.count>0?"bg-green-100 dark:bg-green-700 text-green-900 dark:text-green-100":P(j.tanggal)||L(j.tanggal)?"bg-blue-100 dark:bg-blue-700 text-blue-900 dark:text-blue-100":Pe.utc(j.tanggal).tz("Asia/Makassar").isBefore(o,"day")?"bg-yellow-100 dark:bg-yellow-700 text-yellow-900 dark:text-yellow-100":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300",b=Pe().year(u).month(r).daysInMonth();return e.jsx("div",{className:"overflow-x-auto w-full rounded-md shadow border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 max-h-[65vh] overflow-y-auto",children:e.jsxs("table",{className:"min-w-[1000px] w-full table-fixed text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 px-4 py-2 text-left font-bold border-r border-gray-300 dark:border-gray-700 w-48 md:w-60",children:"Nama"}),Array.from({length:b},(j,x)=>e.jsx("th",{className:"p-0 w-10 border-r border-gray-300 dark:border-gray-700 text-center align-middle",children:e.jsx("div",{className:"flex items-center justify-center px-2 py-2",children:e.jsx("span",{className:"tabular-nums text-sm font-medium",children:x+1})})},x))]})}),e.jsx("tbody",{children:n.length>0?n.map(j=>e.jsx(ja,{user:j,boxClass:E,currentUser:d},j.userId)):e.jsx("tr",{children:e.jsx("td",{colSpan:b+1,className:"px-4 py-4 text-center text-gray-500 dark:text-gray-400",children:"Belum ada laporan"})})})]})})};function Sa(a){return a>=80?"green":a>=50?"yellow":"red"}function qe(a){const r=Sa(a);return r==="green"?"bg-green-500":r==="yellow"?"bg-yellow-500":"bg-red-500"}const va=({user:a,progressColor:r,weekCount:u,currentUser:d})=>{const n=d&&(a.userId===d.id||a.nama===d.nama);return e.jsxs("tr",{className:`text-center text-sm transition-colors duration-200 odd:bg-gray-50/60 dark:odd:bg-gray-800/40 ${n?"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border border-gray-200 dark:border-gray-600 w-60 md:w-72 whitespace-nowrap overflow-hidden text-ellipsis",title:a.nama,children:a.nama}),a.weeks.slice(0,u).map((o,w)=>e.jsxs("td",{className:"p-2 border border-gray-200 dark:border-gray-600 space-y-1",children:[e.jsxs("span",{className:`inline-block text-[10px] font-semibold px-2 py-0.5 rounded-full ${o.persen>=80?"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200":o.persen>=50?"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200":"bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200"}`,children:[o.persen,"%"]}),e.jsx("div",{role:"progressbar","aria-valuenow":o.persen,"aria-valuemin":"0","aria-valuemax":"100",className:"w-full bg-gray-200 dark:bg-gray-700 rounded h-2 overflow-hidden",children:e.jsx("div",{className:`${r(o.persen)} h-2 transition-all duration-300`,style:{width:`${o.persen}%`}})})]},w))]})},Ma=({data:a=[],weeks:r=[],onSelectWeek:u,selectedWeek:d})=>{const{user:n}=Me(),[o,w]=y.useState("name"),[P,L]=y.useState(0),[E,b]=y.useState("asc"),j=qe;o==="week"&&r[d];const x=y.useMemo(()=>{const l=Array.isArray(a)?[...a]:[],g=E==="asc"?1:-1;if(o==="name")return l.sort((C,K)=>g*(C?.nama||"").localeCompare(K?.nama||"","id",{sensitivity:"base"}));const t=r[d]?d:P,D=C=>{const K=Array.isArray(C?.weeks)?C.weeks:[],le=K[t];if(le&&typeof le.persen=="number")return le.persen;const i=K.reduce((h,A)=>h+(Number(A?.persen)||0),0),s=K.length||1;return Math.round(i/s)};return l.sort((C,K)=>g*(D(C)-D(K)))},[a,o,E,r,d,P]),V=()=>{o==="name"?b(l=>l==="asc"?"desc":"asc"):(w("name"),b("asc"))},f=l=>{u&&u(l),o==="week"&&P===l?b(g=>g==="asc"?"desc":"asc"):(w("week"),L(l),b("desc"))},v=({active:l})=>l?E==="asc"?e.jsx(Ge,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(He,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(Oe,{className:"inline-block w-3.5 h-3.5 opacity-40 align-middle"});return e.jsx("div",{className:"overflow-x-auto w-full rounded-md shadow border border-gray-200 dark:border-gray-700 max-h-[65vh]",children:e.jsxs("table",{className:"min-w-[1000px] w-full table-fixed text-sm border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-900 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-white dark:bg-gray-900 p-2 text-left font-bold border-l border-r border-gray-300 dark:border-gray-700 w-48 md:w-60 select-none cursor-pointer",onClick:V,title:"Urutkan berdasarkan Nama",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Nama ",e.jsx(v,{active:o==="name"})]})}),r.map((l,g)=>e.jsx("th",{onClick:()=>f(g),className:`p-2 border-r border-gray-300 dark:border-gray-700 text-center font-medium cursor-pointer select-none transition-colors duration-200 ${d===g?"bg-blue-200 dark:bg-blue-600 text-blue-900 dark:text-blue-100":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:["Minggu ",g+1," ",e.jsx(v,{active:o==="week"&&(P===g||d===g)})]})},g))]})}),e.jsx("tbody",{children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:r.length+1,className:"p-4 text-center text-gray-500",children:"Belum ada data"})}):x.map(l=>e.jsx(va,{user:l,progressColor:j,weekCount:r.length,currentUser:n},l.userId))})]})})},Da=({data:a=[]})=>{const{user:r}=Me(),u=Array.isArray(a)&&a.length>0,d=qe,[n,o]=y.useState("name"),[w,P]=y.useState("asc"),L=f=>{n===f?P(v=>v==="asc"?"desc":"asc"):(o(f),P(f==="name"?"asc":"desc"))},E=y.useMemo(()=>{const f=[...a],v=w==="asc"?1:-1,l=(g,t)=>{if(n==="name")return v*(g?.nama||"").localeCompare(t?.nama||"","id",{sensitivity:"base"});const D=Number(n),C=Number(g?.months?.[D]?.persen)||0,K=Number(t?.months?.[D]?.persen)||0;return v*(C-K)};return f.sort(l)},[a,n,w]),b=de.length,j=Array.from({length:b},(f,v)=>{const l=a.map(t=>Number(t?.months?.[v]?.persen||0)).filter(t=>Number.isFinite(t));if(!l.length)return 0;const g=l.reduce((t,D)=>t+D,0);return Math.round(g/l.length)}),x=new Date().getMonth(),V=({active:f,dir:v})=>f?v==="asc"?e.jsx(Ge,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(He,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(Oe,{className:"inline-block w-3.5 h-3.5 opacity-40 align-middle"});return u?e.jsx("div",{className:"overflow-x-auto w-full mt-4 rounded-md border border-gray-200 dark:border-gray-700 shadow bg-white dark:bg-gray-900 max-h-[65vh]",children:e.jsxs("table",{className:"min-w-[1000px] w-full table-fixed text-sm border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 px-4 py-2 text-left font-bold border-r border-gray-300 dark:border-gray-700 w-48 md:w-60 select-none cursor-pointer",onClick:()=>L("name"),title:"Urutkan berdasarkan Nama",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Nama ",e.jsx(V,{active:n==="name",dir:w})]})}),de.map((f,v)=>e.jsx("th",{title:`Urutkan berdasarkan ${f}`,onClick:()=>L(v),className:`px-4 py-2 text-center font-semibold border-r border-gray-300 dark:border-gray-700 select-none cursor-pointer ${v===x?"bg-blue-100 dark:bg-blue-800":""}`,children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:[f.slice(0,3)," ",e.jsx(V,{active:n===v,dir:w})]})},v))]})}),e.jsx("tbody",{children:E.map(f=>{const v=r&&(f.userId===r.id||f.nama===r.nama);return e.jsxs("tr",{className:`text-center transition-colors duration-200 border-b border-gray-200 dark:border-gray-700 odd:bg-gray-50/60 dark:odd:bg-gray-800/40 ${v?"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border-r border-gray-300 dark:border-gray-700 w-60 md:w-72 whitespace-nowrap overflow-hidden text-ellipsis",title:f.nama,children:f.nama}),f.months.map((l,g)=>e.jsxs("td",{className:`px-4 py-2 border-r border-gray-200 dark:border-gray-600 space-y-1 ${g===x?"bg-blue-50 dark:bg-blue-900/40":""}`,title:`${de[g]}: ${l.persen}% capaian`,children:[e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:`inline-block text-[10px] font-semibold px-2 py-0.5 rounded-full ${l.persen>=80?"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200":l.persen>=50?"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200":"bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200"}`,children:[l.persen,"%"]})}),e.jsx("div",{role:"progressbar","aria-valuenow":l.persen,"aria-valuemin":"0","aria-valuemax":"100",className:"w-full bg-gray-200 dark:bg-gray-700 rounded h-2 overflow-hidden",children:e.jsx("div",{className:`${d(l.persen)} h-2 transition-all duration-300`,style:{width:`${l.persen}%`}})})]},g))]},f.userId)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 border-t border-gray-300 dark:border-gray-700",children:[e.jsx("td",{className:"sticky left-0 z-10 bg-gray-50 dark:bg-gray-800 px-4 py-2 text-left font-bold border-r border-gray-300 dark:border-gray-700 w-60 md:w-72",children:"Rata-rata"}),j.map((f,v)=>e.jsxs("td",{className:"px-4 py-2 border-r border-gray-200 dark:border-gray-600 space-y-1",children:[e.jsxs("span",{className:"text-xs font-medium block text-center",children:[f,"%"]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded h-2 overflow-hidden",children:e.jsx("div",{className:`${d(f)} h-2 transition-all duration-300`,style:{width:`${f}%`}})})]},v))]})})]})}):null},ea=({data:a=[]})=>{const{user:r}=Me(),u=qe,[d,n]=y.useState("nama"),[o,w]=y.useState("asc"),P=y.useMemo(()=>{const b=Array.isArray(a)?[...a]:[],j=(x,V)=>{const f=o==="asc"?1:-1;if(d==="nama")return f*(x?.nama||"").localeCompare(V?.nama||"","id",{sensitivity:"base"});const v=Number(x?.[d])||0,l=Number(V?.[d])||0;return f*(v-l)};return b.sort(j)},[a,d,o]),L=b=>{d===b?w(j=>j==="asc"?"desc":"asc"):(n(b),w(b==="nama"?"asc":"desc"))},E=({active:b,dir:j})=>b?j==="asc"?e.jsx(Ge,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(He,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(Oe,{className:"inline-block w-3.5 h-3.5 opacity-40 align-middle"});return e.jsx("div",{className:"overflow-x-auto w-full mt-4 rounded-md border border-gray-200 dark:border-gray-700 shadow bg-white dark:bg-gray-900 max-h-[65vh]",children:e.jsxs("table",{className:"min-w-[900px] w-full table-fixed text-sm border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-white dark:bg-gray-900 p-2 text-left font-bold border-l border-r border-gray-300 dark:border-gray-700 w-48 md:w-60 select-none cursor-pointer",onClick:()=>L("nama"),title:"Urutkan berdasarkan Nama",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Nama ",e.jsx(E,{active:d==="nama",dir:o})]})}),e.jsx("th",{className:"px-2 py-2 border-r text-center font-semibold w-24 select-none cursor-pointer",onClick:()=>L("selesai"),title:"Urutkan berdasarkan Tugas Selesai",children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:["Tugas Selesai ",e.jsx(E,{active:d==="selesai",dir:o})]})}),e.jsx("th",{className:"px-2 py-2 border-r text-center font-semibold w-24 select-none cursor-pointer",onClick:()=>L("total"),title:"Urutkan berdasarkan Total Tugas",children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:["Total Tugas ",e.jsx(E,{active:d==="total",dir:o})]})}),e.jsx("th",{className:"px-2 py-2 border-r text-center font-semibold w-40 select-none cursor-pointer",onClick:()=>L("persen"),title:"Urutkan berdasarkan Capaian",children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:["Capaian ",e.jsx(E,{active:d==="persen",dir:o})]})})]})}),e.jsx("tbody",{children:P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-500",children:"Belum ada data"})}):P.map(b=>{const j=r&&(b.userId===r.id||b.nama===r.nama);return e.jsxs("tr",{className:`text-center transition-colors duration-200 border-b border-gray-200 dark:border-gray-700 odd:bg-gray-50/60 dark:odd:bg-gray-800/40 ${j?"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border-l border-r border-gray-300 dark:border-gray-700 w-60 md:w-72 whitespace-nowrap overflow-hidden text-ellipsis",title:b.nama,children:b.nama}),e.jsx("td",{className:"px-2 py-2 border-r text-center tabular-nums w-24",children:b.selesai}),e.jsx("td",{className:"px-2 py-2 border-r text-center tabular-nums w-24",children:b.total}),e.jsxs("td",{className:"px-2 py-2 border-r space-y-1 w-40",children:[e.jsxs("span",{className:`inline-block text-[10px] font-semibold px-2 py-0.5 rounded-full text-center ${b.persen>=80?"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200":b.persen>=50?"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200":"bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200"}`,children:[b.persen,"%"]}),e.jsx("div",{role:"progressbar","aria-valuenow":b.persen,"aria-valuemin":"0","aria-valuemax":"100",className:"w-28 mx-auto bg-gray-200 dark:bg-gray-700 rounded h-2 overflow-hidden",children:e.jsx("div",{className:`${u(b.persen)} h-2 transition-all duration-300`,style:{width:`${b.persen}%`}})})]})]},b.userId)})})]})})};function Ca({dayCount:a=30,rows:r=8}){const u=Math.max(28,Math.min(31,Number(a)||30)),d=Math.max(5,Math.min(12,Number(r)||8));return e.jsx("div",{className:"overflow-x-auto w-full rounded-md shadow border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 max-h-[65vh]",children:e.jsxs("table",{className:"min-w-[1000px] w-full table-fixed text-sm border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 px-4 py-2 text-left font-bold border-r border-gray-300 dark:border-gray-700 w-48 md:w-60",children:e.jsx(ze,{className:"h-4 w-24"})}),Array.from({length:u}).map((n,o)=>e.jsx("th",{className:"p-0 w-10 border-r border-gray-300 dark:border-gray-700 text-center align-middle",children:e.jsx("div",{className:"flex items-center justify-center px-2 py-2",children:e.jsx(ze,{className:"h-4 w-6"})})},o))]})}),e.jsx("tbody",{children:Array.from({length:d}).map((n,o)=>e.jsxs("tr",{className:"text-center transition-colors duration-200 border-b border-gray-200 dark:border-gray-700 odd:bg-gray-50/60 dark:odd:bg-gray-800/40",children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border-r border-gray-300 dark:border-gray-700 w-60 md:w-72",children:e.jsx(ze,{className:"h-4 w-40"})}),Array.from({length:u}).map((w,P)=>e.jsx("td",{className:"px-2 py-2 border border-gray-300 dark:border-gray-600 text-center align-middle",children:e.jsx(ze,{className:"h-5 w-8 mx-auto"})},P))]},o))})]})})}function $a({activeTab:a,monthIndex:r,weekIndex:u,weekStarts:d,year:n,teamId:o="",monthlyMode:w,onMonthlyModeChange:P,contentRef:L,lastUpdateText:E="",lastUpdateIso:b=""}){const[j,x]=y.useState(!1),[V,f]=y.useState(!1),[v,l]=y.useState(!1),[g,t]=y.useState(!1),[D,C]=y.useState([]),[K,le]=y.useState([]),[i,s]=y.useState([]),[h,A]=y.useState([]),[ee,pe]=y.useState([]),[De,Ce]=y.useState([]),[la,Je]=y.useState(!1),[ia,ca]=y.useState("current"),[Te,Ve]=y.useState("summary"),te=y.useMemo(()=>["Admin Utama","Yuda Agus Irianto"],[]),{user:Fe}=Me(),[je,Xe]=y.useState([]),Be=w??ia,We=y.useCallback(T=>{w===void 0&&ca(T),P&&P(T)},[w,P]),Ze=y.useRef(We);y.useEffect(()=>{Ze.current=We},[We]);const xe=y.useCallback(T=>Array.isArray(T)?T.filter(F=>!te.includes(F?.nama)):[],[te]);if(y.useEffect(()=>{a==="mingguan"&&Ve("summary"),a==="bulanan"&&Ze.current("current")},[a]),y.useEffect(()=>{(async()=>{try{const F=Fe?.role===Ee.ADMIN||Fe?.role===Ee.PIMPINAN||Fe?.role===Ee.KETUA?"/tugas-tambahan/all":"/tugas-tambahan",$=await G.get(F,{params:{teamId:o||void 0}}),X=Array.isArray($.data)?$.data:Array.isArray($.data?.data)?$.data.data:[];Xe(X)}catch{Xe([])}finally{}})()},[a,r,o,n,Fe?.role]),y.useEffect(()=>{a==="harian"&&(async()=>{try{x(!0);const F=String(r+1).padStart(2,"0"),$=`${n}-${F}-01`,X=await G.get("/monitoring/harian/bulan",{params:{tanggal:$,teamId:o||void 0}});C(xe(X.data))}catch(F){ve(F,"Gagal mengambil monitoring harian")}finally{x(!1)}})()},[a,r,o,n,xe]),y.useEffect(()=>{(async()=>{if(!(!d.length||a!=="mingguan"))try{f(!0);const F=new Date(d[u]),$=`${F.getFullYear()}-${String(F.getMonth()+1).padStart(2,"0")}-${String(F.getDate()).padStart(2,"0")}`,[X,ne,J]=await Promise.all([G.get("/monitoring/mingguan/all",{params:{minggu:$,teamId:o||void 0}}),G.get("/monitoring/penugasan/minggu",{params:{minggu:$,teamId:o||void 0}}),G.get("/penugasan/minggu/all",{params:{minggu:$}})]),me=xe(X.data),be=xe(ne.data),we=Array.isArray(J.data)?J.data:[],Ae=!o&&Array.isArray(we)&&we.length>0,fe=new Date(F);fe.setDate(F.getDate()+6);const Se=m=>{const U=new Date(m);return U>=F&&U<=fe},H=u+1,he=r+1,c=n,R=(Array.isArray(je)?je:[]).filter(m=>{if(m.tanggal){const M=new Date(m.tanggal),Y=Se(m.tanggal),_=M.getFullYear()===c&&M.getMonth()+1===he&&Qe(M)===H;return Y||_}if(m.minggu!==void 0&&m.minggu!==null&&m.bulan!==void 0&&m.bulan!==null&&m.tahun!==void 0&&m.tahun!==null){const M=parseInt(m.minggu,10),Y=parseInt(m.bulan,10),_=parseInt(m.tahun,10);return M===H&&Y===he&&_===c}return!1}),I=m=>String(m?.userId??m?.pegawaiId??m?.user?.id??m?.pegawai?.id??m?.id??m?.nama),Z=m=>m?.user?.nama??m?.pegawai?.nama??m?.nama??m?.fullName??m?.name??"-",q=new Map,re=new Map,ge=m=>typeof m=="string"?m.toLowerCase().replace(/\s+/g," ").trim():"";(Array.isArray(me)?me:[]).forEach(m=>{const U=I(m),M=Z(m);q.set(U,{nama:M,total:0,selesai:0}),M&&re.set(ge(M),U)}),Ae||(Array.isArray(be)?be:[]).forEach(m=>{const U=I(m),M=Z(m),Y=q.has(U)?U:M&&re.has(ge(M))?re.get(ge(M)):U,_=q.get(Y)||{nama:M,total:0,selesai:0},ae=m?.total??m?.totalTugas??0,p=m?.selesai??m?.done??0;_.total=(_.total||0)+(typeof ae=="number"?ae:0),_.selesai=(_.selesai||0)+(typeof p=="number"?p:0),!q.has(Y)&&M&&re.set(ge(M),Y),q.set(Y,_)}),Ae&&we.forEach(m=>{const U=m?.nama||m?.user?.nama||m?.pegawai?.nama;if(!U)return;const M=re.get(ge(U));if(!M)return;const Y=q.get(M)||{nama:U,total:0,selesai:0},_=Array.isArray(m.tugas)?m.tugas:[],ae=_.length,p=_.filter(S=>S.status===Le.SELESAI_DIKERJAKAN).length;Y.total=(Y.total||0)+ae,Y.selesai=(Y.selesai||0)+p,q.set(M,Y)});const ue=new Map;R.forEach(m=>{const U=I(m),M=Z(m),_=(M?re.get(ge(M)):void 0)??(q.has(U)?U:void 0);if(!_)return;const ae=ue.get(_)||{nama:M,total:0,selesai:0};ae.total+=1,m.status===Le.SELESAI_DIKERJAKAN&&(ae.selesai+=1),ue.set(_,ae)});const ke=[...new Set([...q.keys(),...ue.keys()])].map(m=>{const U=q.get(m)||{nama:ue.get(m)?.nama||"-",total:0,selesai:0},M=ue.get(m)||{total:0,selesai:0},Y=(U.total||0)+(M.total||0),_=(U.selesai||0)+(M.selesai||0),ae=Y?Math.round(_/Y*100):0;return{userId:m,nama:U.nama,total:Y,selesai:_,persen:ae}}).filter(m=>!te.includes(m.nama));s(ke)}catch(F){ve(F,"Gagal mengambil monitoring mingguan")}finally{f(!1)}})()},[a,u,d,o,n,r,je,te,xe]),y.useEffect(()=>{if(!Array.isArray(K)||K.length===0){A(K);return}const T=new Map;(Array.isArray(i)?i:[]).forEach($=>{const X=$?.userId!=null?String($.userId):void 0,ne=($?.nama||"").toLowerCase().replace(/\s+/g," ").trim();X&&T.set(X,$.persen),ne&&T.set(ne,$.persen)});const F=K.map($=>{const X=$?.userId!=null?String($.userId):void 0,ne=($?.nama||"").toLowerCase().replace(/\s+/g," ").trim(),J=(X&&T.get(X))??T.get(ne);if(typeof J=="number"&&Array.isArray($.weeks)&&$.weeks[u]){const me=$.weeks.slice();return me[u]={...me[u],persen:J},{...$,weeks:me}}return $});A(F)},[K,i,u]),y.useEffect(()=>{(async()=>{if(a==="mingguan")try{l(!0);const F=String(r+1).padStart(2,"0"),$=`${n}-${F}-01`,X=await G.get("/monitoring/mingguan/bulan",{params:{tanggal:$,teamId:o||void 0}});le(xe(X.data))}catch(F){ve(F,"Gagal mengambil monitoring mingguan per bulan")}finally{l(!1)}})()},[a,r,o,n,xe,te]),y.useEffect(()=>{(async()=>{if(a==="bulanan")try{t(!0);const[F,$]=await Promise.all([G.get("/monitoring/bulanan/matrix",{params:{year:n,teamId:o||void 0}}),G.get("/teams/all").catch(()=>({data:[]}))]),ne=(Array.isArray(F.data)?F.data:[]).filter(c=>!te.includes(c?.nama));let J=Array.isArray($.data)?$.data:[];if(!Array.isArray(J)||J.length===0)try{const c=await G.get("/teams");if(J=Array.isArray(c.data)?c.data:[],J.length===0){const R=await G.get("/teams/member");J=Array.isArray(R.data)?R.data:[]}}catch{J=[]}const me=o?J.filter(c=>String(c?.id)===String(o)):J,be=new Map;me.forEach(c=>{(Array.isArray(c?.members)?c.members:[]).forEach(I=>{const Z=I?.userId??I?.id??I?.user?.id??I?.pegawaiId??I?.pegawai?.id,q=I?.nama??I?.user?.nama??I?.pegawai?.nama??I?.fullName??I?.name;if(!q||te.includes(q))return;const re=Z?String(Z):`nama:${q}`;be.has(re)||be.set(re,{id:Z??null,nama:q})})});const Ae=Array.from(be.values()).map(c=>({id:c.id??c.nama,nama:c.nama})).map(c=>({userId:c.id,nama:c.nama,months:Array.from({length:12},()=>({persen:0}))})),fe=c=>typeof c=="string"?c.toLowerCase().replace(/\s+/g," ").trim():"",Se=Ae.map(c=>{const R=fe(c.nama),I=ne.find(Z=>Z.userId===c.userId||fe(Z.nama)===R);return I?{...c,months:I.months}:c});let H=Se.length>0?Se:ne;try{const c=new Date(n,r,1),R=new Date(n,r+1,0),I=(()=>{const p=[],S=new Date(c);S.setDate(S.getDate()-(S.getDay()+6)%7);for(let B=new Date(S);B<=R;B.setDate(B.getDate()+7))p.push(new Date(B));return p})(),Z=p=>`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}-${String(p.getDate()).padStart(2,"0")}`,q=await Promise.all(I.map(p=>G.get("/penugasan/minggu/all",{params:{minggu:Z(p)}}).then(S=>Array.isArray(S.data)?S.data:[]).catch(()=>[]))),re=p=>typeof p=="string"?p.toLowerCase().replace(/\s+/g," ").trim():"",ge=(p,S)=>S!=null?String(S):`nama:${re(p)}`,ue=p=>{const S=p?.nama,B=p?.userId;if(B==null)return`nama:${re(S)}`;const k=String(B);return typeof S=="string"&&k===S?`nama:${re(S)}`:(k.startsWith("nama:"),k)},Ye=new Set((Array.isArray(H)?H:[]).map(p=>ue(p)).filter(Boolean)),ke=new Map,m=I.map((p,S)=>{const B=new Date(p);B.setDate(p.getDate()+6);const k=Array.isArray(q[S])?q[S]:[],W=new Map;k.forEach(N=>{const se=N?.nama||N?.user?.nama||N?.pegawai?.nama,ie=N?.userId||N?.id||N?.user?.id||N?.pegawai?.id;if(!se||te.includes(se))return;const ce=ge(se,ie);ke.set(ce,se);const ye=Array.isArray(N.tugas)?N.tugas:[],$e=ye.length,da=ye.filter(ma=>ma.status===Le.SELESAI_DIKERJAKAN).length;W.set(ce,{total:$e,selesai:da})});const O=(Array.isArray(je)?je:[]).filter(N=>{if(N?.tanggal){const ie=new Date(N.tanggal);return ie>=p&&ie<=B}if((N?.minggu??null)!==null&&(N?.bulan??null)!==null&&(N?.tahun??null)!==null){const ie=parseInt(N.minggu,10),ce=parseInt(N.bulan,10),ye=parseInt(N.tahun,10),$e=Qe(p);return ie===$e&&ce===p.getMonth()+1&&ye===p.getFullYear()}return!1}),z=new Map;O.forEach(N=>{const se=N?.user?.nama||N?.pegawai?.nama||N?.nama,ie=N?.userId??N?.pegawaiId??N?.user?.id??N?.pegawai?.id;if(!se||te.includes(se))return;const ce=ge(se,ie);ke.set(ce,se);const ye=z.get(ce)||{total:0,selesai:0};ye.total+=1,N.status===Le.SELESAI_DIKERJAKAN&&(ye.selesai+=1),z.set(ce,ye)});const oe=new Map;return new Set([...Ye,...W.keys(),...z.keys()]).forEach(N=>{if(!N)return;const se=W.get(N)||{total:0,selesai:0},ie=z.get(N)||{total:0,selesai:0},ce=(se.total||0)+(ie.total||0),ye=(se.selesai||0)+(ie.selesai||0),$e=ce?Math.round(ye/ce*100):0;oe.set(N,$e)}),oe}),U=I.length||1,M=new Map,Y=new Set;m.forEach(p=>p.forEach((S,B)=>Y.add(B)));const _=new Set([...Array.from(Ye.values()),...Array.from(Y.values())]);if(_.forEach(p=>{let S=0;for(let B=0;B<m.length;B++){const k=m[B];S+=k.get(p)||0}M.set(p,Math.round(S/U))}),M.size>0&&Array.isArray(H)){const p=new Map(H.map(k=>[ue(k),k])),S=[];_.forEach(k=>{if(!p.has(k)){const W=ke.get(k)||(String(k).startsWith("nama:")?String(k).slice(5):String(k)),O=Array.from({length:12},()=>({persen:0}));O[r]={persen:M.get(k)||0};const z=typeof k=="string"&&k.startsWith("nama:")?null:String(k);S.push({userId:z,nama:W,months:O})}});const B=new Map;M.forEach((k,W)=>{const O=ke.get(W),z=typeof O=="string"?O:String(W).startsWith("nama:")?String(W).slice(5):void 0;z&&B.set(z.toLowerCase().replace(/\s+/g," ").trim(),k)}),H=H.map(k=>{const W=ue(k);let O=M.get(W);if(typeof O!="number"){const z=(k?.nama||"").toLowerCase().replace(/\s+/g," ").trim();O=B.get(z)}if(typeof O=="number"&&Array.isArray(k.months)){const z=k.months.slice();return z[r]={persen:O},{...k,months:z}}return k}),!o&&S.length&&(H=[...H,...S])}let ae=M.size===0||Array.from(M.values()).every(p=>!p||p===0);if(ae&&Array.isArray(H))try{const p=await Promise.all(I.map(W=>G.get("/monitoring/mingguan/all",{params:{minggu:Z(W),teamId:o||void 0}}).then(O=>Array.isArray(O.data)?O.data:[]).catch(()=>[]))),S=new Map,B=I.length||1,k=W=>typeof W=="string"?W.toLowerCase().replace(/\s+/g," ").trim():"";for(let W=0;W<p.length;W++)p[W].forEach(z=>{const oe=ge(z?.nama,z?.userId??z?.id),Ne=Number(z?.persen)||0,N=S.get(oe)||0;S.set(oe,N+Ne)});S.size>0&&(H=H.map(W=>{const O=ue(W);let z=S.get(O);if(typeof z!="number"){const oe=k(W?.nama),Ne=Array.from(S.entries()).find(([N])=>(ke.get(N)||(String(N).startsWith("nama:")?String(N).slice(5):""))?.toLowerCase().replace(/\s+/g," ").trim()===oe);Ne&&(z=Ne[1])}if(typeof z=="number"&&Array.isArray(W.months)){const oe=W.months.slice();return oe[r]={persen:Math.round(z/B)},{...W,months:oe}}return W}),ae=!1)}catch{}if(ae&&Array.isArray(H)){const p=Array.isArray(h)&&h.length?h:Array.isArray(K)&&K.length?K:[];if(p.length){const S=new Map,B=Array.isArray(p[0]?.weeks)&&p[0].weeks.length||5;p.forEach(k=>{const W=(k?.nama||"").toLowerCase().replace(/\s+/g," ").trim(),z=(Array.isArray(k?.weeks)?k.weeks:[]).reduce((Ne,N)=>Ne+(Number(N?.persen)||0),0),oe=Math.round(z/Math.max(B,1));S.set(W,oe)}),H=H.map(k=>{const W=(k?.nama||"").toLowerCase().replace(/\s+/g," ").trim(),O=S.get(W);if(typeof O=="number"&&Array.isArray(k.months)){const z=k.months.slice();return z[r]={persen:O},{...k,months:z}}return k})}}}catch{}const he=[...H].sort((c,R)=>(c?.nama||"").localeCompare(R?.nama||"","id",{sensitivity:"base"}));pe(he)}catch(F){ve(F,"Gagal mengambil monitoring bulanan")}finally{t(!1)}})()},[a,n,o,r,u,i,je,te,K,h]),y.useEffect(()=>{(async()=>{if(a!=="bulanan")return;const F=Number(r+1);if(!(!F||F<1||F>12))try{Je(!0);const $=String(F),[X,ne]=await Promise.all([G.get("/monitoring/bulanan/all",{params:{year:n,bulan:$,teamId:o||void 0}}),G.get("/teams/all").catch(()=>({data:[]}))]),J=Array.isArray(X.data)?X.data:[],me=Array.isArray(ne.data)?ne.data:[],be=[];me.forEach(c=>{if(o&&c.id!==o)return;(Array.isArray(c.members)?c.members:[]).forEach(I=>{I?.user&&be.push(I.user)})});const we=new Set,Ae=be.filter(c=>!(!c||!c.id||we.has(c.id)||(we.add(c.id),[Ee.ADMIN,Ee.PIMPINAN].includes(c.role))||te.includes(c.nama))).map(c=>({userId:String(c.id),nama:c.nama})),fe=c=>typeof c=="string"?c.toLowerCase().replace(/\s+/g," ").trim():"",Se=new Map(J.map(c=>[String(c.userId),c])),H=new Map(J.map(c=>[fe(c.nama),c])),he=Ae.map(c=>{const R=Se.get(String(c.userId))||H.get(fe(c.nama)),I=Number(R?.selesai)||0,Z=Number(R?.total)||0,q=Z?Math.round(I/Z*100):0;return{userId:c.userId,nama:c.nama,selesai:I,total:Z,persen:q}});if(!o&&J.length){const c=new Set(he.map(R=>String(R.userId)));J.forEach(R=>{const I=String(R.userId);!c.has(I)&&!te.includes(R.nama)&&(c.add(I),he.push({userId:I,nama:R.nama,selesai:Number(R.selesai)||0,total:Number(R.total)||0,persen:Number.isFinite(R.persen)?R.persen:Number(R.total)?Math.round((Number(R.selesai)||0)/Number(R.total)*100):0}))})}he.sort((c,R)=>(c?.nama||"").localeCompare(R?.nama||"","id",{sensitivity:"base"})),Ce(he)}catch($){ve($,"Gagal mengambil capaian bulan ini"),Ce([])}finally{Je(!1)}})()},[a,n,r,o,te]),a==="harian"&&j){const T=new Date(n,r+1,0).getDate();return e.jsx(Ca,{dayCount:T,rows:8})}if(a==="mingguan"&&(V||v)){const T=Te==="matrix"?Array.isArray(d)?d.length+1:5:4;return e.jsx(_e,{cols:T})}return e.jsxs("div",{ref:L,children:[a==="harian"&&e.jsx(e.Fragment,{children:e.jsx(Aa,{data:D,monthIndex:r,year:n})}),a==="mingguan"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",role:"tablist",children:["summary","matrix"].map(T=>e.jsx("button",{type:"button",onClick:()=>Ve(T),role:"tab","aria-selected":Te===T,className:`px-4 py-1.5 rounded-lg font-semibold text-sm shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 transition-colors duration-150 ease-in-out ${Te===T?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:T==="summary"?"Ringkasan Minggu":"Ringkasan Bulan"},T))}),(b||E)&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:b?e.jsxs(e.Fragment,{children:["Data diambil pada ",e.jsx("strong",{children:Ke(b)})]}):E})]}),Te==="matrix"?e.jsx(Ma,{data:h.length?h:K,weeks:d,selectedWeek:u,onSelectWeek:()=>{}}):e.jsx("div",{children:e.jsx(ea,{data:i})})]}),a==="bulanan"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",role:"tablist",children:[{key:"current",label:"Ringkasan Bulan"},{key:"year",label:"Ringkasan Tahun"}].map(T=>e.jsx("button",{type:"button",onClick:()=>We(T.key),role:"tab","aria-selected":Be===T.key,className:`px-4 py-1.5 rounded-lg font-semibold text-sm shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 transition-colors duration-150 ease-in-out ${Be===T.key?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:T.label},T.key))}),(b||E)&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:b?e.jsxs(e.Fragment,{children:["Data diambil pada ",e.jsx("strong",{children:Ke(b)})]}):E})]}),Be==="current"?la?e.jsx(_e,{cols:4}):e.jsx(ea,{data:De}):g?e.jsx(_e,{cols:13}):ee.length>0?e.jsx(Da,{data:ee}):e.jsx("div",{className:"text-center py-6 text-sm text-gray-500 dark:text-gray-400",children:"Tidak ada data untuk tahun ini."})]})]})}const Ue=["Admin Utama","Yuda Agus Irianto"];function Ea(a){return(de[a]||"").slice(0,3)}function Ia(a){return new Promise((r,u)=>{const d=new Image;d.onload=()=>r(d),d.onerror=u,d.src=a})}async function sa(a,{title:r,subtitle:u}){const d=a.internal.pageSize.getWidth();try{const n=await Ia("/logo.png");a.addImage(n,"PNG",40,30,40,40)}catch{}a.setFontSize(12),a.setFont("helvetica","bold"),a.text("BADAN PUSAT STATISTIK",95,45),a.text("KABUPATEN BULUNGAN",95,63),a.setFontSize(16),a.setFont("helvetica","bold"),a.text(r,d/2,95,{align:"center"}),u&&(a.setFontSize(10),a.setFont("helvetica","normal"),a.text(u,d/2,112,{align:"center"}))}function na(){const a=new Date,r=a.toLocaleDateString("id-ID",{timeZone:"Asia/Makassar",day:"numeric",month:"long",year:"numeric"}),u=a.toLocaleTimeString("en-GB",{timeZone:"Asia/Makassar",hour:"2-digit",minute:"2-digit",hour12:!1});return`${r} pukul ${u} WITA`}async function oa(a){if(!a)return"Semua Tim";try{const r=await G.get("/teams/all");return(Array.isArray(r.data)?r.data:[]).find(n=>n.id===a)?.namaTim||"Semua Tim"}catch{return"Semua Tim"}}async function Pa({year:a,month:r,teamId:u}){const[d,n]=await Promise.all([G.get("/monitoring/bulanan/all",{params:{year:a,bulan:String(r),teamId:u||void 0}}),G.get("/teams/all").catch(()=>({data:[]}))]),o=Array.isArray(d.data)?d.data:[],w=Array.isArray(n.data)?n.data:[],P=[];w.forEach(i=>{if(u&&i.id!==u)return;(Array.isArray(i.members)?i.members:[]).forEach(h=>h?.user&&P.push(h.user))});const L=i=>typeof i=="string"?i.toLowerCase().replace(/\s+/g," ").trim():"",E=new Map,b=new Map,j=(i,s,h)=>{if(!s)return;const A=i.get(s);A?String(A).includes(h)||i.set(s,`${A} / ${h}`):i.set(s,h)};w.forEach(i=>{const s=i?.namaTim||"-";(Array.isArray(i.members)?i.members:[]).forEach(A=>{const ee=A?.userId?String(A.userId):A?.user?.id?String(A.user.id):void 0,pe=L(A?.user?.nama);j(E,ee,s),j(b,pe,s)})});const x=new Set,V=P.reduce((i,s)=>{const h=s?.id;return!h||x.has(h)||Ue.includes(s.nama)||(x.add(h),i.push({userId:String(h),nama:s.nama,tim:E.get(String(h))||b.get(L(s.nama))||"-"})),i},[]),f=new Map(o.map(i=>[String(i.userId),i])),v=new Map(o.map(i=>[L(i.nama),i])),l=V.map(i=>{const s=f.get(String(i.userId))||v.get(L(i.nama)),h=Number(s?.selesai)||0,A=Number(s?.total)||0,ee=A?Math.round(h/A*100):0;return{userId:i.userId,nama:i.nama,tim:i.tim||"-",selesai:h,total:A,persen:ee}});if(!u&&o.length){const i=new Set(l.map(s=>String(s.userId)));o.forEach(s=>{const h=String(s.userId);!i.has(h)&&!Ue.includes(s.nama)&&(i.add(h),l.push({userId:h,nama:s.nama,tim:E.get(h)||b.get(L(s.nama))||"-",selesai:Number(s.selesai)||0,total:Number(s.total)||0,persen:Number.isFinite(s.persen)?Number(s.persen):Number(s.total)?Math.round((Number(s.selesai)||0)/Number(s.total)*100):0}))})}l.sort((i,s)=>(i?.nama||"").localeCompare(s?.nama||"","id",{sensitivity:"base"}));const g=new aa({orientation:"portrait",unit:"pt",format:"A4"}),t=de[r-1],D=await oa(u);await sa(g,{title:`Capaian Kinerja Pegawai Bulan ${t} ${a}`,subtitle:`${D} • Dicetak: ${na()}`});const C=l.map((i,s)=>[s+1,i.nama,i.tim,i.total,i.selesai,`${i.persen}%`]);ta(g,{startY:130,head:[["No","Nama","Tim","Total Tugas","Tugas Selesai","Capaian Kinerja"]],body:C,styles:{fontSize:9,cellPadding:{top:4,bottom:4,left:6,right:6}},headStyles:{fillColor:[239,246,255],textColor:[17,24,39],fontStyle:"bold"},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{halign:"center",cellWidth:28},2:{cellWidth:140},3:{halign:"center"},4:{halign:"center"},5:{halign:"center"}},didParseCell:i=>{if(i.section==="body"&&i.column.index===5){const s=parseInt(String(i.cell.raw).replace(/[^0-9]/g,""),10)||0;s>=80?i.cell.styles.fillColor=[220,252,231]:s>=50?i.cell.styles.fillColor=[254,249,195]:i.cell.styles.fillColor=[254,226,226]}}});const K=g.internal.getNumberOfPages();for(let i=1;i<=K;i++){g.setPage(i);const s=g.internal.pageSize.getWidth(),h=g.internal.pageSize.getHeight();g.setFontSize(8),g.setTextColor(100),g.text("Sumber: SEMAKIN 6502",40,h-16,{align:"left"}),g.text(`Halaman ${i} dari ${K}`,s/2,h-16,{align:"center"})}const le=`${ra("Capaian_Bulanan",r)}.pdf`;g.save(le)}async function Ta({year:a,teamId:r}){const[u,d]=await Promise.all([G.get("/monitoring/bulanan/matrix",{params:{year:a,teamId:r||void 0}}),G.get("/teams/all").catch(()=>({data:[]}))]),n=Array.isArray(u.data)?u.data:[],o=Array.isArray(d.data)?d.data:[],w=[];o.forEach(t=>{if(r&&t.id!==r)return;(Array.isArray(t.members)?t.members:[]).forEach(C=>C?.user&&w.push(C.user))});const P=new Set,L=w.reduce((t,D)=>{const C=D?.id;return!C||P.has(C)||Ue.includes(D.nama)||(P.add(C),t.push({userId:String(C),nama:D.nama})),t},[]),E=new Map(n.map(t=>[String(t.userId),t])),b=new Map(n.map(t=>[(t?.nama||"").toLowerCase().replace(/\s+/g," ").trim(),t])),j=L.map(t=>{const D=E.get(String(t.userId))||b.get((t.nama||"").toLowerCase().replace(/\s+/g," ").trim()),C=de.map((K,le)=>({persen:Number(D?.months?.[le]?.persen||0)}));return{nama:t.nama,months:C}});r||n.forEach(t=>{if(Ue.includes(t.nama))return;j.find(C=>C.nama===t.nama)||j.push({nama:t.nama,months:de.map((C,K)=>({persen:Number(t?.months?.[K]?.persen||0)}))})}),j.sort((t,D)=>(t?.nama||"").localeCompare(D?.nama||"","id",{sensitivity:"base"}));const x=new aa({orientation:"landscape",unit:"pt",format:"A4"}),V=await oa(r);await sa(x,{title:`Capaian Kinerja Pegawai Tahun ${a}`,subtitle:`${V} • Dicetak: ${na()}`});const f=["Nama",...de.map((t,D)=>Ea(D))],v=j.map(t=>[t.nama,...de.map((D,C)=>`${Number(t?.months?.[C]?.persen||0)}%`)]);ta(x,{startY:130,head:[f],body:v,styles:{fontSize:8,cellPadding:3},headStyles:{fillColor:[239,246,255],textColor:[17,24,39],fontStyle:"bold"},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{cellWidth:120}},didParseCell:t=>{if(t.section==="body"&&t.column.index>0&&(t.cell.styles.halign="center"),t.section==="head"&&t.column.index>0&&(t.cell.styles.halign="center"),t.section==="body"&&t.column.index>0){const D=parseInt(String(t.cell.raw).replace(/[^0-9]/g,""),10)||0;D>=80?t.cell.styles.fillColor=[220,252,231]:D>=50?t.cell.styles.fillColor=[254,249,195]:t.cell.styles.fillColor=[254,226,226]}}});const l=x.internal.getNumberOfPages();for(let t=1;t<=l;t++){x.setPage(t);const D=x.internal.pageSize.getWidth(),C=x.internal.pageSize.getHeight();x.setFontSize(8),x.setTextColor(100),x.text("Sumber: SEMAKIN 6502",40,C-16,{align:"left"}),x.text(`Halaman ${t} dari ${l}`,D/2,C-16,{align:"center"})}const g=`${ra("Capaian_Tahunan",new Date().getMonth()+1)}.pdf`;x.save(g)}const Fa=(a,r)=>{const u=new Date(r,a,1),d=new Date(r,a+1,0),n=[],o=new Date(u);o.setDate(o.getDate()-(o.getDay()+6)%7);for(let w=new Date(o);w<=d;w.setDate(w.getDate()+7))n.push(new Date(w));return n};function at(){const a=ga(),r=ua(),{user:u}=Me(),d=y.useRef(!1),[n,o]=y.useState("harian"),[w,P]=y.useState(new Date().getMonth()),[L,E]=y.useState(0),[b,j]=y.useState([]),[x,V]=y.useState(new Date().getFullYear()),[f,v]=y.useState(""),[l,g]=y.useState([]),[t,D]=y.useState(""),[C,K]=y.useState("current"),le=y.useRef(null),i=s=>s==="harian"?"Daftar Laporan Harian":s==="mingguan"?"Capaian Mingguan Pegawai":"Capaian Bulanan Pegawai";return y.useEffect(()=>{(async()=>{try{const h=await G.get("/teams/all");g(h.data)}catch(h){ve(h,"Gagal mengambil tim")}})()},[u?.role]),y.useEffect(()=>{const s=async()=>{try{const A=await G.get("/monitoring/last-update");A?.data?.fetchedAt?D(A.data.fetchedAt):A?.headers?.date?D(new Date(A.headers.date).toISOString()):A?.data?.lastUpdate?D(A.data.lastUpdate):D(new Date().toISOString())}catch{}};s();const h=setInterval(s,6e4);return()=>clearInterval(h)},[]),y.useEffect(()=>{if(d.current)return;const s=new URLSearchParams(a.search),h=s.get("tab"),A=parseInt(s.get("month"),10),ee=parseInt(s.get("year"),10);["harian","mingguan","bulanan"].includes(h)&&o(h),isNaN(ee)||V(ee),!isNaN(A)&&A>=1&&A<=12&&P(A-1),d.current=!0},[a.search]),y.useEffect(()=>{const s=Fa(w,x);j(s);const h=new Date,A=s.findIndex(De=>{const Ce=new Date(De);return Ce.setDate(De.getDate()+7),h>=De&&h<Ce}),ee=new URLSearchParams(a.search),pe=parseInt(ee.get("week"),10);n==="mingguan"&&!isNaN(pe)&&pe>=1&&pe<=s.length?E(pe-1):w===h.getMonth()&&x===h.getFullYear()&&A!==-1?E(A):E(0)},[w,x,n,a.search]),y.useEffect(()=>{if(n!=="mingguan"||b.length===0)return;const s=new Date,h=b.findIndex(A=>{const ee=new Date(A);return ee.setDate(A.getDate()+7),s>=A&&s<ee});w===s.getMonth()&&x===s.getFullYear()&&h!==-1&&E(h)},[n,b,w,x]),y.useEffect(()=>{const s=new URLSearchParams;s.set("tab",n),s.set("month",String(w+1)),s.set("year",String(x)),n==="mingguan"&&s.set("week",String(L+1)),f&&s.set("team",f),r({pathname:a.pathname,search:`?${s.toString()}`},{replace:!0})},[n,w,L,x,f,r,a.pathname]),e.jsxs("div",{className:"max-w-screen-xl mx-auto px-4 flex flex-col gap-4 pb-10",children:[e.jsx(Na,{activeTab:n,onChange:o}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg space-y-6",children:[e.jsxs("div",{className:"sticky top-0 z-30 -mx-6 px-6 py-3 bg-white/80 dark:bg-gray-800/80 backdrop-blur supports-[backdrop-filter]:backdrop-blur rounded-t-xl border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between md:items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white tracking-tight",children:i(n)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wa,{tab:n,monthlyMode:C,monthIndex:w,setMonthIndex:P,weekIndex:L,setWeekIndex:E,weekStarts:b,year:x,setYear:V,teamId:f,setTeamId:v,teams:l}),n==="bulanan"&&e.jsx(ba,{size:"sm",onClick:async()=>{try{C==="current"?await Pa({year:x,month:w+1,teamId:f}):await Ta({year:x,teamId:f})}catch(s){console.error("Export failed",s)}},className:"px-4 py-2 bg-red-600 hover:bg-red-700",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ha,{className:"w-4 h-4"})," .pdf"]})})]})]}),n==="harian"&&e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(pa,{className:"mb-3 justify-start"}),t&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Data diambil pada ",e.jsx("strong",{children:Ke(t)})]})]}),e.jsx(fa,{mode:"wait",children:e.jsx(xa.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.25},children:e.jsx($a,{activeTab:n,monthIndex:w,weekIndex:L,weekStarts:b,year:x,teamId:f,monthlyMode:C,onMonthlyModeChange:K,contentRef:le,lastUpdateText:t?`Data diambil pada ${Ke(t)}`:"",lastUpdateIso:t})},n)})]})]})}export{at as default,Fa as getWeekStarts};
