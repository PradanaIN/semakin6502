import{u as $,r as s,R as o,j as e,b as n}from"./index-D7Gl0_T6.js";import{h as u,c as O,s as P,b as W}from"./alerts-CR3Rk7UZ.js";import{S as _,D as q,a as J,P as Q,M as V}from"./DataTable-CaHLHuME.js";import{u as X}from"./useModalForm-CpQE81NR.js";import{B as c}from"./Button-C-tWVwjP.js";import{L as b,I as Y}from"./Label-C4PoBDXP.js";import{T as Z}from"./TableSkeleton-DKWwMdv2.js";import{P as ee,T as ae}from"./trash-2-BA5DOFRD.js";import{P as se}from"./plus-GSDzPrJa.js";import"./confirmAlert-BWqzQj7I.js";import"./arrow-up-_j-HJsFD.js";import"./Skeleton-DH50fE3Q.js";function he(){const{user:i}=$(),[T,I]=s.useState([]),[k,S]=s.useState([]),[F,v]=s.useState(!0),{showForm:E,form:t,setForm:x,editing:h,openCreate:A,openEdit:D,closeForm:p}=X({teamId:"",namaKegiatan:"",deskripsi:""}),[l,m]=s.useState(1),[H,L]=s.useState(1),[d,M]=s.useState(10),[f,y]=s.useState(i?.role===o.KETUA?i.teamId:""),[j,z]=s.useState(""),G=H||1;s.useEffect(()=>{i?.role===o.KETUA&&y(i.teamId)},[i]);const w=s.useMemo(()=>[{Header:"No",accessor:(a,r)=>(l-1)*d+r+1,disableFilters:!0},{Header:"Tim",accessor:a=>a.team?.namaTim||a.teamId,disableFilters:!0},{Header:"Nama Kegiatan",accessor:"namaKegiatan",disableFilters:!0},{Header:"Deskripsi",accessor:a=>a.deskripsi||"-",disableFilters:!0},{Header:"Aksi",accessor:"id",Cell:({row:a})=>e.jsxs("div",{className:"space-x-2",children:[e.jsx(c,{onClick:()=>C(a.original),variant:"warning",icon:!0,"aria-label":"Edit",children:e.jsx(ee,{size:16})}),e.jsx(c,{onClick:()=>K(a.original),variant:"danger",icon:!0,"aria-label":"Hapus",children:e.jsx(ae,{size:16})})]}),disableFilters:!0}],[l,d,C,K]),g=s.useCallback(async()=>{try{v(!0);const a=await n.get("/master-kegiatan",{params:{page:l,limit:d,team:f||void 0,search:j||void 0}});I(a.data.data),L(a.data.lastPage)}catch(a){u(a,"Gagal mengambil master kegiatan")}finally{v(!1)}},[l,d,f,j]),N=s.useCallback(async()=>{try{let a=await n.get("/teams");Array.isArray(a.data)&&a.data.length===0&&(a=await n.get("/teams/member")),S(a.data)}catch(a){u(a,"Gagal mengambil tim")}},[]);s.useEffect(()=>{g(),N()},[g,N]);const B=()=>{A()};function C(a){D(a,r=>({teamId:r.teamId,namaKegiatan:r.namaKegiatan,deskripsi:r.deskripsi||""}))}const U=async()=>{if(!t.teamId||!t.namaKegiatan){W("Lengkapi data","Tim dan nama kegiatan wajib diisi");return}try{h?await n.put(`/master-kegiatan/${h.id}`,t):await n.post("/master-kegiatan",t),p(),g(),P("Berhasil","Kegiatan disimpan")}catch(a){u(a,"Gagal menyimpan kegiatan")}};async function K(a){if((await O("Hapus kegiatan ini?")).isConfirmed)try{await n.delete(`/master-kegiatan/${a.id}`),g(),P("Dihapus","Kegiatan berhasil dihapus")}catch(R){u(R,"Gagal menghapus kegiatan")}}return[o.KETUA,o.ADMIN].includes(i?.role)?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"flex-1 max-w-sm",children:e.jsx(_,{value:j,onChange:a=>{m(1),z(a.target.value)},placeholder:"Cari kegiatan...",ariaLabel:"Cari kegiatan"})}),e.jsx("div",{children:e.jsxs("select",{value:f,onChange:a=>{m(1),y(a.target.value)},className:`cursor-pointer border border-gray-300 dark:border-gray-600 
      rounded-xl px-2 py-2 bg-white dark:bg-gray-800 
      text-gray-900 dark:text-gray-100 
      focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500
      hover:border-blue-400 dark:hover:border-blue-400
      shadow-sm transition duration-150 ease-in-out text-center`,children:[i.role!==o.KETUA&&e.jsx("option",{value:"",children:"Semua"}),k.map(a=>e.jsx("option",{value:a.id,children:a.namaTim},a.id))]})})]}),e.jsx("div",{children:e.jsxs(c,{onClick:B,className:"add-button",children:[e.jsx(se,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Tambah Kegiatan"})]})})]}),e.jsx("div",{className:"overflow-x-auto md:overflow-x-visible",children:F?e.jsx(Z,{cols:w.length}):e.jsx(q,{columns:w,data:T,showGlobalFilter:!1,showPagination:!1,selectable:!1})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(J,{pageSize:d,setPageSize:M,setCurrentPage:m,options:[5,10,25,50],className:"w-32"}),e.jsx(Q,{currentPage:l,totalPages:G,onPageChange:m})]}),E&&e.jsxs(V,{onClose:p,titleId:"master-kegiatan-form-title",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{id:"master-kegiatan-form-title",className:"text-xl font-semibold",children:h?"Edit Kegiatan":"Tambah Kegiatan"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-500",children:"* Fardu 'Ain"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs(b,{htmlFor:"teamId",className:"dark:text-gray-100",children:["Tim ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"teamId",value:t.teamId,onChange:a=>x({...t,teamId:a.target.value}),className:"w-full border rounded px-3 py-2 bg-white text-gray-900 dark:bg-gray-700 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Pilih tim"}),k.map(a=>e.jsx("option",{value:a.id,children:a.namaTim},a.id))]})]}),e.jsxs("div",{children:[e.jsxs(b,{htmlFor:"namaKegiatan",className:"dark:text-gray-100",children:["Nama Kegiatan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Y,{id:"namaKegiatan",type:"text",value:t.namaKegiatan,onChange:a=>x({...t,namaKegiatan:a.target.value}),className:"w-full border rounded px-3 py-2 bg-white text-gray-900 dark:bg-gray-700 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"deskripsi",className:"dark:text-gray-100",children:"Deskripsi"}),e.jsx("textarea",{id:"deskripsi",value:t.deskripsi,onChange:a=>x({...t,deskripsi:a.target.value}),className:"w-full border rounded px-3 py-2 bg-white text-gray-900 dark:bg-gray-700 dark:text-gray-100"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(c,{variant:"secondary",onClick:p,children:"Batal"}),e.jsx(c,{onClick:U,children:"Simpan"})]})]})]})]}):e.jsx("div",{className:"p-6 text-center",children:"Anda tidak memiliki akses ke halaman ini."})}export{he as default};
