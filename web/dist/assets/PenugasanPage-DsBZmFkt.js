import{c as Se,u as Ne,R as m,a as Ie,e as Pe,r as s,b,j as a}from"./index-tHDgc07s.js";import{s as te,h as se,a as Me,b as Ce}from"./alerts-D6uugUBg.js";import{S as ne,s as ie}from"./selectStyles-DWDXWe1y.js";import{S as Te}from"./StatusBadge-BxML8eep.js";import{S as Fe,D as De,a as Ee,P as Ae,M as Be}from"./DataTable-CS6-fgxe.js";import{u as Le}from"./useModalForm-xKx7JUaA.js";import{B as I}from"./Button-DTOqL5YY.js";import{L as P,I as re}from"./Label-BFO2ikUa.js";import{M as Ke,E as Re}from"./EmptyState-BLFTy2t7.js";import{m as le}from"./months-C0Ia_Adi.js";import{g as He}from"./dateUtils-51te1x9i.js";import{T as Oe}from"./TableSkeleton-Dxlcfjrc.js";import{S as K}from"./status-DdjLpvCM.js";import{E as Ue}from"./eye-BnNwVA-L.js";import{m as oe,A as $e}from"./proxy-Bk039Agy.js";import{P as ze}from"./plus-CRlAJCsY.js";import"./confirmAlert-BWqzQj7I.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./arrow-up-ffV8zUNQ.js";import"./ChevronUpDownIcon-B5dk51oI.js";import"./transition-Ca9_kCyg.js";import"./Skeleton-BCHcvZdc.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],qe=Se("square-check-big",We),Ge=["Ayu Pinta Gabina Siregar","Elly Astutik"];function Ve(n,d){const y=r=>r.tahun*1e4+parseInt(r.bulan,10)*100+r.minggu;return[...n].sort((r,j)=>{if(r.status===K.BELUM&&j.status!==K.BELUM)return-1;if(j.status===K.BELUM&&r.status!==K.BELUM)return 1;const F=y(j)-y(r);if(F!==0)return F;const D=d&&r.kegiatan?.teamId===d,E=d&&j.kegiatan?.teamId===d;return D&&!E?-1:E&&!D?1:0})}const _e=()=>He(new Date);function ba(){const{user:n}=Ne(),d=[m.ADMIN,m.KETUA].includes(n?.role),y=Ie(),r=Pe(),[j,F]=s.useState([]),[D,E]=s.useState([]),[A,de]=s.useState(""),[$,ce]=s.useState([]),[z,ue]=s.useState([]),[ge,W]=s.useState(!0),[q,G]=s.useState(""),{showForm:me,form:o,setForm:k,openCreate:V,closeForm:R,resetForm:pe}=Le({kegiatanId:"",pegawaiIds:[],deskripsi:"",minggu:_e(),bulan:new Date().getMonth()+1,tahun:new Date().getFullYear()}),[H,he]=s.useState(""),[c,xe]=s.useState(""),[u,fe]=s.useState(new Date().getFullYear()),[x,S]=s.useState(""),[be,_]=s.useState([]),[w,ye]=s.useState(10),[N,M]=s.useState(1),[g,Y]=s.useState("mine"),[X,je]=s.useState(!1),[p,J]=s.useState(!1);s.useEffect(()=>{n?.role===m.PIMPINAN&&Y("all")},[n]),s.useEffect(()=>{r.state?.success&&(te("Berhasil",r.state.success),y(r.pathname,{replace:!0,state:{}}))},[r,y]);const Q=s.useMemo(()=>$.map(e=>({value:e.id,label:e.namaKegiatan})),[$]),O=s.useMemo(()=>z.filter(e=>e.role!==m.ADMIN&&e.role!==m.PIMPINAN&&!Ge.includes(e.nama)).map(e=>({value:e.id,label:e.nama})),[z]),Z=s.useRef();s.useEffect(()=>{x||(async()=>{try{const t={};c&&(t.bulan=c),u&&(t.tahun=u);const h=((await b.get("/penugasan",{params:t})).data||[]).map(f=>f.minggu);if(h.length){const f=Math.max(...h);S(String(f))}}catch{}})()},[c,u]),s.useEffect(()=>{if(!c||!u){_([]),S("");return}const e=parseInt(u,10),t=parseInt(c,10)-1,i=new Date(e,t,1),h=new Date(e,t+1,0),f=new Date(i);f.setDate(i.getDate()-(i.getDay()+6)%7);const v=[];for(let C=new Date(f);C<=h;C.setDate(C.getDate()+7))v.push(v.length+1);_(v),x&&x>v.length&&S("")},[c,u,x]);const B=s.useCallback(async()=>{try{W(!0),G("");const e={};c&&(e.bulan=c),u&&(e.tahun=u),x&&(e.minggu=x),g==="dariSaya"&&(e.creator=n?.id);const t=b.get("/penugasan",{params:e}),i=b.get("/teams").then(async l=>Array.isArray(l.data)&&l.data.length===0?b.get("/teams/member"):l);let h=d?b.get("/users"):Promise.resolve({data:[n]});const[f,v,C]=await Promise.all([t,i,h]);let T;if(n?.role===m.ADMIN)T=await b.get("/master-kegiatan?limit=1000");else if(n?.role===m.KETUA){const l=v.data[0]?.id;T=l?await b.get(`/master-kegiatan?team=${l}`):{data:{data:[]}}}else T={data:{data:[]}};F(Ve(f.data,n?.teamId)),E(v.data.filter(l=>l.namaTim!=="Admin"&&l.namaTim!=="Pimpinan")),ue([...C.data].sort((l,U)=>l.nama.localeCompare(U.nama)));const ve=T.data.data||T.data;ce([...ve].sort((l,U)=>l.namaKegiatan.localeCompare(U.namaKegiatan)))}catch(e){G("Gagal mengambil data penugasan."),se(e,"Gagal mengambil data penugasan")}finally{W(!1)}},[n,c,u,x,d,g]);s.useEffect(()=>{B()},[B]);const ke=async()=>{if(je(!0),!o.kegiatanId||o.pegawaiIds.length===0){Ce("Lengkapi data","Kegiatan dan pegawai wajib dipilih");return}try{J(!0),await b.post("/penugasan/bulk",o),R(),pe(),B(),te("Berhasil","Penugasan ditambah")}catch(e){se(e,"Gagal menyimpan penugasan")}finally{J(!1)}},L=s.useMemo(()=>j.filter(e=>{const i=`${e.kegiatan?.namaKegiatan||""} ${e.pegawai?.nama||""}`.toLowerCase().includes(H.toLowerCase()),h=A?String(e.kegiatan?.teamId)===A:!0;return g==="mine"?i&&e.pegawaiId===n?.id:i&&h&&e.pegawaiId!==n?.id}),[j,H,g,n?.id,A]),ee=s.useMemo(()=>L.slice((N-1)*w,N*w),[L,N,w]),we=Math.ceil(L.length/w)||1,ae=s.useMemo(()=>{const e=[{Header:"No",accessor:(t,i)=>(N-1)*w+i+1,disableFilters:!0},{Header:"Kegiatan",accessor:t=>t.kegiatan?.namaKegiatan||"-",disableFilters:!0},{Header:"Deskripsi",accessor:t=>t.deskripsi||"-",disableFilters:!0}];return g==="all"?e.push({Header:"Tim",accessor:t=>t.kegiatan?.team?.namaTim||"-",disableFilters:!0},{Header:"Pegawai",accessor:t=>t.pegawai?.nama||"-",disableFilters:!0}):e.push({Header:"Pegawai",accessor:t=>t.pegawai?.nama||"-",disableFilters:!0}),e.push({Header:"Minggu",accessor:"minggu",disableFilters:!0},{Header:"Bulan",accessor:t=>`${le[(parseInt(t.bulan,10)||1)-1]} ${t.tahun}`,disableFilters:!0},{Header:"Status",accessor:"status",Cell:({row:t})=>a.jsx(Te,{status:t.original.status}),disableFilters:!0}),g!=="all"&&e.push({Header:"Aksi",accessor:"id",Cell:({row:t})=>a.jsx(I,{onClick:()=>y(`/tugas-mingguan/${t.original.id}`),variant:"icon",icon:!0,"aria-label":"Detail",children:a.jsx(Ue,{size:16})}),disableFilters:!0}),e},[N,w,y,g]);return a.jsxs("div",{className:"space-y-6",children:[n?.role!==m.PIMPINAN&&a.jsx("div",{className:"flex flex-wrap gap-2",role:"tablist","aria-label":"View Tabs",children:[{id:"mine",label:"Tugas Saya"},...n?.role===m.KETUA?[{id:"dariSaya",label:"Dari Saya"}]:[],{id:"all",label:"Semua"}].map(e=>a.jsx("button",{type:"button",onClick:()=>{Y(e.id),M(1)},role:"tab","aria-selected":g===e.id,className:`px-4 py-2 rounded-lg font-semibold transition-colors duration-150 ease-in-out shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${g===e.id?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:e.label},e.id))}),a.jsxs(oe.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},className:"flex flex-wrap justify-between items-center gap-2",children:[a.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:a.jsx(Fe,{value:H,onChange:e=>{he(e.target.value),M(1)},placeholder:"Cari penugasan...",ariaLabel:"Cari penugasan"})}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n?.role===m.PIMPINAN&&a.jsxs("select",{value:A,onChange:e=>{de(e.target.value),M(1)},className:"cursor-pointer border border-gray-300 dark:border-gray-600 rounded-xl px-2 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none",children:[a.jsx("option",{value:"",children:"Semua Tim"}),D.map(e=>a.jsx("option",{value:String(e.id),children:e.namaTim},e.id))]}),a.jsx(Ke,{month:c,year:u,onMonthChange:e=>{xe(e),S("")},onYearChange:e=>{fe(e),S("")}}),a.jsxs("select",{value:x,onChange:e=>S(e.target.value),className:"cursor-pointer border border-gray-300 dark:border-gray-600 rounded-xl px-2 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-blue-400 dark:hover:border-blue-400 shadow-sm transition duration-150 ease-in-out",children:[a.jsx("option",{value:"",children:"Minggu"}),be.map(e=>a.jsxs("option",{value:e,children:["Minggu ",e]},e))]}),d&&a.jsxs(I,{onClick:V,className:"flex gap-2 items-center shadow-sm",variant:"primary",children:[a.jsx(ze,{size:16}),a.jsx("span",{className:"hidden sm:inline",children:"Tugas Mingguan"})]})]})]}),a.jsx("div",{className:"overflow-x-auto md:overflow-x-visible min-h-[120px]",children:ge?a.jsx(Oe,{cols:ae.length}):q?a.jsxs("div",{className:"py-10 flex flex-col items-center text-red-600 dark:text-red-400",children:[a.jsx("span",{className:"mb-3 text-xl",children:"⚠️"}),a.jsx("span",{children:q}),a.jsx(I,{variant:"secondary",className:"mt-4",onClick:B,children:"Coba Lagi"})]}):ee.length===0?a.jsx(Re,{message:"Belum ada penugasan untuk minggu ini",...d?{actionLabel:"Tambah Penugasan",onAction:V}:{}}):a.jsx(De,{columns:ae,data:ee,showGlobalFilter:!1,showPagination:!1,selectable:!1})}),L.length>0&&a.jsxs("div",{className:"flex items-center justify-between mt-4 gap-2 flex-wrap",children:[a.jsx(Ee,{pageSize:w,setPageSize:ye,setCurrentPage:M,options:[5,10,25,50],className:"flex-1"}),a.jsx(Ae,{currentPage:N,totalPages:we,onPageChange:M})]}),a.jsx($e,{children:d&&me&&a.jsx(Be,{onClose:R,titleId:"penugasan-form-title",initialFocusRef:Z,children:a.jsxs(oe.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h2",{id:"penugasan-form-title",className:"text-xl font-semibold mb-2",children:"Tambah Penugasan"}),a.jsx("p",{className:"text-xs text-red-600 dark:text-red-500",children:"* Fardu 'Ain"})]}),a.jsxs("form",{className:"space-y-2",onSubmit:e=>{e.preventDefault(),ke()},autoComplete:"off",children:[a.jsxs("div",{children:[a.jsxs(P,{htmlFor:"kegiatanId",children:["Kegiatan ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(ne,{inputId:"kegiatanId",classNamePrefix:"react-select",className:"mb-1",styles:ie,menuPortalTarget:document.body,options:Q,value:Q.find(e=>e.value===o.kegiatanId)||null,onChange:e=>k(t=>({...t,kegiatanId:e?.value||""})),placeholder:"Pilih kegiatan...",isSearchable:!0,isDisabled:p,noOptionsMessage:()=>"Tidak ditemukan."}),X&&!o.kegiatanId&&a.jsx("span",{className:"text-xs text-red-500",children:"Kegiatan wajib dipilih"})]}),a.jsxs("div",{children:[a.jsxs(P,{htmlFor:"pegawaiIds",children:["Pegawai ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(ne,{inputId:"pegawaiIds",isMulti:!0,classNamePrefix:"react-select",className:"mb-1",styles:ie,menuPortalTarget:document.body,options:O,value:O.filter(e=>o.pegawaiIds.includes(e.value)),onChange:e=>k(t=>({...t,pegawaiIds:e?.map(i=>i.value)||[]})),placeholder:"Pilih pegawai...",isSearchable:!0,isDisabled:p,noOptionsMessage:()=>"Tidak ditemukan."}),a.jsxs(I,{type:"button",size:"xs",variant:"ghost",className:`
    flex items-center gap-1\r
    text-blue-600 hover:bg-blue-100\r
    dark:text-blue-400 dark:hover:bg-blue-950\r
    border border-gray-300 dark:border-gray-700\r
    rounded-md\r
    transition-colors duration-200\r
  `,onClick:()=>k(e=>({...e,pegawaiIds:O.map(t=>t.value)})),disabled:p,children:[a.jsx(qe,{className:"w-4 h-4"}),"Pilih Semua"]}),X&&o.pegawaiIds.length===0&&a.jsx("span",{className:"text-xs text-red-500",children:"Pegawai wajib dipilih"})]}),a.jsxs("div",{children:[a.jsx(P,{htmlFor:"deskripsi",children:"Deskripsi Penugasan"}),a.jsx("textarea",{id:"deskripsi",ref:Z,value:o.deskripsi,onChange:e=>k(t=>({...t,deskripsi:e.target.value})),className:"form-input resize-y w-full min-h-[48px] border rounded px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",disabled:p})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[a.jsxs("div",{children:[a.jsxs(P,{htmlFor:"minggu",children:["Minggu ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(re,{id:"minggu",type:"number",value:o.minggu,min:"1",max:"6",onChange:e=>k(t=>({...t,minggu:parseInt(e.target.value,10)})),className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",disabled:p})]}),a.jsxs("div",{children:[a.jsxs(P,{htmlFor:"bulan",children:["Bulan ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("select",{id:"bulan",value:o.bulan,onChange:e=>k(t=>({...t,bulan:parseInt(e.target.value,10)})),className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-700",disabled:p,children:le.map((e,t)=>a.jsx("option",{value:t+1,children:e},t+1))})]}),a.jsxs("div",{children:[a.jsxs(P,{htmlFor:"tahun",children:["Tahun ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(re,{id:"tahun",type:"number",value:o.tahun,onChange:e=>k(t=>({...t,tahun:parseInt(e.target.value,10)})),className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",disabled:p})]})]}),a.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[a.jsx(I,{variant:"secondary",type:"button",onClick:async()=>{(await Me("Batalkan penambahan penugasan?")).isConfirmed&&R()},disabled:p,children:"Batal"}),a.jsx(I,{type:"submit",variant:"primary",loading:p,children:"Simpan"})]})]})]})})})]})}export{ba as default};
