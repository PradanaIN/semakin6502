import{j as e,u as $e,r as h,R as Ae,b as q,e as pa,a as fa}from"./index-tHDgc07s.js";import{m as ge}from"./months-C0Ia_Adi.js";import{w as ee,F as We,a as Ie}from"./ChevronUpDownIcon-B5dk51oI.js";import{g as xa}from"./holidays-BznbYqFv.js";import{d as Te}from"./dayjs-CdKn--g1.js";import{b as Ye,A as _e,a as Ge}from"./arrow-up-ffV8zUNQ.js";import{T as Oe}from"./TableSkeleton-Dxlcfjrc.js";import{S as Le}from"./Skeleton-BCHcvZdc.js";import{g as ea}from"./dateUtils-51te1x9i.js";import{h as Ce}from"./alerts-D6uugUBg.js";import{S as ze}from"./status-DdjLpvCM.js";import{B as wa}from"./Button-DTOqL5YY.js";import{i as ka}from"./index-ByzRz9Id.js";import{E as ra,a as sa}from"./jspdf.plugin.autotable-Bw3f4UrC.js";import{e as na}from"./exportFileName-6qVRS4Vh.js";import{L as Na}from"./Legend-DzHsNs64.js";import{A as ja,m as Aa}from"./proxy-Bk039Agy.js";import"./confirmAlert-BWqzQj7I.js";import"./typeof-QjJsDpFa.js";function Sa({tab:a,monthlyMode:r,monthIndex:m,setMonthIndex:o,weekIndex:d,setWeekIndex:n,weekStarts:j=[],year:E,setYear:R,teamId:I,setTeamId:P,teams:c=[]}){const x=new Date().getFullYear(),p=Array.from({length:5},(g,l)=>x-2+l),M="relative w-full cursor-pointer rounded-xl bg-gray-50 dark:bg-gray-800 py-2 pl-4 pr-10 border border-gray-300 dark:border-gray-600 shadow-sm text-center focus:outline-none focus:ring-2 focus:ring-blue-500",T="absolute z-30 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white dark:bg-gray-700 py-1 text-sm shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none";return e.jsxs("div",{className:"flex flex-wrap gap-3 items-center justify-start",children:[(a==="harian"||a==="mingguan"||a==="bulanan"&&r==="current")&&e.jsx("div",{className:"w-36",children:e.jsx(ee,{value:m,onChange:o,children:e.jsxs("div",{className:"relative",children:[e.jsxs(ee.Button,{className:M,children:[e.jsx("span",{className:"block truncate",children:ge[m]}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(We,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsx(ee.Options,{className:T,children:ge.map((g,l)=>e.jsx(ee.Option,{value:l,className:({active:t})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${t?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:t})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${t?"font-medium":"font-normal"}`,children:g}),t&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},l))})]})})}),a==="mingguan"&&j.length>0&&e.jsx("div",{className:"w-36",children:e.jsx(ee,{value:d,onChange:n,children:e.jsxs("div",{className:"relative",children:[e.jsxs(ee.Button,{className:M,children:[e.jsxs("span",{className:"block truncate",children:["Minggu ",d+1]}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(We,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsx(ee.Options,{className:T,children:j.map((g,l)=>e.jsx(ee.Option,{value:l,className:({active:t})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${t?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:t})=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`block truncate ${t?"font-medium":"font-normal"}`,children:["Minggu ",l+1]}),t&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},l))})]})})}),(a==="bulanan"||a==="harian")&&e.jsx("div",{className:"w-32",children:e.jsx(ee,{value:E,onChange:g=>R(Number(g)),children:e.jsxs("div",{className:"relative",children:[e.jsxs(ee.Button,{className:M,"aria-label":"Pilih Tahun",children:[e.jsx("span",{className:"block truncate",children:E}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(We,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsx(ee.Options,{className:T,children:p.map(g=>e.jsx(ee.Option,{value:g,className:({active:l})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${l?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:l})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${l?"font-medium":"font-normal"}`,children:g}),l&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},g))})]})})}),e.jsx("div",{className:"w-40",children:e.jsx(ee,{value:I,onChange:P,children:e.jsxs("div",{className:"relative",children:[e.jsxs(ee.Button,{className:M,"aria-label":"Pilih Tim",children:[e.jsx("span",{className:"block truncate",children:(()=>{if(!I)return"Semua Tim";const g=c.find(l=>l.id===I);return g?g.namaTim:"Semua Tim"})()}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(We,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsxs(ee.Options,{className:T,children:[e.jsx(ee.Option,{value:"",className:({active:g})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${g?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:g})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${g?"font-medium":"font-normal"}`,children:"Semua Tim"}),g&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},"all"),c.filter(g=>g.namaTim!=="Pimpinan").map(g=>e.jsx(ee.Option,{value:g.id,className:({active:l})=>`relative cursor-pointer select-none py-2 pl-10 pr-4 ${l?"bg-blue-100 dark:bg-gray-600 text-blue-900 dark:text-white":"text-gray-900 dark:text-gray-100"}`,children:({selected:l})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${l?"font-medium":"font-normal"}`,children:g.namaTim}),l&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600 dark:text-blue-400",children:e.jsx(Ie,{className:"h-4 w-4","aria-hidden":"true"})})]})},g.id))]})]})})})]})}const va=[{key:"harian",label:"Harian"},{key:"mingguan",label:"Mingguan"},{key:"bulanan",label:"Bulanan"}];function Ma({activeTab:a,onChange:r}){return e.jsx("div",{className:"flex flex-wrap gap-2",role:"tablist",children:va.map(m=>{const o=a===m.key;return e.jsx("button",{onClick:()=>r(m.key),role:"tab","aria-selected":o,className:`px-4 py-2 rounded-lg font-semibold transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2
              ${o?"bg-blue-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-200 dark:hover:bg-gray-600"}
            `,children:m.label},m.key)})})}const Da=({user:a,boxClass:r,currentUser:m})=>{const o=m&&(a.userId===m.id||a.nama===m.nama);return e.jsxs("tr",{className:`text-center transition-colors duration-200 border-b border-gray-200 dark:border-gray-700 odd:bg-gray-50/60 dark:odd:bg-gray-800/40 ${o?"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border-r border-gray-300 dark:border-gray-700 w-60 md:w-72 whitespace-nowrap overflow-hidden text-ellipsis",title:a.nama,children:a.nama}),a.detail.map(d=>e.jsx("td",{title:d.count?`${d.count} laporan`:"",className:`px-4 py-2 border border-gray-300 dark:border-gray-600 text-center align-middle ${r(d)} truncate`,children:d.count||""},d.tanggal))]})},Ca=({data:a=[],monthIndex:r,year:m})=>{const{user:o}=$e(),d=Array.isArray(a)?a:[],n=Te().tz("Asia/Makassar"),j=xa(m),E=c=>{const x=Te.utc(c).tz("Asia/Makassar");return x.day()===0||x.day()===6},R=c=>j.includes(Te.utc(c).tz("Asia/Makassar").format("YYYY-MM-DD")),I=c=>c.count>0?"bg-green-100 dark:bg-green-700 text-green-900 dark:text-green-100":E(c.tanggal)||R(c.tanggal)?"bg-blue-100 dark:bg-blue-700 text-blue-900 dark:text-blue-100":Te.utc(c.tanggal).tz("Asia/Makassar").isBefore(n,"day")?"bg-yellow-100 dark:bg-yellow-700 text-yellow-900 dark:text-yellow-100":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300",P=Te().year(m).month(r).daysInMonth();return e.jsx("div",{className:"overflow-x-auto w-full rounded-md shadow border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 max-h-[65vh] overflow-y-auto",children:e.jsxs("table",{className:"min-w-[1000px] w-full table-fixed text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 px-4 py-2 text-left font-bold border-r border-gray-300 dark:border-gray-700 w-48 md:w-60",children:"Nama"}),Array.from({length:P},(c,x)=>e.jsx("th",{className:"p-0 w-10 border-r border-gray-300 dark:border-gray-700 text-center align-middle",children:e.jsx("div",{className:"flex items-center justify-center px-2 py-2",children:e.jsx("span",{className:"tabular-nums text-sm font-medium",children:x+1})})},x))]})}),e.jsx("tbody",{children:d.length>0?d.map(c=>e.jsx(Da,{user:c,boxClass:I,currentUser:o},c.userId)):e.jsx("tr",{children:e.jsx("td",{colSpan:P+1,className:"px-4 py-4 text-center text-gray-500 dark:text-gray-400",children:"Belum ada laporan"})})})]})})};function $a(a){return a>=80?"green":a>=50?"yellow":"red"}function He(a){const r=$a(a);return r==="green"?"bg-green-500":r==="yellow"?"bg-yellow-500":"bg-red-500"}const Ea=({user:a,progressColor:r,weekCount:m,currentUser:o})=>{const d=o&&(a.userId===o.id||a.nama===o.nama);return e.jsxs("tr",{className:`text-center text-sm transition-colors duration-200 odd:bg-gray-50/60 dark:odd:bg-gray-800/40 ${d?"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border border-gray-200 dark:border-gray-600 w-60 md:w-72 whitespace-nowrap overflow-hidden text-ellipsis",title:a.nama,children:a.nama}),a.weeks.slice(0,m).map((n,j)=>e.jsxs("td",{className:"p-2 border border-gray-200 dark:border-gray-600 space-y-1",children:[e.jsxs("span",{className:`inline-block text-[10px] font-semibold px-2 py-0.5 rounded-full ${n.persen>=80?"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200":n.persen>=50?"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200":"bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200"}`,children:[n.persen,"%"]}),e.jsx("div",{role:"progressbar","aria-valuenow":n.persen,"aria-valuemin":"0","aria-valuemax":"100",className:"w-full bg-gray-200 dark:bg-gray-700 rounded h-2 overflow-hidden",children:e.jsx("div",{className:`${r(n.persen)} h-2 transition-all duration-300`,style:{width:`${n.persen}%`}})})]},j))]})},Ia=({data:a=[],weeks:r=[],onSelectWeek:m,selectedWeek:o})=>{const{user:d}=$e(),[n,j]=h.useState("week"),[E,R]=h.useState(0),[I,P]=h.useState("desc"),c=He;n==="week"&&r[o];const x=h.useMemo(()=>{const g=Array.isArray(a)?[...a]:[],l=I==="asc"?1:-1;if(n==="name")return g.sort((K,V)=>l*(K?.nama||"").localeCompare(V?.nama||"","id",{sensitivity:"base"}));const t=r[o]?o:E,z=K=>{const V=Array.isArray(K?.weeks)?K.weeks:[],ce=V[t];if(ce&&typeof ce.persen=="number")return ce.persen;const i=V.reduce((N,w)=>N+(Number(w?.persen)||0),0),s=V.length||1;return Math.round(i/s)};return g.sort((K,V)=>l*(z(K)-z(V)))},[a,n,I,r,o,E]),p=()=>{n==="name"?P(g=>g==="asc"?"desc":"asc"):(j("name"),P("asc"))},M=g=>{m&&m(g),n==="week"&&E===g?P(l=>l==="asc"?"desc":"asc"):(j("week"),R(g),P("desc"))},T=({active:g})=>g?I==="asc"?e.jsx(_e,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(Ge,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(Ye,{className:"inline-block w-3.5 h-3.5 opacity-40 align-middle"});return e.jsx("div",{className:"overflow-x-auto w-full rounded-md shadow border border-gray-200 dark:border-gray-700 max-h-[65vh]",children:e.jsxs("table",{className:"min-w-[1000px] w-full table-fixed text-sm border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-900 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-white dark:bg-gray-900 p-2 text-left font-bold border-l border-r border-gray-300 dark:border-gray-700 w-48 md:w-60 select-none cursor-pointer",onClick:p,title:"Urutkan berdasarkan Nama",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Nama ",e.jsx(T,{active:n==="name"})]})}),r.map((g,l)=>e.jsx("th",{onClick:()=>M(l),className:`p-2 border-r border-gray-300 dark:border-gray-700 text-center font-medium cursor-pointer select-none transition-colors duration-200 ${o===l?"bg-blue-200 dark:bg-blue-600 text-blue-900 dark:text-blue-100":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:["Minggu ",l+1," ",e.jsx(T,{active:n==="week"&&(E===l||o===l)})]})},l))]})}),e.jsx("tbody",{children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:r.length+1,className:"p-4 text-center text-gray-500",children:"Belum ada data"})}):x.map(g=>e.jsx(Ea,{user:g,progressColor:c,weekCount:r.length,currentUser:d},g.userId))})]})})},Ta=({data:a=[]})=>{const{user:r}=$e();if(!Array.isArray(a)||a.length===0)return null;const m=He,[o,d]=h.useState("name"),[n,j]=h.useState("asc"),E=p=>{o===p?j(M=>M==="asc"?"desc":"asc"):(d(p),j(p==="name"?"asc":"desc"))},R=h.useMemo(()=>{const p=[...a],M=n==="asc"?1:-1,T=(g,l)=>{if(o==="name")return M*(g?.nama||"").localeCompare(l?.nama||"","id",{sensitivity:"base"});const t=Number(o),z=Number(g?.months?.[t]?.persen)||0,K=Number(l?.months?.[t]?.persen)||0;return M*(z-K)};return p.sort(T)},[a,o,n]),I=ge.length,P=Array.from({length:I},(p,M)=>{const T=a.map(l=>Number(l?.months?.[M]?.persen||0)).filter(l=>Number.isFinite(l));if(!T.length)return 0;const g=T.reduce((l,t)=>l+t,0);return Math.round(g/T.length)}),c=new Date().getMonth(),x=({active:p,dir:M})=>p?M==="asc"?e.jsx(_e,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(Ge,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(Ye,{className:"inline-block w-3.5 h-3.5 opacity-40 align-middle"});return e.jsx("div",{className:"overflow-x-auto w-full mt-4 rounded-md border border-gray-200 dark:border-gray-700 shadow bg-white dark:bg-gray-900 max-h-[65vh]",children:e.jsxs("table",{className:"min-w-[1000px] w-full table-fixed text-sm border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 px-4 py-2 text-left font-bold border-r border-gray-300 dark:border-gray-700 w-48 md:w-60 select-none cursor-pointer",onClick:()=>E("name"),title:"Urutkan berdasarkan Nama",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Nama ",e.jsx(x,{active:o==="name",dir:n})]})}),ge.map((p,M)=>e.jsx("th",{title:`Urutkan berdasarkan ${p}`,onClick:()=>E(M),className:`px-4 py-2 text-center font-semibold border-r border-gray-300 dark:border-gray-700 select-none cursor-pointer ${M===c?"bg-blue-100 dark:bg-blue-800":""}`,children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:[p.slice(0,3)," ",e.jsx(x,{active:o===M,dir:n})]})},M))]})}),e.jsx("tbody",{children:R.map(p=>{const M=r&&(p.userId===r.id||p.nama===r.nama);return e.jsxs("tr",{className:`text-center transition-colors duration-200 border-b border-gray-200 dark:border-gray-700 odd:bg-gray-50/60 dark:odd:bg-gray-800/40 ${M?"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border-r border-gray-300 dark:border-gray-700 w-60 md:w-72 whitespace-nowrap overflow-hidden text-ellipsis",title:p.nama,children:p.nama}),p.months.map((T,g)=>e.jsxs("td",{className:`px-4 py-2 border-r border-gray-200 dark:border-gray-600 space-y-1 ${g===c?"bg-blue-50 dark:bg-blue-900/40":""}`,title:`${ge[g]}: ${T.persen}% capaian`,children:[e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:`inline-block text-[10px] font-semibold px-2 py-0.5 rounded-full ${T.persen>=80?"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200":T.persen>=50?"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200":"bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200"}`,children:[T.persen,"%"]})}),e.jsx("div",{role:"progressbar","aria-valuenow":T.persen,"aria-valuemin":"0","aria-valuemax":"100",className:"w-full bg-gray-200 dark:bg-gray-700 rounded h-2 overflow-hidden",children:e.jsx("div",{className:`${m(T.persen)} h-2 transition-all duration-300`,style:{width:`${T.persen}%`}})})]},g))]},p.userId)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 border-t border-gray-300 dark:border-gray-700",children:[e.jsx("td",{className:"sticky left-0 z-10 bg-gray-50 dark:bg-gray-800 px-4 py-2 text-left font-bold border-r border-gray-300 dark:border-gray-700 w-60 md:w-72",children:"Rata-rata"}),P.map((p,M)=>e.jsxs("td",{className:"px-4 py-2 border-r border-gray-200 dark:border-gray-600 space-y-1",children:[e.jsxs("span",{className:"text-xs font-medium block text-center",children:[p,"%"]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded h-2 overflow-hidden",children:e.jsx("div",{className:`${m(p)} h-2 transition-all duration-300`,style:{width:`${p}%`}})})]},M))]})})]})})},aa=({data:a=[]})=>{const{user:r}=$e(),m=Array.isArray(a)?a:[],o=He,[d,n]=h.useState("nama"),[j,E]=h.useState("asc"),R=h.useMemo(()=>{const c=[...m],x=(p,M)=>{const T=j==="asc"?1:-1;if(d==="nama")return T*(p?.nama||"").localeCompare(M?.nama||"","id",{sensitivity:"base"});const g=Number(p?.[d])||0,l=Number(M?.[d])||0;return T*(g-l)};return c.sort(x)},[m,d,j]),I=c=>{d===c?E(x=>x==="asc"?"desc":"asc"):(n(c),E(c==="nama"?"asc":"desc"))},P=({active:c,dir:x})=>c?x==="asc"?e.jsx(_e,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(Ge,{className:"inline-block w-3.5 h-3.5 align-middle"}):e.jsx(Ye,{className:"inline-block w-3.5 h-3.5 opacity-40 align-middle"});return e.jsx("div",{className:"overflow-x-auto w-full mt-4 rounded-md border border-gray-200 dark:border-gray-700 shadow bg-white dark:bg-gray-900 max-h-[65vh]",children:e.jsxs("table",{className:"min-w-[900px] w-full table-fixed text-sm border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-white dark:bg-gray-900 p-2 text-left font-bold border-l border-r border-gray-300 dark:border-gray-700 w-48 md:w-60 select-none cursor-pointer",onClick:()=>I("nama"),title:"Urutkan berdasarkan Nama",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Nama ",e.jsx(P,{active:d==="nama",dir:j})]})}),e.jsx("th",{className:"px-2 py-2 border-r text-center font-semibold w-24 select-none cursor-pointer",onClick:()=>I("selesai"),title:"Urutkan berdasarkan Tugas Selesai",children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:["Tugas Selesai ",e.jsx(P,{active:d==="selesai",dir:j})]})}),e.jsx("th",{className:"px-2 py-2 border-r text-center font-semibold w-24 select-none cursor-pointer",onClick:()=>I("total"),title:"Urutkan berdasarkan Total Tugas",children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:["Total Tugas ",e.jsx(P,{active:d==="total",dir:j})]})}),e.jsx("th",{className:"px-2 py-2 border-r text-center font-semibold w-40 select-none cursor-pointer",onClick:()=>I("persen"),title:"Urutkan berdasarkan Capaian",children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-1",children:["Capaian ",e.jsx(P,{active:d==="persen",dir:j})]})})]})}),e.jsx("tbody",{children:R.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-500",children:"Belum ada data"})}):R.map(c=>{const x=r&&(c.userId===r.id||c.nama===r.nama);return e.jsxs("tr",{className:`text-center transition-colors duration-200 border-b border-gray-200 dark:border-gray-700 odd:bg-gray-50/60 dark:odd:bg-gray-800/40 ${x?"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border-l border-r border-gray-300 dark:border-gray-700 w-60 md:w-72 whitespace-nowrap overflow-hidden text-ellipsis",title:c.nama,children:c.nama}),e.jsx("td",{className:"px-2 py-2 border-r text-center tabular-nums w-24",children:c.selesai}),e.jsx("td",{className:"px-2 py-2 border-r text-center tabular-nums w-24",children:c.total}),e.jsxs("td",{className:"px-2 py-2 border-r space-y-1 w-40",children:[e.jsxs("span",{className:`inline-block text-[10px] font-semibold px-2 py-0.5 rounded-full text-center ${c.persen>=80?"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200":c.persen>=50?"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200":"bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200"}`,children:[c.persen,"%"]}),e.jsx("div",{role:"progressbar","aria-valuenow":c.persen,"aria-valuemin":"0","aria-valuemax":"100",className:"w-28 mx-auto bg-gray-200 dark:bg-gray-700 rounded h-2 overflow-hidden",children:e.jsx("div",{className:`${o(c.persen)} h-2 transition-all duration-300`,style:{width:`${c.persen}%`}})})]})]},c.userId)})})]})})};function Pa({dayCount:a=30,rows:r=8}){const m=Math.max(28,Math.min(31,Number(a)||30)),o=Math.max(5,Math.min(12,Number(r)||8));return e.jsx("div",{className:"overflow-x-auto w-full rounded-md shadow border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 max-h-[65vh]",children:e.jsxs("table",{className:"min-w-[1000px] w-full table-fixed text-sm border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-b border-gray-300 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-30 bg-gray-50 dark:bg-gray-800 px-4 py-2 text-left font-bold border-r border-gray-300 dark:border-gray-700 w-48 md:w-60",children:e.jsx(Le,{className:"h-4 w-24"})}),Array.from({length:m}).map((d,n)=>e.jsx("th",{className:"p-0 w-10 border-r border-gray-300 dark:border-gray-700 text-center align-middle",children:e.jsx("div",{className:"flex items-center justify-center px-2 py-2",children:e.jsx(Le,{className:"h-4 w-6"})})},n))]})}),e.jsx("tbody",{children:Array.from({length:o}).map((d,n)=>e.jsxs("tr",{className:"text-center transition-colors duration-200 border-b border-gray-200 dark:border-gray-700 odd:bg-gray-50/60 dark:odd:bg-gray-800/40",children:[e.jsx("td",{className:"sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 text-left font-semibold border-r border-gray-300 dark:border-gray-700 w-60 md:w-72",children:e.jsx(Le,{className:"h-4 w-40"})}),Array.from({length:m}).map((j,E)=>e.jsx("td",{className:"px-2 py-2 border border-gray-300 dark:border-gray-600 text-center align-middle",children:e.jsx(Le,{className:"h-5 w-8 mx-auto"})},E))]},n))})]})})}function Fa({activeTab:a,monthIndex:r,weekIndex:m,weekStarts:o,year:d,teamId:n="",monthlyMode:j,onMonthlyModeChange:E,contentRef:R,lastUpdateText:I="",lastUpdateIso:P=""}){const c=D=>{if(!D)return"";const v=new Date(D),$=v.toLocaleDateString("id-ID",{timeZone:"Asia/Makassar",weekday:"long",day:"numeric",month:"long",year:"numeric"}),U=v.toLocaleTimeString("en-GB",{timeZone:"Asia/Makassar",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return`${$} pukul ${U} WITA`},[x,p]=h.useState(!1),[M,T]=h.useState(!1),[g,l]=h.useState(!1),[t,z]=h.useState(!1),[K,V]=h.useState(!1),[ce,i]=h.useState([]),[s,N]=h.useState([]),[w,te]=h.useState([]),[oe,Se]=h.useState([]),[Ke,ca]=h.useState([]),[Ze,da]=h.useState([]),[ma,qe]=h.useState([]),[ga,Je]=h.useState(!1),[ua,ya]=h.useState("current"),[Pe,Ve]=h.useState("summary"),pe=["Admin Utama","Yuda Agus Irianto"],{user:fe}=$e(),[ve,Xe]=h.useState([]),Fe=D=>Array.isArray(D)?D.filter(v=>!pe.includes(v?.nama)):[];h.useEffect(()=>{a==="mingguan"&&Ve("summary"),a==="bulanan"&&Qe("current")},[a]);const Ue=j??ua;function Qe(D){j===void 0&&ya(D),E&&E(D)}if(h.useEffect(()=>{(async()=>{try{V(!0);const v=fe?.role===Ae.ADMIN||fe?.role===Ae.PIMPINAN||fe?.role===Ae.KETUA?"/tugas-tambahan/all":"/tugas-tambahan",$={};fe?.role===Ae.ANGGOTA&&($.userId=fe.id);const U=await q.get(v,{params:{teamId:n||void 0,...$}}),ie=Array.isArray(U.data)?U.data:Array.isArray(U.data?.data)?U.data.data:[];Xe(ie)}catch{Xe([])}finally{V(!1)}})()},[a,r,n,d,fe?.role]),h.useEffect(()=>{a==="harian"&&(async()=>{try{p(!0);const v=String(r+1).padStart(2,"0"),$=`${d}-${v}-01`,U=await q.get("/monitoring/harian/bulan",{params:{tanggal:$,teamId:n||void 0}});i(Fe(U.data))}catch(v){Ce(v,"Gagal mengambil monitoring harian")}finally{p(!1)}})()},[a,r,n,d]),h.useEffect(()=>{(async()=>{if(!(!o.length||a!=="mingguan"))try{T(!0);const v=new Date(o[m]),$=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}`,U={};fe?.role===Ae.ANGGOTA&&(U.userId=fe.id);const[ie,re,X]=await Promise.all([q.get("/monitoring/mingguan/all",{params:{minggu:$,teamId:n||void 0,...U}}),q.get("/monitoring/penugasan/minggu",{params:{minggu:$,teamId:n||void 0,...U}}),q.get("/penugasan/minggu/all",{params:{minggu:$}})]),xe=Fe(ie.data),be=Fe(re.data),Me=Array.isArray(X.data)?X.data:[],we=!n&&Array.isArray(Me)&&Me.length>0,ke=new Date(v);ke.setDate(v.getDate()+6);const De=u=>{const Y=new Date(u);return Y>=v&&Y<=ke},B=m+1,A=r+1,y=d,O=(Array.isArray(ve)?ve:[]).filter(u=>{if(u.tanggal){const C=new Date(u.tanggal),G=De(u.tanggal),H=C.getFullYear()===y&&C.getMonth()+1===A&&ea(C)===B;return G||H}if(u.minggu!==void 0&&u.minggu!==null&&u.bulan!==void 0&&u.bulan!==null&&u.tahun!==void 0&&u.tahun!==null){const C=parseInt(u.minggu,10),G=parseInt(u.bulan,10),H=parseInt(u.tahun,10);return C===B&&G===A&&H===y}return!1}),W=u=>String(u?.userId??u?.pegawaiId??u?.user?.id??u?.pegawai?.id??u?.id??u?.nama),Q=u=>u?.user?.nama??u?.pegawai?.nama??u?.nama??u?.fullName??u?.name??"-",J=new Map,se=new Map,ue=u=>typeof u=="string"?u.toLowerCase().replace(/\s+/g," ").trim():"";(Array.isArray(xe)?xe:[]).forEach(u=>{const Y=W(u),C=Q(u);J.set(Y,{nama:C,total:0,selesai:0}),C&&se.set(ue(C),Y)}),we||(Array.isArray(be)?be:[]).forEach(u=>{const Y=W(u),C=Q(u),G=J.has(Y)?Y:C&&se.has(ue(C))?se.get(ue(C)):Y,H=J.get(G)||{nama:C,total:0,selesai:0},ae=u?.total??u?.totalTugas??0,b=u?.selesai??u?.done??0;H.total=(H.total||0)+(typeof ae=="number"?ae:0),H.selesai=(H.selesai||0)+(typeof b=="number"?b:0),!J.has(G)&&C&&se.set(ue(C),G),J.set(G,H)}),we&&Me.forEach(u=>{const Y=u?.nama||u?.user?.nama||u?.pegawai?.nama;if(!Y)return;const C=se.get(ue(Y));if(!C)return;const G=J.get(C)||{nama:Y,total:0,selesai:0},H=Array.isArray(u.tugas)?u.tugas:[],ae=H.length,b=H.filter(S=>S.status===ze.SELESAI_DIKERJAKAN).length;G.total=(G.total||0)+ae,G.selesai=(G.selesai||0)+b,J.set(C,G)});const ye=new Map;O.forEach(u=>{const Y=W(u),C=Q(u),H=(C?se.get(ue(C)):void 0)??(J.has(Y)?Y:void 0);if(!H)return;const ae=ye.get(H)||{nama:C,total:0,selesai:0};ae.total+=1,u.status===ze.SELESAI_DIKERJAKAN&&(ae.selesai+=1),ye.set(H,ae)});const Ne=[...new Set([...J.keys(),...ye.keys()])].map(u=>{const Y=J.get(u)||{nama:ye.get(u)?.nama||"-",total:0,selesai:0},C=ye.get(u)||{total:0,selesai:0},G=(Y.total||0)+(C.total||0),H=(Y.selesai||0)+(C.selesai||0),ae=G?Math.round(H/G*100):0;return{userId:u,nama:Y.nama,total:G,selesai:H,persen:ae}}).filter(u=>!pe.includes(u.nama));te(Ne)}catch(v){Ce(v,"Gagal mengambil monitoring mingguan")}finally{T(!1)}})()},[a,m,o,n,d,r,ve]),h.useEffect(()=>{if(!Array.isArray(s)||s.length===0){Se(s);return}const D=new Map;(Array.isArray(w)?w:[]).forEach($=>{const U=$?.userId!=null?String($.userId):void 0,ie=($?.nama||"").toLowerCase().replace(/\s+/g," ").trim();U&&D.set(U,$.persen),ie&&D.set(ie,$.persen)});const v=s.map($=>{const U=$?.userId!=null?String($.userId):void 0,ie=($?.nama||"").toLowerCase().replace(/\s+/g," ").trim(),re=(U&&D.get(U))??D.get(ie);if(typeof re=="number"&&Array.isArray($.weeks)&&$.weeks[m]){const X=$.weeks.slice();return X[m]={...X[m],persen:re},{...$,weeks:X}}return $});Se(v)},[s,w,m]),h.useEffect(()=>{(async()=>{if(a==="mingguan")try{l(!0);const v=String(r+1).padStart(2,"0"),$=`${d}-${v}-01`,U=await q.get("/monitoring/mingguan/bulan",{params:{tanggal:$,teamId:n||void 0}});N(Fe(U.data))}catch(v){Ce(v,"Gagal mengambil monitoring mingguan per bulan")}finally{l(!1)}})()},[a,r,n,d]),h.useEffect(()=>{(async()=>{if(a==="bulanan")try{z(!0);const[v,$,U]=await Promise.all([q.get("/monitoring/bulanan/matrix",{params:{year:d,teamId:n||void 0}}),q.get("/teams/all").catch(()=>({data:[]})),Promise.all(Array.from({length:12},(y,O)=>{const W=String(O+1).padStart(2,"0"),Q=`${d}-${W}-01`;return q.get("/monitoring/mingguan/bulan",{params:{tanggal:Q,teamId:n||void 0}}).then(J=>({status:"fulfilled",data:J.data})).catch(()=>({status:"rejected",data:[]}))}))]),re=(Array.isArray(v.data)?v.data:[]).filter(y=>!pe.includes(y?.nama));ca(re);let X=Array.isArray($.data)?$.data:[];if(!Array.isArray(X)||X.length===0)try{const y=await q.get("/teams");if(X=Array.isArray(y.data)?y.data:[],X.length===0){const O=await q.get("/teams/member");X=Array.isArray(O.data)?O.data:[]}}catch{X=[]}const xe=n?X.filter(y=>String(y?.id)===String(n)):X,be=new Map;xe.forEach(y=>{(Array.isArray(y?.members)?y.members:[]).forEach(W=>{const Q=W?.userId??W?.id??W?.user?.id??W?.pegawaiId??W?.pegawai?.id,J=W?.nama??W?.user?.nama??W?.pegawai?.nama??W?.fullName??W?.name;if(!J||pe.includes(J))return;const se=Q?String(Q):`nama:${J}`;be.has(se)||be.set(se,{id:Q??null,nama:J})})});const we=Array.from(be.values()).map(y=>({id:y.id??y.nama,nama:y.nama})).map(y=>({userId:y.id,nama:y.nama,months:Array.from({length:12},()=>({persen:0}))})),ke=y=>typeof y=="string"?y.toLowerCase().replace(/\s+/g," ").trim():"",De=we.map(y=>{const O=ke(y.nama),W=re.find(Q=>Q.userId===y.userId||ke(Q.nama)===O);return W?{...y,months:W.months}:y});let B=De.length>0?De:re;try{const y=new Date(d,r,1),O=new Date(d,r+1,0),W=(()=>{const b=[],S=new Date(y);S.setDate(S.getDate()-(S.getDay()+6)%7);for(let _=new Date(S);_<=O;_.setDate(_.getDate()+7))b.push(new Date(_));return b})(),Q=b=>`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}-${String(b.getDate()).padStart(2,"0")}`,J=await Promise.all(W.map(b=>q.get("/penugasan/minggu/all",{params:{minggu:Q(b)}}).then(S=>Array.isArray(S.data)?S.data:[]).catch(()=>[]))),se=b=>typeof b=="string"?b.toLowerCase().replace(/\s+/g," ").trim():"",ue=(b,S)=>S!=null?String(S):`nama:${se(b)}`,ye=b=>{const S=b?.nama,_=b?.userId;if(_==null)return`nama:${se(S)}`;const f=String(_);return typeof S=="string"&&f===S?`nama:${se(S)}`:(f.startsWith("nama:"),f)},Be=new Set((Array.isArray(B)?B:[]).map(b=>ye(b)).filter(Boolean)),Ne=new Map,u=W.map((b,S)=>{const _=new Date(b);_.setDate(b.getDate()+6);const f=Array.isArray(J[S])?J[S]:[],F=new Map;f.forEach(k=>{const ne=k?.nama||k?.user?.nama||k?.pegawai?.nama,de=k?.userId||k?.id||k?.user?.id||k?.pegawai?.id;if(!ne||pe.includes(ne))return;const me=ue(ne,de);Ne.set(me,ne);const he=Array.isArray(k.tugas)?k.tugas:[],Ee=he.length,ha=he.filter(ba=>ba.status===ze.SELESAI_DIKERJAKAN).length;F.set(me,{total:Ee,selesai:ha})});const Z=(Array.isArray(ve)?ve:[]).filter(k=>{if(k?.tanggal){const de=new Date(k.tanggal);return de>=b&&de<=_}if((k?.minggu??null)!==null&&(k?.bulan??null)!==null&&(k?.tahun??null)!==null){const de=parseInt(k.minggu,10),me=parseInt(k.bulan,10),he=parseInt(k.tahun,10),Ee=ea(b);return de===Ee&&me===b.getMonth()+1&&he===b.getFullYear()}return!1}),L=new Map;Z.forEach(k=>{const ne=k?.user?.nama||k?.pegawai?.nama||k?.nama,de=k?.userId??k?.pegawaiId??k?.user?.id??k?.pegawai?.id;if(!ne||pe.includes(ne))return;const me=ue(ne,de);Ne.set(me,ne);const he=L.get(me)||{total:0,selesai:0};he.total+=1,k.status===ze.SELESAI_DIKERJAKAN&&(he.selesai+=1),L.set(me,he)});const le=new Map;return new Set([...Be,...F.keys(),...L.keys()]).forEach(k=>{if(!k)return;const ne=F.get(k)||{total:0,selesai:0},de=L.get(k)||{total:0,selesai:0},me=(ne.total||0)+(de.total||0),he=(ne.selesai||0)+(de.selesai||0),Ee=me?Math.round(he/me*100):0;le.set(k,Ee)}),le}),Y=W.length||1,C=new Map,G=new Set;u.forEach(b=>b.forEach((S,_)=>G.add(_)));const H=new Set([...Array.from(Be.values()),...Array.from(G.values())]);if(H.forEach(b=>{let S=0;for(let _=0;_<u.length;_++){const f=u[_];S+=f.get(b)||0}C.set(b,Math.round(S/Y))}),C.size>0&&Array.isArray(B)){const b=new Map(B.map(f=>[ye(f),f])),S=[];H.forEach(f=>{if(!b.has(f)){const F=Ne.get(f)||(String(f).startsWith("nama:")?String(f).slice(5):String(f)),Z=Array.from({length:12},()=>({persen:0}));Z[r]={persen:C.get(f)||0};const L=typeof f=="string"&&f.startsWith("nama:")?null:String(f);S.push({userId:L,nama:F,months:Z})}});const _=new Map;C.forEach((f,F)=>{const Z=Ne.get(F),L=typeof Z=="string"?Z:String(F).startsWith("nama:")?String(F).slice(5):void 0;L&&_.set(L.toLowerCase().replace(/\s+/g," ").trim(),f)}),B=B.map(f=>{const F=ye(f);let Z=C.get(F);if(typeof Z!="number"){const L=(f?.nama||"").toLowerCase().replace(/\s+/g," ").trim();Z=_.get(L)}if(typeof Z=="number"&&Array.isArray(f.months)){const L=f.months.slice();return L[r]={persen:Z},{...f,months:L}}return f}),!n&&S.length&&(B=[...B,...S])}let ae=C.size===0||Array.from(C.values()).every(b=>!b||b===0);if(ae&&Array.isArray(B))try{const b=await Promise.all(W.map(F=>q.get("/monitoring/mingguan/all",{params:{minggu:Q(F),teamId:n||void 0}}).then(Z=>Array.isArray(Z.data)?Z.data:[]).catch(()=>[]))),S=new Map,_=W.length||1,f=F=>typeof F=="string"?F.toLowerCase().replace(/\s+/g," ").trim():"";for(let F=0;F<b.length;F++)b[F].forEach(L=>{const le=ue(L?.nama,L?.userId??L?.id),je=Number(L?.persen)||0,k=S.get(le)||0;S.set(le,k+je)});S.size>0&&(B=B.map(F=>{const Z=ye(F);let L=S.get(Z);if(typeof L!="number"){const le=f(F?.nama),je=Array.from(S.entries()).find(([k])=>(Ne.get(k)||(String(k).startsWith("nama:")?String(k).slice(5):""))?.toLowerCase().replace(/\s+/g," ").trim()===le);je&&(L=je[1])}if(typeof L=="number"&&Array.isArray(F.months)){const le=F.months.slice();return le[r]={persen:Math.round(L/_)},{...F,months:le}}return F}),ae=!1)}catch{}if(ae&&Array.isArray(B)){const b=Array.isArray(oe)&&oe.length?oe:Array.isArray(s)&&s.length?s:[];if(b.length){const S=new Map,_=Array.isArray(b[0]?.weeks)&&b[0].weeks.length||5;b.forEach(f=>{const F=(f?.nama||"").toLowerCase().replace(/\s+/g," ").trim(),L=(Array.isArray(f?.weeks)?f.weeks:[]).reduce((je,k)=>je+(Number(k?.persen)||0),0),le=Math.round(L/Math.max(_,1));S.set(F,le)}),B=B.map(f=>{const F=(f?.nama||"").toLowerCase().replace(/\s+/g," ").trim(),Z=S.get(F);if(typeof Z=="number"&&Array.isArray(f.months)){const L=f.months.slice();return L[r]={persen:Z},{...f,months:L}}return f})}}}catch{}const A=[...B].sort((y,O)=>(y?.nama||"").localeCompare(O?.nama||"","id",{sensitivity:"base"}));da(A)}catch(v){Ce(v,"Gagal mengambil monitoring bulanan")}finally{z(!1)}})()},[a,d,n,r,m,w,ve]),h.useEffect(()=>{(async()=>{if(a!=="bulanan")return;const v=Number(r+1);if(!(!v||v<1||v>12))try{Je(!0);const $=String(v),[U,ie]=await Promise.all([q.get("/monitoring/bulanan/all",{params:{year:d,bulan:$,teamId:n||void 0}}),q.get("/teams/all").catch(()=>({data:[]}))]),re=Array.isArray(U.data)?U.data:[],X=Array.isArray(ie.data)?ie.data:[],xe=[];X.forEach(A=>{if(n&&A.id!==n)return;(Array.isArray(A.members)?A.members:[]).forEach(O=>{O?.user&&xe.push(O.user)})});const be=new Set,Me=xe.filter(A=>!(!A||!A.id||be.has(A.id)||(be.add(A.id),[Ae.ADMIN,Ae.PIMPINAN].includes(A.role))||pe.includes(A.nama))).map(A=>({userId:String(A.id),nama:A.nama})),we=A=>typeof A=="string"?A.toLowerCase().replace(/\s+/g," ").trim():"",ke=new Map(re.map(A=>[String(A.userId),A])),De=new Map(re.map(A=>[we(A.nama),A])),B=Me.map(A=>{const y=ke.get(String(A.userId))||De.get(we(A.nama)),O=Number(y?.selesai)||0,W=Number(y?.total)||0,Q=W?Math.round(O/W*100):0;return{userId:A.userId,nama:A.nama,selesai:O,total:W,persen:Q}});if(!n&&re.length){const A=new Set(B.map(y=>String(y.userId)));re.forEach(y=>{const O=String(y.userId);!A.has(O)&&!pe.includes(y.nama)&&(A.add(O),B.push({userId:O,nama:y.nama,selesai:Number(y.selesai)||0,total:Number(y.total)||0,persen:Number.isFinite(y.persen)?y.persen:Number(y.total)?Math.round((Number(y.selesai)||0)/Number(y.total)*100):0}))})}B.sort((A,y)=>(A?.nama||"").localeCompare(y?.nama||"","id",{sensitivity:"base"})),qe(B)}catch($){Ce($,"Gagal mengambil capaian bulan ini"),qe([])}finally{Je(!1)}})()},[a,d,r,n]),a==="harian"&&x){const D=new Date(d,r+1,0).getDate();return e.jsx(Pa,{dayCount:D,rows:8})}if(a==="mingguan"&&(M||g)){const D=Pe==="matrix"?Array.isArray(o)?o.length+1:5:4;return e.jsx(Oe,{cols:D})}return e.jsxs("div",{ref:R,children:[a==="harian"&&e.jsx(e.Fragment,{children:e.jsx(Ca,{data:ce,monthIndex:r,year:d})}),a==="mingguan"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",role:"tablist",children:["summary","matrix"].map(D=>e.jsx("button",{type:"button",onClick:()=>Ve(D),role:"tab","aria-selected":Pe===D,className:`px-4 py-1.5 rounded-lg font-semibold text-sm shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 transition-colors duration-150 ease-in-out ${Pe===D?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:D==="summary"?"Ringkasan Minggu":"Ringkasan Bulan"},D))}),(P||I)&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:P?e.jsxs(e.Fragment,{children:["Data diambil pada ",e.jsx("strong",{children:c(P)})]}):I})]}),Pe==="matrix"?e.jsx(Ia,{data:oe.length?oe:s,weeks:o,selectedWeek:m,onSelectWeek:()=>{}}):e.jsx("div",{children:e.jsx(aa,{data:w})})]}),a==="bulanan"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",role:"tablist",children:[{key:"current",label:"Ringkasan Bulan"},{key:"year",label:"Ringkasan Tahun"}].map(D=>e.jsx("button",{type:"button",onClick:()=>Qe(D.key),role:"tab","aria-selected":Ue===D.key,className:`px-4 py-1.5 rounded-lg font-semibold text-sm shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 transition-colors duration-150 ease-in-out ${Ue===D.key?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:D.label},D.key))}),(P||I)&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:P?e.jsxs(e.Fragment,{children:["Data diambil pada ",e.jsx("strong",{children:c(P)})]}):I})]}),Ue==="current"?ga?e.jsx(Oe,{cols:4}):e.jsx(aa,{data:ma}):t?e.jsx(Oe,{cols:13}):Ze.length>0?e.jsx(Ta,{data:Ze}):e.jsx("div",{className:"text-center py-6 text-sm text-gray-500 dark:text-gray-400",children:"Tidak ada data untuk tahun ini."})]})]})}const Re=["Admin Utama","Yuda Agus Irianto"];function Wa(a){return(ge[a]||"").slice(0,3)}function La(a){return new Promise((r,m)=>{const o=new Image;o.onload=()=>r(o),o.onerror=m,o.src=a})}async function oa(a,{title:r,subtitle:m}){const o=a.internal.pageSize.getWidth();try{const d=await La("/logo.png");a.addImage(d,"PNG",40,30,40,40)}catch{}a.setFontSize(12),a.setFont("helvetica","bold"),a.text("BADAN PUSAT STATISTIK",95,45),a.text("KABUPATEN BULUNGAN",95,63),a.setFontSize(16),a.setFont("helvetica","bold"),a.text(r,o/2,95,{align:"center"}),m&&(a.setFontSize(10),a.setFont("helvetica","normal"),a.text(m,o/2,112,{align:"center"}))}function ia(){const a=new Date,r=a.toLocaleDateString("id-ID",{timeZone:"Asia/Makassar",day:"numeric",month:"long",year:"numeric"}),m=a.toLocaleTimeString("en-GB",{timeZone:"Asia/Makassar",hour:"2-digit",minute:"2-digit",hour12:!1});return`${r} pukul ${m} WITA`}async function la(a){if(!a)return"Semua Tim";try{const r=await q.get("/teams/all");return(Array.isArray(r.data)?r.data:[]).find(d=>d.id===a)?.namaTim||"Semua Tim"}catch{return"Semua Tim"}}async function za({year:a,month:r,teamId:m}){const[o,d]=await Promise.all([q.get("/monitoring/bulanan/all",{params:{year:a,bulan:String(r),teamId:m||void 0}}),q.get("/teams/all").catch(()=>({data:[]}))]),n=Array.isArray(o.data)?o.data:[],j=Array.isArray(d.data)?d.data:[],E=[];j.forEach(i=>{if(m&&i.id!==m)return;(Array.isArray(i.members)?i.members:[]).forEach(N=>N?.user&&E.push(N.user))});const R=i=>typeof i=="string"?i.toLowerCase().replace(/\s+/g," ").trim():"",I=new Map,P=new Map,c=(i,s,N)=>{if(!s)return;const w=i.get(s);w?String(w).includes(N)||i.set(s,`${w} / ${N}`):i.set(s,N)};j.forEach(i=>{const s=i?.namaTim||"-";(Array.isArray(i.members)?i.members:[]).forEach(w=>{const te=w?.userId?String(w.userId):w?.user?.id?String(w.user.id):void 0,oe=R(w?.user?.nama);c(I,te,s),c(P,oe,s)})});const x=new Set,p=E.filter(i=>i&&i.id&&!x.has(i.id)&&!Re.includes(i.nama)).map(i=>(x.add(i.id),{userId:String(i.id),nama:i.nama,tim:I.get(String(i.id))||P.get(R(i.nama))||"-"})),M=new Map(n.map(i=>[String(i.userId),i])),T=new Map(n.map(i=>[R(i.nama),i])),g=p.map(i=>{const s=M.get(String(i.userId))||T.get(R(i.nama)),N=Number(s?.selesai)||0,w=Number(s?.total)||0,te=w?Math.round(N/w*100):0;return{userId:i.userId,nama:i.nama,tim:i.tim||"-",selesai:N,total:w,persen:te}});if(!m&&n.length){const i=new Set(g.map(s=>String(s.userId)));n.forEach(s=>{const N=String(s.userId);!i.has(N)&&!Re.includes(s.nama)&&(i.add(N),g.push({userId:N,nama:s.nama,tim:I.get(N)||P.get(R(s.nama))||"-",selesai:Number(s.selesai)||0,total:Number(s.total)||0,persen:Number.isFinite(s.persen)?Number(s.persen):Number(s.total)?Math.round((Number(s.selesai)||0)/Number(s.total)*100):0}))})}g.sort((i,s)=>(i?.nama||"").localeCompare(s?.nama||"","id",{sensitivity:"base"}));const l=new ra({orientation:"portrait",unit:"pt",format:"A4"}),t=ge[r-1],z=await la(m);await oa(l,{title:`Capaian Kinerja Pegawai Bulan ${t} ${a}`,subtitle:`${z} • Dicetak: ${ia()}`});const K=g.map((i,s)=>[s+1,i.nama,i.tim,i.total,i.selesai,`${i.persen}%`]);sa(l,{startY:130,head:[["No","Nama","Tim","Total Tugas","Tugas Selesai","Capaian Kinerja"]],body:K,styles:{fontSize:9,cellPadding:{top:4,bottom:4,left:6,right:6}},headStyles:{fillColor:[239,246,255],textColor:[17,24,39],fontStyle:"bold"},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{halign:"center",cellWidth:28},2:{cellWidth:140},3:{halign:"center"},4:{halign:"center"},5:{halign:"center"}},didParseCell:i=>{if(i.section==="body"&&i.column.index===5){const s=parseInt(String(i.cell.raw).replace(/[^0-9]/g,""),10)||0;s>=80?i.cell.styles.fillColor=[220,252,231]:s>=50?i.cell.styles.fillColor=[254,249,195]:i.cell.styles.fillColor=[254,226,226]}}});const V=l.internal.getNumberOfPages();for(let i=1;i<=V;i++){l.setPage(i);const s=l.internal.pageSize.getWidth(),N=l.internal.pageSize.getHeight();l.setFontSize(8),l.setTextColor(100),l.text("Sumber: SEMAKIN 6502",40,N-16,{align:"left"}),l.text(`Halaman ${i} dari ${V}`,s/2,N-16,{align:"center"})}const ce=`${na("Capaian_Bulanan",r)}.pdf`;l.save(ce)}async function Ra({year:a,teamId:r}){const[m,o]=await Promise.all([q.get("/monitoring/bulanan/matrix",{params:{year:a,teamId:r||void 0}}),q.get("/teams/all").catch(()=>({data:[]}))]),d=Array.isArray(m.data)?m.data:[],n=Array.isArray(o.data)?o.data:[],j=[];n.forEach(t=>{if(r&&t.id!==r)return;(Array.isArray(t.members)?t.members:[]).forEach(K=>K?.user&&j.push(K.user))});const E=new Set,R=j.filter(t=>t&&t.id&&!E.has(t.id)&&!Re.includes(t.nama)).map(t=>(E.add(t.id),{userId:String(t.id),nama:t.nama})),I=new Map(d.map(t=>[String(t.userId),t])),P=new Map(d.map(t=>[(t?.nama||"").toLowerCase().replace(/\s+/g," ").trim(),t])),c=R.map(t=>{const z=I.get(String(t.userId))||P.get((t.nama||"").toLowerCase().replace(/\s+/g," ").trim()),K=ge.map((V,ce)=>({persen:Number(z?.months?.[ce]?.persen||0)}));return{nama:t.nama,months:K}});r||d.forEach(t=>{if(Re.includes(t.nama))return;c.find(K=>K.nama===t.nama)||c.push({nama:t.nama,months:ge.map((K,V)=>({persen:Number(t?.months?.[V]?.persen||0)}))})}),c.sort((t,z)=>(t?.nama||"").localeCompare(z?.nama||"","id",{sensitivity:"base"}));const x=new ra({orientation:"landscape",unit:"pt",format:"A4"}),p=await la(r);await oa(x,{title:`Capaian Kinerja Pegawai Tahun ${a}`,subtitle:`${p} • Dicetak: ${ia()}`});const M=["Nama",...ge.map((t,z)=>Wa(z))],T=c.map(t=>[t.nama,...ge.map((z,K)=>`${Number(t?.months?.[K]?.persen||0)}%`)]);sa(x,{startY:130,head:[M],body:T,styles:{fontSize:8,cellPadding:3},headStyles:{fillColor:[239,246,255],textColor:[17,24,39],fontStyle:"bold"},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{cellWidth:120}},didParseCell:t=>{if(t.section==="body"&&t.column.index>0&&(t.cell.styles.halign="center"),t.section==="head"&&t.column.index>0&&(t.cell.styles.halign="center"),t.section==="body"&&t.column.index>0){const z=parseInt(String(t.cell.raw).replace(/[^0-9]/g,""),10)||0;z>=80?t.cell.styles.fillColor=[220,252,231]:z>=50?t.cell.styles.fillColor=[254,249,195]:t.cell.styles.fillColor=[254,226,226]}}});const g=x.internal.getNumberOfPages();for(let t=1;t<=g;t++){x.setPage(t);const z=x.internal.pageSize.getWidth(),K=x.internal.pageSize.getHeight();x.setFontSize(8),x.setTextColor(100),x.text("Sumber: SEMAKIN 6502",40,K-16,{align:"left"}),x.text(`Halaman ${t} dari ${g}`,z/2,K-16,{align:"center"})}const l=`${na("Capaian_Tahunan",new Date().getMonth()+1)}.pdf`;x.save(l)}const ta=a=>{const r=new Date(a),m=r.toLocaleDateString("id-ID",{timeZone:"Asia/Makassar",weekday:"long",day:"numeric",month:"long",year:"numeric"}),o=r.toLocaleTimeString("en-GB",{timeZone:"Asia/Makassar",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return`${m} pukul ${o} WITA`},Ka=(a,r)=>{const m=new Date(r,a,1),o=new Date(r,a+1,0),d=[],n=new Date(m);n.setDate(n.getDate()-(n.getDay()+6)%7);for(let j=new Date(n);j<=o;j.setDate(j.getDate()+7))d.push(new Date(j));return d};function ot(){const a=pa(),r=fa(),m=h.useRef(!1),[o,d]=h.useState("harian"),[n,j]=h.useState(new Date().getMonth()),[E,R]=h.useState(0),[I,P]=h.useState([]),[c,x]=h.useState(new Date().getFullYear()),[p,M]=h.useState(""),[T,g]=h.useState([]),[l,t]=h.useState(""),[z,K]=h.useState("current"),V=h.useRef(null),ce=s=>s==="harian"?"Daftar Laporan Harian":s==="mingguan"?"Capaian Mingguan Pegawai":"Capaian Bulanan Pegawai",{user:i}=$e();return h.useEffect(()=>{(async()=>{try{const N=await q.get("/teams/all");g(N.data)}catch(N){Ce(N,"Gagal mengambil tim")}})()},[i?.role]),h.useEffect(()=>{const s=async()=>{try{const w=await q.get("/monitoring/last-update");w?.data?.fetchedAt?t(w.data.fetchedAt):w?.headers?.date?t(new Date(w.headers.date).toISOString()):w?.data?.lastUpdate?t(w.data.lastUpdate):t(new Date().toISOString())}catch{}};s();const N=setInterval(s,6e4);return()=>clearInterval(N)},[]),h.useEffect(()=>{if(m.current)return;const s=new URLSearchParams(a.search),N=s.get("tab"),w=parseInt(s.get("month"),10);parseInt(s.get("week"),10);const te=parseInt(s.get("year"),10);["harian","mingguan","bulanan"].includes(N)&&d(N),isNaN(te)||x(te),!isNaN(w)&&w>=1&&w<=12&&j(w-1),m.current=!0},[a.search]),h.useEffect(()=>{const s=Ka(n,c);P(s);const N=new Date,w=s.findIndex(Se=>{const Ke=new Date(Se);return Ke.setDate(Se.getDate()+7),N>=Se&&N<Ke}),te=new URLSearchParams(a.search),oe=parseInt(te.get("week"),10);o==="mingguan"&&!isNaN(oe)&&oe>=1&&oe<=s.length?R(oe-1):n===N.getMonth()&&c===N.getFullYear()&&w!==-1?R(w):R(0)},[n,c,o]),h.useEffect(()=>{if(o!=="mingguan"||I.length===0)return;const s=new Date,N=I.findIndex(w=>{const te=new Date(w);return te.setDate(w.getDate()+7),s>=w&&s<te});n===s.getMonth()&&c===s.getFullYear()&&N!==-1&&R(N)},[o,I,n,c]),h.useEffect(()=>{const s=new URLSearchParams;s.set("tab",o),s.set("month",String(n+1)),s.set("year",String(c)),o==="mingguan"&&s.set("week",String(E+1)),p&&s.set("team",p),r({pathname:a.pathname,search:`?${s.toString()}`},{replace:!0})},[o,n,E,c,p]),e.jsxs("div",{className:"max-w-screen-xl mx-auto px-4 flex flex-col gap-4 pb-10",children:[e.jsx(Ma,{activeTab:o,onChange:d}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg space-y-6",children:[e.jsxs("div",{className:"sticky top-0 z-30 -mx-6 px-6 py-3 bg-white/80 dark:bg-gray-800/80 backdrop-blur supports-[backdrop-filter]:backdrop-blur rounded-t-xl border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between md:items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white tracking-tight",children:ce(o)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Sa,{tab:o,monthlyMode:z,monthIndex:n,setMonthIndex:j,weekIndex:E,setWeekIndex:R,weekStarts:I,year:c,setYear:x,teamId:p,setTeamId:M,teams:T}),o==="bulanan"&&e.jsx(wa,{size:"sm",onClick:async()=>{try{z==="current"?await za({year:c,month:n+1,teamId:p}):await Ra({year:c,teamId:p})}catch(s){console.error("Export failed",s)}},className:"px-4 py-2 bg-red-600 hover:bg-red-700",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ka,{className:"w-4 h-4"})," .pdf"]})})]})]}),o==="harian"&&e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(Na,{className:"mb-3 justify-start"}),l&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Data diambil pada ",e.jsx("strong",{children:ta(l)})]})]}),e.jsx(ja,{mode:"wait",children:e.jsx(Aa.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.25},children:e.jsx(Fa,{activeTab:o,monthIndex:n,weekIndex:E,weekStarts:I,year:c,teamId:p,monthlyMode:z,onMonthlyModeChange:K,contentRef:V,lastUpdateText:l?`Data diambil pada ${ta(l)}`:"",lastUpdateIso:l})},o)})]})]})}export{ot as default,Ka as getWeekStarts};
