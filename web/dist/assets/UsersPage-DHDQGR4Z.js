import{u as W,r,b as o,j as e,R as Q}from"./index-tHDgc07s.js";import{h as p,c as q,s as S,a as O,b as _}from"./alerts-D6uugUBg.js";import{S as J,D as K,a as V,P as X,M as Y}from"./DataTable-CS6-fgxe.js";import{u as Z}from"./useModalForm-xKx7JUaA.js";import{B as d}from"./Button-DTOqL5YY.js";import{L as c,I as h}from"./Label-BFO2ikUa.js";import{T as ee}from"./TableSkeleton-Dxlcfjrc.js";import{P as ae,T as se}from"./trash-2-A_maZEWT.js";import{P as re}from"./plus-CRlAJCsY.js";import"./confirmAlert-BWqzQj7I.js";import"./arrow-up-ffV8zUNQ.js";import"./Skeleton-BCHcvZdc.js";function xe(){const{user:F}=W(),[E,H]=r.useState([]),[y,R]=r.useState([]),[T,b]=r.useState(!0),{showForm:A,form:s,setForm:l,editing:m,openCreate:L,openEdit:w,closeForm:g}=Z({nama:"",email:"",phone:"",password:"",role:""}),[v,D]=r.useState(""),[x,M]=r.useState(""),[n,U]=r.useState(10),[i,u]=r.useState(1);r.useEffect(()=>{j(),z()},[]);const j=async()=>{try{b(!0);const a=await o.get("/users");H(a.data)}catch(a){p(a,"Gagal mengambil pengguna")}finally{b(!1)}},z=async()=>{try{const a=await o.get("/roles");R(a.data)}catch(a){p(a,"Gagal mengambil role")}},N=r.useCallback(a=>{w(a,t=>({nama:t.nama,email:t.email,phone:t.phone||"",password:"",role:t.role}))},[w]),B=async()=>{if(!s.nama||!s.email||!s.phone||!m&&!s.password||!s.role){_("Lengkapi data","Semua field wajib diisi");return}try{m?await o.put(`/users/${m.id}`,s):await o.post("/users",s),g(),j(),S("Berhasil","Pengguna disimpan")}catch(a){p(a,"Gagal menyimpan pengguna")}},k=r.useCallback(async a=>{if((await q("Hapus pengguna ini?")).isConfirmed)try{await o.delete(`/users/${a}`),j(),S("Dihapus","Pengguna berhasil dihapus")}catch(f){p(f,"Gagal menghapus pengguna")}},[]),C=E.filter(a=>{const f=`${a.nama} ${a.email}`.toLowerCase().includes(v.toLowerCase()),$=x?a.role===x:!0;return f&&$}),G=C.slice((i-1)*n,i*n),I=Math.ceil(C.length/n)||1,P=r.useMemo(()=>[{Header:"No",accessor:(a,t)=>(i-1)*n+t+1},{Header:"Nama",accessor:"nama"},{Header:"Email",accessor:"email"},{Header:"WhatsApp",accessor:"phone"},{Header:"Tim",accessor:a=>a.members?.[0]?.team?.namaTim||"-"},{Header:"Role",accessor:"role"},{Header:"Aksi",accessor:"id",Cell:({row:a})=>e.jsxs("div",{className:"space-x-2",children:[e.jsx(d,{onClick:()=>N(a.original),variant:"warning",icon:!0,"aria-label":"Edit",children:e.jsx(ae,{size:16})}),e.jsx(d,{onClick:()=>k(a.original.id),variant:"danger",icon:!0,"aria-label":"Hapus",children:e.jsx(se,{size:16})})]}),disableFilters:!0}],[i,n,N,k]);return F?.role!==Q.ADMIN?e.jsx("div",{className:"p-6 text-center",children:"Anda tidak memiliki akses ke halaman ini."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-end gap-2",children:[e.jsxs("div",{className:"flex items-end gap-2 flex-wrap",children:[e.jsx(J,{value:v,onChange:a=>{D(a.target.value),u(1)},placeholder:"Cari pengguna...",ariaLabel:"Cari pengguna"}),e.jsxs("select",{value:x,onChange:a=>{M(a.target.value),u(1)},className:"cursor-pointer border border-gray-300 dark:border-gray-600 rounded-xl px-2 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Semua role"}),y.map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))]})]}),e.jsxs(d,{onClick:L,className:"add-button",children:[e.jsx(re,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Tambah Pengguna"})]})]}),T?e.jsx(ee,{cols:P.length}):e.jsx(K,{columns:P,data:G,showGlobalFilter:!1,showPagination:!1,selectable:!1}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(V,{pageSize:n,setPageSize:U,setCurrentPage:u,options:[5,10,25,50],className:"w-32"}),e.jsx(X,{currentPage:i,totalPages:I,onPageChange:u})]}),A&&e.jsxs(Y,{onClose:g,titleId:"user-form-title",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{id:"user-form-title",className:"text-xl font-semibold",children:m?"Edit Pengguna":"Tambah Pengguna"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-500",children:"* Fardu 'Ain"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"nama",children:["Nama ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"nama",type:"text",value:s.nama,onChange:a=>l({...s,nama:a.target.value}),className:"w-full border rounded px-3 py-2 bg-white text-gray-900 dark:bg-gray-700 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"email",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"email",type:"email",value:s.email,onChange:a=>l({...s,email:a.target.value}),className:"w-full border rounded px-3 py-2 bg-white text-gray-900 dark:bg-gray-700 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"phone",children:["Nomor WhatsApp ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"phone",type:"text",value:s.phone,onChange:a=>l({...s,phone:a.target.value}),className:"w-full border rounded px-3 py-2 bg-white text-gray-900 dark:bg-gray-700 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"password",children:["Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"password",type:"password",value:s.password,onChange:a=>l({...s,password:a.target.value}),className:"w-full border rounded px-3 py-2 bg-white text-gray-900 dark:bg-gray-700 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"role",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"role",value:s.role,onChange:a=>l({...s,role:a.target.value}),className:"w-full border rounded px-3 py-2 bg-white text-gray-900 dark:bg-gray-700 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Pilih role"}),y.map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(d,{variant:"secondary",onClick:async()=>{(await O("Batalkan perubahan?")).isConfirmed&&g()},children:"Batal"}),e.jsx(d,{onClick:B,children:"Simpan"})]})]})]})]})}export{xe as default};
