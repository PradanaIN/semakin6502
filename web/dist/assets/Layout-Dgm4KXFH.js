import{c,u as I,R as a,j as e,N as K,e as $,a as O,r as l,f as S,b,H as R,d as U,O as z,g as F}from"./index-tHDgc07s.js";import{B as D}from"./book-open-B5Wj2lPN.js";import{C as _}from"./circle-alert-DKiISY_i.js";import{C as G}from"./clipboard-list-6sVYLlld.js";import{c as H}from"./confirmAlert-BWqzQj7I.js";import{F as q,a as B,b as V,c as W,d as Z,e as J,f as Q,g as X}from"./index-ByzRz9Id.js";import{d as Y}from"./dayjs-CdKn--g1.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],ae=c("chart-no-axes-column",ee);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],se=c("chevron-left",te);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]],ne=c("file-plus",re);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],oe=c("file-text",le);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],ce=c("layout-dashboard",ie);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],me=c("list",de);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],xe=c("user-cog",ue);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],he=c("users",ge),be={dashboard:{to:"/dashboard",label:"Dashboard",icon:ce,roles:[a.ADMIN,a.KETUA,a.ANGGOTA]},tugasMingguan:{to:"/tugas-mingguan",label:"Tugas Mingguan",icon:G,roles:[a.ADMIN,a.KETUA,a.ANGGOTA,a.PIMPINAN]},tugasTambahan:{to:"/tugas-tambahan",label:"Tugas Tambahan",icon:ne,roles:[a.ADMIN,a.KETUA,a.ANGGOTA,a.PIMPINAN]},laporanHarian:{to:"/laporan-harian",label:"Laporan Harian",icon:oe,roles:[a.ADMIN,a.KETUA,a.ANGGOTA]},monitoring:{to:"/monitoring",label:"Monitoring",icon:ae,roles:[a.ADMIN,a.KETUA,a.ANGGOTA,a.PIMPINAN]},keterlambatan:{to:"/laporan-terlambat",label:"Keterlambatan",icon:_,roles:[a.ADMIN,a.KETUA,a.ANGGOTA,a.PIMPINAN]},panduan:{to:"/panduan",label:"Panduan",icon:D,roles:[a.ADMIN,a.KETUA,a.ANGGOTA,a.PIMPINAN]},masterKegiatan:{to:"/master-kegiatan",label:"Master Kegiatan",icon:me,roles:[a.ADMIN,a.KETUA]},kelolaPengguna:{to:"/users",label:"Kelola Pengguna",icon:he,roles:[a.ADMIN]},kelolaTim:{to:"/teams",label:"Kelola Tim",icon:xe,roles:[a.ADMIN]}},fe=[{label:null,links:["dashboard"]},{label:"Data Pegawai",links:["tugasMingguan","tugasTambahan","laporanHarian"]},{label:"Monitoring",links:["monitoring","keterlambatan"]},{label:"Master",links:["masterKegiatan","kelolaPengguna","kelolaTim"]},{label:"Lainnya",links:["panduan"]}],pe=[{label:null,links:["monitoring","keterlambatan"]},{label:"Data Pegawai",links:["tugasMingguan","tugasTambahan"]},{label:"Lainnya",links:["panduan"]}];function ye({setSidebarOpen:s}){const{user:g}=I(),h=r=>!r.roles||r.roles.includes(g?.role),f=g?.role===a.PIMPINAN?pe:fe,x=r=>{const o=r.icon;return e.jsxs(K,{to:r.to,className:({isActive:i})=>`flex items-center gap-3 px-4 py-2 rounded transition-all ${i?"bg-blue-100 text-blue-700 dark:bg-blue-700 dark:text-white font-semibold":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx(o,{size:18}),r.label]},r.to)};return e.jsxs("aside",{className:"relative h-full w-64 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 p-4 shadow-md overflow-y-auto flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-6",children:[e.jsx("img",{src:"/logo.png",alt:"Logo SEMAKIN 6502",className:"h-8 w-8 object-contain"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:"SEMAKIN 6502"})]}),e.jsx("nav",{className:"space-y-2",children:f.map((r,o)=>{const i=r.links.map(m=>be[m]).filter(h);return i.length===0?null:e.jsxs("div",{className:"space-y-2",children:[o>0&&e.jsx("hr",{className:"my-4 border-gray-200 dark:border-gray-700"}),r.label&&e.jsx("div",{className:"px-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:r.label}),i.map(x)]},r.label||o)})}),e.jsxs("button",{className:`mt-auto flex items-center justify-center\r
    text-lg text-blue-700 dark:text-white\r
    font-semibold  bg-white dark:bg-gray-800\r
    rounded-full px-4 py-2\r
    bg-gradient-to-tr from-blue-100 to-blue-50 dark:from-blue-900 dark:to-blue-800\r
    hover:from-blue-200 hover:to-blue-100 dark:hover:from-blue-800 dark:hover:to-blue-700\r
    shadow-sm hover:shadow-md\r
    focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500\r
    transition-all duration-200 ease-in-out`,onClick:()=>s(!1),"aria-label":"Tutup menu",children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{className:"ml-2 text-sm",children:"Tutup Sidebar"})]})]})}function Te(){const{user:s,setUser:g}=I(),h=$(),f=O(),[x,r]=l.useState(()=>typeof window<"u"?window.innerWidth>=768:!0),[o,i]=l.useState(0),[m,p]=l.useState([]),{theme:w,toggleTheme:C}=S(),[A,y]=l.useState(!1),[M,T]=l.useState(!1),k=l.useRef(),N=l.useRef(),u=l.useCallback(async()=>{if(!(!s||s.role===a.PIMPINAN))try{const t=await b.get("/notifications"),n=Array.isArray(t.data)?t.data:[];Array.isArray(t.data)||console.warn("Unexpected notifications response",t.data),p(n),i(n.filter(d=>!d.isRead).length)}catch(t){console.error("Failed to fetch notifications",t)}},[s]);l.useEffect(()=>{u()},[u]),l.useEffect(()=>{const t=setInterval(u,6e4);return()=>clearInterval(t)},[u]);const P=async()=>{(await H({title:"Logout?",text:"Anda yakin ingin logout?",icon:"warning",confirmButtonText:"Logout"})).isConfirmed&&(await b.post("/auth/logout",{},{withCredentials:!0}),localStorage.removeItem("user"),g(null))},L=async()=>{try{await b.post("/notifications/read-all");const t=m.map(n=>({...n,isRead:!0}));p(t),i(0),await u()}catch(t){console.error("Failed to mark notifications",t)}},E=async(t,n)=>{try{await b.post(`/notifications/${t}/read`),n&&f(n),p(d=>d.map(j=>j.id===t?{...j,isRead:!0}:j)),i(d=>Math.max(0,d-1)),await u()}catch(d){console.error("Failed to mark notification",d)}};l.useEffect(()=>{const t=n=>{k.current&&!k.current.contains(n.target)&&y(!1),N.current&&!N.current.contains(n.target)&&T(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),l.useEffect(()=>{const t=()=>{window.innerWidth<768&&r(!1)};return window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)},[]);const v=l.useCallback(()=>(h.pathname.split("/")[1]||"dashboard").replaceAll("-"," ").split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "),[h.pathname]);return e.jsxs(e.Fragment,{children:[e.jsxs(R,{children:[e.jsx("title",{children:`SEMAKIN 6502 - ${v()}`}),e.jsx("meta",{name:"description",content:"Sistem Evaluasi dan Monitoring Kinerja"}),e.jsx("meta",{property:"og:title",content:`SEMAKIN 6502 - ${v()}`})]}),e.jsxs("div",{className:"h-screen overflow-hidden flex text-gray-800 dark:text-gray-100 bg-gray-100 dark:bg-gray-900",children:[e.jsx("div",{className:`fixed md:static top-0 left-0 z-40 h-full overflow-hidden transition-all duration-300 w-64 ${x?"translate-x-0 md:w-64":"-translate-x-full md:w-0"} md:translate-x-0`,children:e.jsx(ye,{setSidebarOpen:r})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-30 z-30 md:hidden"}),e.jsxs("div",{className:"flex flex-col flex-1 h-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{className:`text-xl text-gray-700 dark:text-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 ring-blue-500 ${x?"hidden":""}`,onClick:()=>r(!0),"aria-label":"Open menu",children:e.jsx(q,{})}),e.jsx("div",{className:"text-lg sm:text-xl font-semibold capitalize truncate max-w-[200px] sm:max-w-xs",children:v()})]}),e.jsxs("div",{className:"flex items-center space-x-4 ml-auto",children:[e.jsxs("div",{className:"relative",ref:N,children:[e.jsxs("button",{onClick:()=>T(!M),className:"relative focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 ring-blue-500","aria-label":"Notifications",children:[e.jsx(B,{className:"text-xl cursor-pointer"}),o>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"absolute -top-1 -right-2 inline-flex h-5 w-5",children:e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-60"})}),e.jsx("span",{className:"absolute -top-1 -right-2 bg-red-600 text-white text-[10px] min-w-[20px] h-5 px-1.5 flex items-center justify-center rounded-full shadow-sm",children:o>99?"99+":o})]})]}),M&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 max-h-96 overflow-y-auto custom-scrollbar bg-white/95 dark:bg-gray-800/95 backdrop-blur border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl z-50 py-2",children:[e.jsxs("div",{className:"px-4 py-2 font-semibold border-b dark:border-gray-600 flex justify-between items-center",children:[e.jsx("span",{children:"Notifikasi"}),m.length>0&&e.jsx("button",{onClick:L,className:"text-xs text-blue-600 hover:underline dark:text-blue-400",children:"Tandai sudah dibaca"})]}),m.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-gray-500 dark:text-gray-400 text-center",children:"Tidak ada notifikasi"}):m.map(t=>e.jsxs("button",{type:"button",onClick:()=>E(t.id,t.link),"aria-label":`Buka notifikasi ${t.text}`,className:`w-full text-left px-4 py-2 text-sm flex items-start gap-3 transition-colors ${t.isRead?"text-gray-500 dark:text-gray-400 hover:bg-gray-100/60 dark:hover:bg-gray-700/60":"bg-blue-50/60 dark:bg-gray-700/60 hover:bg-blue-100/60 dark:hover:bg-gray-700/80"}`,children:[e.jsx("span",{className:`mt-1 inline-block h-2 w-2 rounded-full ${t.isRead?"bg-gray-300":"bg-blue-500"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`truncate ${t.isRead?"":"font-medium"}`,children:t.text}),e.jsx("div",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:Y(t.createdAt).fromNow()})]}),e.jsx(V,{className:`mt-0.5 flex-shrink-0 ${t.isRead?"text-green-400":"text-gray-300"}`})]},t.id))]})]}),e.jsxs("div",{className:"hidden sm:flex items-center space-x-2",children:[e.jsx(W,{className:"text-yellow-400"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w==="dark",onChange:C,className:"sr-only peer","aria-label":"Toggle dark mode"}),e.jsx("div",{className:"relative w-11 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"})]}),e.jsx(Z,{className:"text-blue-400"})]}),e.jsxs("div",{className:"relative",ref:k,children:[e.jsxs("button",{onClick:()=>y(!A),className:"flex items-center space-x-2 text-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 ring-blue-500",children:[s?.role===a.ADMIN?e.jsx(J,{className:"text-2xl"}):e.jsx("img",{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(s?.nama??"User")}`,alt:s?.nama??"User",className:"w-8 h-8 rounded-full object-cover"}),e.jsx("div",{className:"hidden md:block text-left",children:s?.role===a.ADMIN?e.jsx("div",{className:"font-semibold",children:"Admin"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold",children:s?.nama}),e.jsx("div",{className:"text-xs capitalize text-gray-500 dark:text-gray-400",children:s?.role===a.PIMPINAN?"Pimpinan":`${s?.role===a.KETUA?"Ketua Tim":"Anggota Tim"} ${s?.team||s?.teamName||s?.namaTim||s?.members?.[0]?.team?.namaTim||""}`})]})})]}),A&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg z-50 py-2",children:[e.jsxs(U,{to:"/profile",onClick:()=>y(!1),className:"flex items-center w-full px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(Q,{className:"mr-2"})," Lihat Profil"]}),e.jsxs("button",{onClick:P,className:"flex items-center w-full px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(X,{className:"mr-2"})," Logout"]})]})]})]})]}),e.jsx("main",{className:"p-4 overflow-y-auto flex-1 bg-gray-100 dark:bg-gray-900",children:e.jsx(z,{})}),e.jsx(F,{position:"top-right",autoClose:3e3,theme:w,newestOnTop:!0,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,toastClassName:"custom-toast",bodyClassName:"custom-toast-body",progressClassName:"custom-toast-progress"})]})]})]})}export{Te as default};
